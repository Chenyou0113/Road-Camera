<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©æ°£å ±å¼å“©çŸ¥å¾Œè‡ºç®¡ç†ç³»çµ± - ç®¡ç†å„€è¡¨æ¿</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* === å…¨å±€åŸºç¤æ¨£å¼ === */
        body { 
            background: #121212; /* æ›´æ·±çš„èƒŒæ™¯è‰² */
            color: #e0e0e0; 
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; 
            margin: 0; 
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* === ç™»å…¥é é¢æ¨£å¼ (ç½®ä¸­å–®æ¬„) === */
        .login-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            flex: 1;
            padding: 20px;
        }
        .login-container { 
            width: 100%; 
            max-width: 400px; 
        }

        /* === å¾Œå°å„€è¡¨æ¿æ¨£å¼ (å¯¬ç‰ˆ - ä¿®æ”¹è™•) === */
        .dashboard-wrapper {
            width: 100%;
            /* ä¿®æ”¹è™•ï¼šåŸæœ¬æ˜¯ 1200pxï¼Œæ”¹æˆ 98% è®“å®ƒå¹¾ä¹å¡«æ»¿æ•´å€‹è¢å¹•ï¼Œç•™ä¸€é»é»é‚Šè·æ¯”è¼ƒå¥½çœ‹ */
            max-width: 98%; 
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒæ’ç ´ç‰ˆé¢ */
            display: none; 
        }
        .dashboard-wrapper.active {
            display: block;
        }

        /* å¡ç‰‡é€šç”¨æ¨£å¼ */
        .card { 
            background: #1e1e1e; 
            padding: 25px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
            border: 1px solid #333; 
            margin-bottom: 20px;
            transition: transform 0.2s;
        }
        .card:hover {
            border-color: #444;
        }

        /* æ¨™é¡Œèˆ‡æ–‡å­— */
        h2 { text-align: center; color: #4fc3f7; margin: 0 0 20px 0; font-size: 1.5rem; }
        h3 { color: #fff; border-bottom: 2px solid #333; padding-bottom: 10px; margin-bottom: 20px; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; }
        
        /* è¡¨å–®å…ƒä»¶ */
        input, textarea { 
            width: 100%; padding: 12px; margin-bottom: 15px; 
            background: #2c2c2c; border: 1px solid #444; 
            color: #fff; border-radius: 6px; box-sizing: border-box; 
            font-size: 15px; outline: none; transition: 0.3s;
        }
        input:focus, textarea:focus { border-color: #4fc3f7; background: #333; }
        textarea { resize: vertical; line-height: 1.5; min-height: 100px; }

        /* æŒ‰éˆ•ç¾¤çµ„ */
        button { 
            width: 100%; padding: 12px; border: none; 
            color: white; font-weight: bold; border-radius: 6px; 
            cursor: pointer; font-size: 15px; transition: 0.3s; 
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }
        button:hover { filter: brightness(1.1); transform: translateY(-1px); }
        button:active { transform: translateY(0); }
        button:disabled { filter: grayscale(1); cursor: not-allowed; }

        .btn-login { background: linear-gradient(135deg, #2196F3, #1976D2); }
        .btn-save { background: linear-gradient(135deg, #43a047, #2e7d32); } /* ç¶ è‰²ç³» */
        .btn-pids { background: linear-gradient(135deg, #e91e63, #c2185b); } /* æ¡ƒç´…ç³» */
        .btn-warn { background: linear-gradient(135deg, #ff9800, #f57c00); } /* æ©˜è‰²ç³» */
        .btn-invite { background: linear-gradient(135deg, #673ab7, #512da8); } /* ç´«è‰²ç³» */

        .status { text-align: center; margin-top: 10px; font-size: 14px; min-height: 20px; color: #aaa; }
        .link { display: block; text-align: center; color: #aaa; font-size: 14px; text-decoration: none; margin-top: 15px; }
        .link:hover { color: #fff; }

        /* === å„€è¡¨æ¿ä½ˆå±€ (Grid System) === */
        .top-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #1e1e1e;
            padding: 15px 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            border: 1px solid #333;
        }
        .nav-left { display: flex; align-items: center; gap: 15px; }
        .nav-right { display: flex; align-items: center; gap: 15px; font-size: 0.9rem; color: #aaa; }
        .user-badge { background: #333; padding: 5px 12px; border-radius: 20px; color: #4fc3f7; font-weight: bold; }
        .logout-btn { color: #ff5252; text-decoration: none; font-weight: bold; padding: 5px 10px; border: 1px solid #ff5252; border-radius: 5px; transition: 0.3s; }
        .logout-btn:hover { background: #ff5252; color: white; }
        .home-link { color: #fff; text-decoration: none; display: flex; align-items: center; gap: 8px; font-weight: bold; }
        .home-link:hover { color: #4fc3f7; }

        .dashboard-grid {
            display: grid;
            /* ä¿®æ”¹è™•ï¼šåŸæœ¬æ˜¯ 2fr 1frï¼Œæ”¹æˆ 3fr 1frï¼Œè®“å·¦é‚Šä¸»è¦çš„æ–‡å­—ç·¨è¼¯å€æ›´å¯¬ï¼Œå³é‚Šå·¥å…·æ¬„ç¶­æŒé©ç•¶æ¯”ä¾‹ */
            grid-template-columns: 3fr 1fr; 
            gap: 25px;
            align-items: start;
        }

        /* é‚€è«‹ç¢¼å€å¡Š */
        .code-display { 
            background: #000; border: 2px dashed #673ab7; color: #b388ff; 
            padding: 15px; text-align: center; font-size: 1.4rem; 
            font-family: monospace; letter-spacing: 2px; margin-bottom: 10px; 
            border-radius: 8px; display: none; cursor: pointer; transition: 0.2s;
        }
        .code-display:hover { background: #1a1a1a; }
        .hint { font-size: 0.8rem; color: #888; text-align: center; margin-bottom: 15px; display: none; }

        /* PIDS é è¦½å€å¡Šå„ªåŒ– */
        #pidsCurrentText {
            color: #ffeb3b;
            font-family: monospace;
            display: block;
            white-space: pre-wrap; /* ğŸ”¥ é—œéµï¼šè®“å…§å®¹æ­£ç¢ºæ›è¡Œï¼Œä¸æœƒè¢«æ’æˆä¸€é•·æ¢ */
            word-wrap: break-word; /* è¶…é•·å–®å­—ä¹Ÿæœƒè‡ªå‹•æ›è¡Œ */
            overflow-wrap: break-word;
        }

        /* é–‹é—œæŒ‰éˆ• */
        .switch-container { display: flex; align-items: center; margin-bottom: 15px; background: #252525; padding: 10px; border-radius: 8px; }
        .switch { position: relative; display: inline-block; width: 50px; height: 26px; margin-right: 12px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #444; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #ff9800; }
        input:checked + .slider:before { transform: translateX(24px); }
        .switch-label { font-weight: bold; }

        /* RWD: æ‰‹æ©Ÿç‰ˆè®Šå›å–®æ¬„ */
        @media (max-width: 900px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .top-nav { flex-direction: column; gap: 15px; align-items: flex-start; }
            .nav-right { width: 100%; justify-content: space-between; }
        }
    </style>
</head>
<body>

    <div class="login-wrapper" id="loginSection">
        <div class="login-container">
            <div class="card">
                <a href="index.html" style="display:inline-flex; align-items:center; gap:5px; color:#aaa; text-decoration:none; margin-bottom:20px;">
                    <i class="fas fa-arrow-left"></i> è¿”å›å¤©æ°£é¦–é 
                </a>
                <h2>ğŸ” å¾Œå°ç™»å…¥</h2>
                <input type="text" id="loginUser" placeholder="å¸³è™Ÿ">
                <input type="password" id="loginPass" placeholder="å¯†ç¢¼">
                <button class="btn-login" onclick="doLogin()">ç™»å…¥ç³»çµ±</button>
                <a href="register.html" class="link">è¨»å†Šç®¡ç†å“¡å¸³è™Ÿ</a>
                <div class="status" id="loginStatus"></div>
            </div>
        </div>
    </div>

    <div class="dashboard-wrapper" id="editSection">
        
        <div class="top-nav">
            <div class="nav-left">
                <a href="index.html" class="home-link">
                    <i class="fas fa-cloud-sun-rain" style="font-size: 1.2rem;"></i> 
                    ç‹å‰é å ±ç®¡ç†å¾Œå°
                </a>
            </div>
            <div class="nav-right">
                <span>ç™»å…¥èº«åˆ†ï¼š<span id="currentUser" class="user-badge">User</span></span>
                <a href="#" onclick="logout()" class="logout-btn"><i class="fas fa-sign-out-alt"></i> ç™»å‡º</a>
            </div>
        </div>

        <div class="dashboard-grid">
            
            <div class="grid-col-main">
                
                <div class="card">
                    <h3 style="color: #4caf50;"><i class="fas fa-bullhorn"></i> é¦–é è·‘é¦¬ç‡ˆè¨­å®š</h3>
                    <textarea id="message" placeholder="è¼‰å…¥ä¸­..."></textarea>
                    <button class="btn-save" onclick="saveMessage()">
                        <i class="fas fa-save"></i> æ›´æ–°é¦–é è·‘é¦¬ç‡ˆ
                    </button>
                    <div class="status" id="editStatus"></div>
                </div>

                <div class="card" style="border-top: 4px solid #e91e63;">
                    <h3 style="color: #e91e63;"><i class="fas fa-desktop"></i> PIDS è·‘é¦¬ç‡ˆæ§åˆ¶å°</h3>
                    
                    <!-- ä¸Šæ–¹é¡¯ç¤ºå€ï¼šé™åˆ¶300pxé«˜ -->
                    <div style="background:#252525; padding:12px; border-radius:6px; margin-bottom:15px; font-size:0.9rem; max-height: 300px; overflow-y: auto;">
                        <span style="color:#aaa; display:block; margin-bottom: 5px; position:sticky; top:0; background:#252525;">ğŸ“ ç›®å‰é¡¯ç¤ºï¼š</span>
                        <span id="pidsCurrentText" style="color:#ffeb3b; font-family:monospace; display:block; white-space: pre-wrap;">è¼‰å…¥ä¸­...</span>
                    </div>

                    <!-- ä¿®æ”¹è™•ï¼šå°‡è¼¸å…¥æ¡†é«˜åº¦æ”¹ç‚º 300pxï¼Œèˆ‡ä¸Šæ–¹é¡¯ç¤ºå€å°æ‡‰ -->
                    <textarea id="pidsMarqueeInput" style="height: 300px;" placeholder="è¼¸å…¥ PIDS çœ‹æ¿æ–‡å­— (æ”¯æ´ HTML èªæ³•)..."></textarea>
                    <button class="btn-pids" onclick="updatePidsMarquee()">
                        <i class="fas fa-paper-plane"></i> ç™¼é€è‡³æ‰€æœ‰è»Šç«™çœ‹æ¿
                    </button>
                    <div class="status" id="pidsStatus"></div>
                </div>

                <!-- ğŸ”¥ æ–°å¢ï¼šå¤šåª’é«”è¨­å®šå¡ç‰‡ -->
                <div class="card" style="border-top: 4px solid #2196f3;">
                    <h3 style="color: #2196f3;"><i class="fas fa-photo-video"></i> PIDS å¤šåª’é«”ç´ æ</h3>
                    
                    <span style="color:#aaa; display:block; margin-bottom:10px; font-size:0.9rem;">ğŸ“¸ è¼ªæ’­åœ–ç‰‡ç¶²å€ (ä¸€è¡Œä¸€å¼µï¼Œæ”¯æ´ JPG/PNG)</span>
                    <textarea id="pidsImagesInput" style="height: 150px;" placeholder="https://example.com/img1.jpg&#10;https://example.com/img2.jpg"></textarea>
                    
                    <span style="color:#aaa; display:block; margin-bottom:10px; margin-top:10px; font-size:0.9rem;">ğŸ¥ å½±ç‰‡ç¶²å€ (YouTube é€£çµæˆ– ID)</span>
                    <input type="text" id="pidsVideoInput" placeholder="https://www.youtube.com/watch?v=XXXXXX">
                    
                    <button class="btn-media" onclick="savePidsAssets()" style="background: linear-gradient(135deg, #2196f3, #1565c0); color:white; margin-top:10px;">
                        <i class="fas fa-cloud-upload-alt"></i> å„²å­˜å¤šåª’é«”è¨­å®š
                    </button>
                    <div class="status" id="pidsAssetsStatus"></div>
                </div>

            </div>

            <div class="grid-col-side">
                
                <div class="card" style="border-top: 4px solid #ff9800;">
                    <h3 style="color: #ff9800;"><i class="fas fa-exclamation-circle"></i> ç³»çµ±å½ˆçª—å…¬å‘Š</h3>
                    
                    <div class="switch-container">
                        <label class="switch">
                            <input type="checkbox" id="ann_active">
                            <span class="slider"></span>
                        </label>
                        <span class="switch-label" id="ann_label">ç‹€æ…‹ï¼šé—œé–‰</span>
                    </div>

                    <input type="text" id="ann_title" placeholder="å…¬å‘Šæ¨™é¡Œ">
                    <textarea id="ann_content" style="height: 80px;" placeholder="å…¬å‘Šå…§æ–‡..."></textarea>
                    <textarea id="ann_list" style="height: 100px;" placeholder="æ¸…å–®é …ç›® (ä¸€è¡Œä¸€å€‹)&#10;âœ… é …ç›®ä¸€&#10;âœ… é …ç›®äºŒ"></textarea>
                    
                    <button class="btn-warn" onclick="saveAnnouncement()">
                        <i class="fas fa-check-circle"></i> ç™¼å¸ƒå…¬å‘Š
                    </button>
                    <div class="status" id="annStatus"></div>
                </div>

                <div class="card" style="border-top: 4px solid #673ab7;">
                    <h3 style="color: #b388ff;"><i class="fas fa-ticket-alt"></i> é‚€è«‹ç¢¼ç”¢ç”Ÿå™¨</h3>
                    <div id="newCodeBox" class="code-display" onclick="copyCode()" title="é»æ“Šè¤‡è£½"></div>
                    <div id="copyHint" class="hint">ğŸ‘† é»æ“Šä»£ç¢¼è¤‡è£½</div>
                    <button class="btn-invite" onclick="generateInviteCode()">
                        <i class="fas fa-magic"></i> ç”Ÿæˆæ–°é‚€è«‹ç¢¼
                    </button>
                    <div class="status" id="inviteStatus"></div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // â˜… Worker API ç¶²å€
        const API_BASE = 'https://wang-weather.xiaoyouwu5-fd3.workers.dev';
        const PIDS_WORKER_URL = 'https://tra-schedule-worker.xiaoyouwu5-fd3.workers.dev';

        // æª¢æŸ¥æ˜¯å¦å·²ç™»å…¥
        function checkAuth() {
            const user = localStorage.getItem('wangwei_user');
            const pass = localStorage.getItem('wangwei_pass');
            
            if (user && pass) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('editSection').classList.add('active');
                document.getElementById('currentUser').innerText = user;
                loadCurrent();
            }
        }

        // ç™»å…¥
        function doLogin() {
            const user = document.getElementById('loginUser').value.trim();
            const pass = document.getElementById('loginPass').value.trim();
            
            if(user && pass) {
                localStorage.setItem('wangwei_user', user);
                localStorage.setItem('wangwei_pass', pass);
                checkAuth();
            } else {
                showError('loginStatus', "è«‹è¼¸å…¥å¸³è™Ÿå¯†ç¢¼");
            }
        }

        function logout() {
            localStorage.removeItem('wangwei_user');
            localStorage.removeItem('wangwei_pass');
            location.reload();
        }

        // è¼‰å…¥æ‰€æœ‰è³‡æ–™
        async function loadCurrent() {
            try {
                // 1. è¼‰å…¥å¤©æ°£è·‘é¦¬ç‡ˆ
                const resMsg = await fetch(`${API_BASE}/message`);
                const dataMsg = await resMsg.json();
                document.getElementById('message').value = dataMsg.message;

                // 2. è¼‰å…¥å…¬å‘Šè¨­å®š
                const resAnn = await fetch(`${API_BASE}/announcement`);
                const dataAnn = await resAnn.json();
                
                document.getElementById('ann_active').checked = dataAnn.active;
                updateSwitchLabel(dataAnn.active);
                document.getElementById('ann_title').value = dataAnn.title || "";
                document.getElementById('ann_content').value = dataAnn.content || "";
                document.getElementById('ann_list').value = (dataAnn.list || []).join('\n');

                document.getElementById('ann_active').onchange = function() {
                    updateSwitchLabel(this.checked);
                };

                // 3. è¼‰å…¥ PIDS è·‘é¦¬ç‡ˆ
                loadPidsMarquee();

            } catch (e) {
                console.error(e);
                alert("âš ï¸ éƒ¨åˆ†è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯");
            }
        }

        function updateSwitchLabel(checked) {
            const label = document.getElementById('ann_label');
            if(checked) {
                label.innerText = "ç‹€æ…‹ï¼šé–‹å•Ÿ (é¡¯ç¤ºä¸­)";
                label.style.color = "#ff9800";
            } else {
                label.innerText = "ç‹€æ…‹ï¼šé—œé–‰";
                label.style.color = "#aaa";
            }
        }

        // å„²å­˜å¤©æ°£è·‘é¦¬ç‡ˆ
        async function saveMessage() {
            updateData(`${API_BASE}/message`, { message: document.getElementById('message').value }, 'editStatus', 'é¦–é è·‘é¦¬ç‡ˆæ›´æ–°æˆåŠŸï¼');
        }

        // å„²å­˜å…¬å‘Š
        async function saveAnnouncement() {
            const payload = {
                active: document.getElementById('ann_active').checked,
                title: document.getElementById('ann_title').value,
                content: document.getElementById('ann_content').value,
                list: document.getElementById('ann_list').value.split('\n').filter(line => line.trim() !== '')
            };
            updateData(`${API_BASE}/announcement`, payload, 'annStatus', 'å…¬å‘Šè¨­å®šå·²å„²å­˜ï¼');
        }

        // é€šç”¨æ›´æ–°å‡½å¼
        async function updateData(url, payload, statusId, successMsg) {
            const user = localStorage.getItem('wangwei_user');
            const pass = localStorage.getItem('wangwei_pass');
            const statusEl = document.getElementById(statusId);

            statusEl.innerText = "â³ è™•ç†ä¸­...";
            statusEl.style.color = "#aaa";
            
            try {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-Username': user, 'X-Password': pass },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();
                if (data.success) {
                    statusEl.innerText = "âœ… " + successMsg;
                    statusEl.style.color = "#4caf50";
                    setTimeout(() => statusEl.innerText = "", 3000);
                } else {
                    handleError(statusEl, data.error);
                }
            } catch (e) {
                statusEl.innerText = "âŒ é€£ç·šå¤±æ•—";
                statusEl.style.color = "#ff5252";
            }
        }

        // ç”Ÿæˆé‚€è«‹ç¢¼
        async function generateInviteCode() {
            const user = localStorage.getItem('wangwei_user');
            const pass = localStorage.getItem('wangwei_pass');
            const statusEl = document.getElementById('inviteStatus');
            const codeBox = document.getElementById('newCodeBox');
            const hintBox = document.getElementById('copyHint');

            statusEl.innerText = "â³ ç”Ÿæˆä¸­...";
            codeBox.style.display = 'none';
            hintBox.style.display = 'none';

            try {
                const res = await fetch(`${API_BASE}/generate-invite`, {
                    method: 'POST',
                    headers: { 'X-Username': user, 'X-Password': pass }
                });
                const data = await res.json();
                if (data.success) {
                    statusEl.innerText = "";
                    codeBox.innerText = data.code;
                    codeBox.style.display = 'block';
                    hintBox.style.display = 'block';
                } else {
                    handleError(statusEl, data.error);
                }
            } catch (e) {
                statusEl.innerText = "âŒ ç”Ÿæˆå¤±æ•—";
                statusEl.style.color = "#ff5252";
            }
        }

        function copyCode() {
            const code = document.getElementById('newCodeBox').innerText;
            navigator.clipboard.writeText(code).then(() => alert("âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼"));
        }

        // === PIDS æ§åˆ¶ ===
        async function loadPidsMarquee() {
            try {
                const res = await fetch(`${PIDS_WORKER_URL}/api/pids/marquee`);
                const data = await res.json();
                if (data.text) {
                    document.getElementById('pidsMarqueeInput').value = data.text;
                    document.getElementById('pidsCurrentText').innerText = data.text;
                }
            } catch (e) {
                document.getElementById('pidsCurrentText').innerText = "âŒ ç„¡æ³•é€£ç·š PIDS Worker";
            }
        }

        async function updatePidsMarquee() {
            const btn = event.target;
            const newText = document.getElementById('pidsMarqueeInput').value;
            const statusEl = document.getElementById('pidsStatus');

            if (!newText.trim()) return showError('pidsStatus', "å…§å®¹ä¸èƒ½ç‚ºç©º");

            btn.disabled = true;
            statusEl.innerText = "â³ ç™¼é€ä¸­...";
            
            try {
                const res = await fetch(`${PIDS_WORKER_URL}/api/admin/update-pids`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: newText })
                });
                const result = await res.json();
                if (res.ok && result.success) {
                    statusEl.innerText = "âœ… ç™¼é€æˆåŠŸï¼PIDS å°‡è‡ªå‹•æ›´æ–°ã€‚";
                    statusEl.style.color = "#4caf50";
                    document.getElementById('pidsCurrentText').innerText = newText;
                } else {
                    statusEl.innerText = "âŒ ç™¼é€å¤±æ•—ï¼š" + (result.error || "æœªçŸ¥éŒ¯èª¤");
                    statusEl.style.color = "#ff5252";
                }
            } catch (e) {
                statusEl.innerText = "âŒ é€£ç·šéŒ¯èª¤";
                statusEl.style.color = "#ff5252";
            } finally {
                btn.disabled = false;
            }
        }

        // ğŸ”¥ === PIDS å¤šåª’é«”æ§åˆ¶ ===
        async function loadPidsAssets() {
            try {
                const res = await fetch(`${PIDS_WORKER_URL}/api/pids/assets`);
                const data = await res.json();
                if (data.images && Array.isArray(data.images)) {
                    document.getElementById('pidsImagesInput').value = data.images.join('\n');
                }
                if (data.video) {
                    document.getElementById('pidsVideoInput').value = data.video;
                }
            } catch (e) {
                console.warn("ç„¡æ³•è¼‰å…¥å¤šåª’é«”è³‡æº:", e);
            }
        }

        async function savePidsAssets() {
            const btn = event.target;
            const images = document.getElementById('pidsImagesInput').value.split('\n').map(s=>s.trim()).filter(s=>s);
            const video = document.getElementById('pidsVideoInput').value.trim();
            const statusEl = document.getElementById('pidsAssetsStatus');

            btn.disabled = true;
            statusEl.innerText = "â³ å„²å­˜ä¸­...";
            statusEl.style.color = "#aaa";
            
            try {
                const res = await fetch(`${PIDS_WORKER_URL}/api/admin/update-assets`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ images, video })
                });
                const result = await res.json();
                if (res.ok && result.success) {
                    statusEl.innerText = "âœ… å¤šåª’é«”è¨­å®šå·²å„²å­˜ï¼PIDS å°‡æ–¼ä¸‹æ¬¡åˆ·æ–°æ™‚é¡¯ç¤ºæ–°ç´ æã€‚";
                    statusEl.style.color = "#4caf50";
                } else {
                    statusEl.innerText = "âŒ å„²å­˜å¤±æ•—ï¼š" + (result.error || "æœªçŸ¥éŒ¯èª¤");
                    statusEl.style.color = "#ff5252";
                }
            } catch (e) {
                statusEl.innerText = "âŒ é€£ç·šéŒ¯èª¤ï¼š" + e.message;
                statusEl.style.color = "#ff5252";
            } finally {
                btn.disabled = false;
            }
        }

        function handleError(el, error) {
            el.innerText = "âŒ å¤±æ•—ï¼š" + (error || "æœªçŸ¥éŒ¯èª¤");
            el.style.color = "#ff5252";
            if(error === "å¯†ç¢¼éŒ¯èª¤" || error === "å¸³è™Ÿä¸å­˜åœ¨") logout();
        }

        function showError(id, msg) {
            const el = document.getElementById(id);
            el.innerText = "âŒ " + msg;
            el.style.color = "#ff5252";
        }

        checkAuth();
        loadPidsMarquee();
        loadPidsAssets();
    </script>
</body>
</html>