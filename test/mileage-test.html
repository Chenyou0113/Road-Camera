<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡Œç¨‹æ ¼å¼æ¸¬è©¦</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #FF9800;
            text-align: center;
            margin-bottom: 20px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .test-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid #e9ecef;
        }
        .test-title {
            font-weight: bold;
            color: #FF9800;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        .test-data {
            background: #ffffff;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.9rem;
            border-left: 3px solid #FF9800;
        }
        .test-result {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            border-left: 3px solid #4CAF50;
        }
        .mileage-info {
            color: #FF9800;
            font-weight: bold;
        }
        .segment-info {
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›£ï¸ çœé“ç›£è¦–å™¨é‡Œç¨‹æ ¼å¼æ¸¬è©¦</h1>
        <p style="text-align: center; color: #666; margin-bottom: 30px;">
            æ¸¬è©¦ä¸åŒé‡Œç¨‹æ ¼å¼çš„è­˜åˆ¥å’Œé¡¯ç¤ºæ•ˆæœ
        </p>
        
        <div class="test-grid" id="testGrid">
            <!-- æ¸¬è©¦æ•¸æ“šå°‡ç”± JavaScript ç”Ÿæˆ -->
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button onclick="runAllTests()" style="padding: 12px 24px; background: #FF9800; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 1rem;">
                ğŸ§ª é‡æ–°æ¸¬è©¦æ‰€æœ‰æ ¼å¼
            </button>
        </div>
    </div>

    <script>
        // æ¸¬è©¦æ•¸æ“šæ¨¡æ“¬ä¸åŒçš„é‡Œç¨‹æ ¼å¼
        const testCameras = [
            {
                CCTVID: 'TEST001',
                RoadName: 'å°1ç·šåœ“å±±äº¤æµé“',
                LocationMile: '125K+500',
                LocationDescription: 'åœ“å±±äº¤æµé“é™„è¿‘',
                City: 'å°åŒ—å¸‚'
            },
            {
                CCTVID: 'TEST002', 
                RoadName: 'å°3ç·š',
                LocationMile: '98.5K',
                LocationDescription: 'å¤§æºªæ©‹å—ç«¯',
                City: 'æ¡ƒåœ’å¸‚'
            },
            {
                CCTVID: 'TEST003',
                RoadName: 'å°9ç·šè˜‡èŠ±æ”¹',
                LocationMile: '',
                LocationDescription: 'é‡Œç¨‹ï¼š45.2 å—æ¾³éš§é“å£',
                City: 'å®œè˜­ç¸£'
            },
            {
                CCTVID: 'TEST004',
                RoadName: 'å°61ç·šè¥¿æ¿±å¿«é€Ÿé“è·¯',
                LocationMile: '180å…¬é‡Œ',
                LocationDescription: 'æ–°ç«¹ç³»çµ±äº¤æµé“',
                City: 'æ–°ç«¹ç¸£'
            },
            {
                CCTVID: 'TEST005',
                RoadName: 'å°2ç·šåŒ—éƒ¨æ¿±æµ·å…¬è·¯',
                LocationMile: '25km',
                LocationDescription: 'é‡æŸ³åœ°è³ªå…¬åœ’è·¯å£',
                City: 'æ–°åŒ—å¸‚'
            },
            {
                CCTVID: 'TEST006',
                RoadName: 'å°17ç·š',
                LocationMile: '155K+200',
                LocationDescription: 'è¿‘å¥½ç¾é‡Œæµ·å ¤æ”¶è²»ç«™',
                City: 'å˜‰ç¾©ç¸£'
            }
        ];

        // å¾ road.html è¤‡è£½çš„å‡½æ•¸
        function formatMileageDisplay(camera) {
            const locationMile = camera.LocationMile || '';
            const locationDesc = camera.LocationDescription || '';
            const roadName = camera.RoadName || '';
            const allText = `${locationMile} ${locationDesc} ${roadName}`;
            
            let mileageDisplay = '';
            let segmentInfo = '';
            
            // æå–åŸå§‹é‡Œç¨‹æ ¼å¼
            const mileagePatterns = [
                /(\d+K\+\d+)/i,           // 125K+500 (ä¿æŒåŸæ ¼å¼)
                /(\d+\.?\d*K)/i,          // 125K æˆ– 125.5K
                /(\d+\.?\d*)å…¬é‡Œ/,        // 125å…¬é‡Œ
                /(\d+\.?\d*)km/i,         // 125km
                /é‡Œç¨‹[ï¼š:]\s*(\d+\.?\d*)/ // é‡Œç¨‹ï¼š125
            ];
            
            for (const pattern of mileagePatterns) {
                const match = allText.match(pattern);
                if (match) {
                    mileageDisplay = match[1];
                    // å¦‚æœä¸æ˜¯K+æ ¼å¼ï¼Œè½‰æ›ç‚ºKæ ¼å¼
                    if (!mileageDisplay.includes('K')) {
                        const num = parseFloat(match[1]);
                        mileageDisplay = `${num}K`;
                    }
                    break;
                }
            }
            
            // æå–è·¯æ®µè³‡è¨Šï¼ˆäº¤æµé“ã€æ©‹æ¨‘ã€éš§é“ç­‰åœ°æ¨™ï¼‰
            const segmentPatterns = [
                /([^ï¼Œ,ã€‚\s]*(?:äº¤æµé“|ç³»çµ±äº¤æµé“))/g,     // å„ç¨®äº¤æµé“
                /([^ï¼Œ,ã€‚\s]*(?:æ©‹|å¤§æ©‹|é™¸æ©‹|å¤©æ©‹))/g,     // å„ç¨®æ©‹æ¨‘  
                /([^ï¼Œ,ã€‚\s]*(?:éš§é“))/g,                // éš§é“
                /([^ï¼Œ,ã€‚\s]*(?:æ”¶è²»ç«™|æœå‹™å€))/g,        // æ”¶è²»ç«™ã€æœå‹™å€
                /([^ï¼Œ,ã€‚\s]*(?:åŒé“|è¯çµ¡é“))/g,          // åŒé“ã€è¯çµ¡é“
                /([^ï¼Œ,ã€‚\s]*(?:è·¯å£|åå­—è·¯å£))/g,        // è·¯å£
                /([^ï¼Œ,ã€‚\s]*(?:è»Šç«™|ç«è»Šç«™|é«˜éµç«™))/g,    // è»Šç«™
                /([^ï¼Œ,ã€‚\s]*(?:å·¥æ¥­å€|ç§‘å­¸åœ’å€|å·¥æ¥­åœ’å€))/g, // å·¥æ¥­å€ç­‰
                /(è¿‘\s*[^ï¼Œ,ã€‚\s]+)/g,                   // è¿‘æŸåœ°é»
                /(è·\s*[^ï¼Œ,ã€‚\s]+)/g                    // è·æŸåœ°é»
            ];
            
            const segments = [];
            for (const pattern of segmentPatterns) {
                const matches = allText.match(pattern);
                if (matches) {
                    segments.push(...matches);
                }
            }
            
            // å»é‡ä¸¦å–æœ€ç›¸é—œçš„è·¯æ®µè³‡è¨Šï¼ˆé€šå¸¸æ˜¯æœ€å¾Œä¸€å€‹æˆ–æœ€é•·çš„ï¼‰
            const uniqueSegments = [...new Set(segments)];
            if (uniqueSegments.length > 0) {
                // å„ªå…ˆé¸æ“‡åŒ…å«äº¤æµé“ã€æ©‹ã€éš§é“ç­‰é‡è¦åœ°æ¨™çš„
                const importantSegments = uniqueSegments.filter(seg => 
                    /äº¤æµé“|æ©‹|éš§é“|æ”¶è²»ç«™|æœå‹™å€/.test(seg)
                );
                segmentInfo = importantSegments.length > 0 ? importantSegments[0] : uniqueSegments[0];
            }
            
            return {
                mileage: mileageDisplay,
                segment: segmentInfo
            };
        }

        function runAllTests() {
            const testGrid = document.getElementById('testGrid');
            testGrid.innerHTML = '';
            
            testCameras.forEach((camera, index) => {
                const result = formatMileageDisplay(camera);
                
                const testCard = document.createElement('div');
                testCard.className = 'test-card';
                testCard.innerHTML = `
                    <div class="test-title">æ¸¬è©¦æ¡ˆä¾‹ ${index + 1}: ${camera.RoadName}</div>
                    
                    <div class="test-data">
                        <strong>åŸå§‹æ•¸æ“š:</strong><br>
                        ğŸ“ LocationMile: "${camera.LocationMile}"<br>
                        ğŸ“ LocationDescription: "${camera.LocationDescription}"<br>
                        ğŸ›£ï¸ RoadName: "${camera.RoadName}"
                    </div>
                    
                    <div class="test-result">
                        <strong>è§£æçµæœ:</strong><br>
                        <span class="mileage-info">
                            <i class="fas fa-road"></i> é‡Œç¨‹ï¼š${result.mileage || 'æœªè­˜åˆ¥'}
                            ${result.segment ? `<span class="segment-info">(${result.segment})</span>` : ''}
                        </span>
                    </div>
                `;
                
                testGrid.appendChild(testCard);
            });
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•é‹è¡Œæ¸¬è©¦
        document.addEventListener('DOMContentLoaded', () => {
            runAllTests();
        });
    </script>
</body>
</html>