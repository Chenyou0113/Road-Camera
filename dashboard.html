<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç›£è¦–å™¨å„€è¡¨æ¿ - å°ç£å³æ™‚ç›£æ§ç³»çµ±</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/dark-mode.css">
    <link rel="stylesheet" href="assets/responsive-camera.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>window.CURRENT_PAGE = 'dashboard';</script>
    <script src="assets/config.js"></script>
    <script src="assets/tdx-api.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; background: linear-gradient(135deg, #1e40af 0%, #0891b2 100%); min-height: 100vh; }
        .header { background: white; padding: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        .header h1 { color: #1e40af; text-align: center; margin-bottom: 10px; }
        .header-subtitle { text-align: center; color: #666; margin-bottom: 10px; }
        .back-btn { display: inline-block; padding: 10px 20px; background: #1e40af; color: white; text-decoration: none; border-radius: 5px; margin: 20px 0; }
        .back-btn:hover { background: #5a6fd8; }

        /* å€åŸŸæ¨™é¡Œæ¨£å¼ */
        .status-section h3,
        .chart-section h3 {
            color: #333;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #1e40af;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .status-section h3 i,
        .chart-section h3 i {
            color: #1e40af;
            margin-right: 8px;
        }

        /* å„€è¡¨æ¿çµ±è¨ˆé¢æ¿ */
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #1e40af, #0891b2);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #1e40af, #0891b2);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        .stat-trend {
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .trend-up { color: #0891b2; }
        .trend-down { color: #f44336; }
        .trend-stable { color: #1e40af; }

        /* ç³»çµ±ç‹€æ…‹è¡¨æ ¼ */
        .status-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .status-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .status-table th,
        .status-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .status-table th {
            background: #f8f9fa;
            color: #333;
            font-weight: 600;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online { background: #0891b2; }
        .status-offline { background: #f44336; }
        .status-warning { background: #1e40af; }

        /* åœ–è¡¨å€åŸŸ */
        .chart-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .chart-container {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }

        /* åœ–è¡¨æ§åˆ¶æŒ‰éˆ• */
        .chart-btn {
            background: #f0f0f0;
            border: 1px solid #ddd;
            color: #666;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .chart-btn:hover {
            background: #e0e0e0;
            border-color: #ccc;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .chart-btn.active {
            background: #1e40af;
            color: white;
            border-color: #1e40af;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .chart-btn.active:hover {
            background: #5a6fd8;
            transform: scale(1.05) translateY(-1px);
        }

        /* æŒ‰éˆ•é»æ“Šæ³¢ç´‹æ•ˆæœ */
        .chart-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.3s ease, height 0.3s ease;
            pointer-events: none;
        }

        .chart-btn:active::after {
            width: 120px;
            height: 120px;
        }

        /* åœ–è¡¨å®¹å™¨ç¸®æ”¾å‹•ç•« */
        .chart-container {
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: center;
        }

        .chart-container.scaling {
            transform: scale(0.95);
            opacity: 0.7;
        }

        .chart-container.zoom-in {
            animation: chartZoomIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes chartZoomIn {
            0% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* åœ–è¡¨åŠ è¼‰å‹•ç•« */
        .chart-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            color: #1e40af;
            font-weight: 500;
            z-index: 10;
        }

        .chart-loading .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(102, 126, 234, 0.1);
            border-top: 3px solid #1e40af;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* å³æ™‚æ›´æ–°æŒ‡ç¤ºå™¨ */
        .update-indicator {
            position: fixed;
            top: 20px;
            right: 80px; /* å‘å·¦ç§»å‹•ï¼Œé¿å…èˆ‡æ·±è‰²åˆ‡æ›æŒ‰éˆ•é‡ç–Š */
            background: white;
            padding: 10px 15px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 999; /* é™ä½å±¤ç´šï¼Œé¿å…é®æ“‹æ·±è‰²åˆ‡æ›æŒ‰éˆ• */
            color: #333;
            font-weight: 500;
        }

        .pulse {
            width: 8px;
            height: 8px;
            background: #0891b2;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ - å°è¢å¹•èª¿æ•´ */
        @media (max-width: 768px) {
            .update-indicator {
                position: static;
                margin: 10px auto;
                width: fit-content;
                order: -1; /* è®“æ›´æ–°æŒ‡ç¤ºå™¨é¡¯ç¤ºåœ¨é ‚éƒ¨ */
            }
            
            .container {
                position: relative;
            }
        }

        @media (max-width: 480px) {
            .update-indicator {
                font-size: 0.8rem;
                padding: 8px 12px;
                right: 60px; /* åœ¨å°è¢å¹•ä¸Šé€²ä¸€æ­¥å‘å·¦ç§»å‹• */
            }
        }

        /* è¼‰å…¥å‹•ç•« */
        .loading {
            text-align: center;
            padding: 50px;
            color: white;
            font-size: 1.2rem;
        }

        .loading i {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .dashboard-stats { grid-template-columns: repeat(2, 1fr); }
            .stat-card { padding: 15px; }
            .stat-number { font-size: 1.5rem; }
            .status-table { font-size: 0.9rem; }
        }

        @media (max-width: 480px) {
            .dashboard-stats { grid-template-columns: 1fr; }
        }

        /* æ·±è‰²æ¨¡å¼ */
        body.dark-mode .header-subtitle {
            color: rgba(255,255,255,0.7) !important;
        }
        
        body.dark-mode .stat-card,
        body.dark-mode .status-section,
        body.dark-mode .chart-section {
            background: rgba(40,40,50,0.95);
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* æ·±è‰²æ¨¡å¼ä¸‹çš„æ¨™é¡Œæ¨£å¼ */
        body.dark-mode .status-section h3,
        body.dark-mode .chart-section h3 {
            color: #e0e0e0 !important;
            text-shadow: 0 2px 4px rgba(0,0,0,0.8), 0 0 10px rgba(102, 126, 234, 0.3);
            border-bottom: 2px solid rgba(102, 126, 234, 0.5);
            padding-bottom: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        body.dark-mode .status-section h3 i,
        body.dark-mode .chart-section h3 i {
            color: #1e40af;
            margin-right: 8px;
            text-shadow: 0 0 8px rgba(102, 126, 234, 0.5);
        }

        body.dark-mode .stat-number { color: #e0e0e0; }
        body.dark-mode .stat-label { color: rgba(255,255,255,0.7); }
        body.dark-mode .status-table th { background: rgba(255,255,255,0.05); color: #e0e0e0; }
        body.dark-mode .status-table td { color: rgba(255,255,255,0.8); border-bottom-color: rgba(255,255,255,0.1); }
        body.dark-mode .chart-container { background: rgba(255,255,255,0.05); color: rgba(255,255,255,0.7); }
        body.dark-mode .update-indicator { 
            background: rgba(40,40,50,0.98); 
            border: 2px solid rgba(76, 175, 80, 0.5); 
            color: rgba(255,255,255,0.95);
            text-shadow: 0 2px 4px rgba(0,0,0,0.8), 0 0 8px rgba(76, 175, 80, 0.3);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3), 0 0 0 1px rgba(76, 175, 80, 0.2);
        }
        
        body.dark-mode .update-indicator span {
            font-weight: 600;
            color: rgba(255,255,255,0.95);
            text-shadow: 0 1px 3px rgba(0,0,0,0.9);
        }
        
        /* æš—è‰²æ¨¡å¼åœ–è¡¨æŒ‰éˆ• */
        body.dark-mode .chart-btn {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.8);
        }
        
        body.dark-mode .chart-btn:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        body.dark-mode .chart-btn.active {
            background: #1e40af;
            color: white;
            border-color: #1e40af;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        body.dark-mode .chart-btn.active:hover {
            background: #5a6fd8;
            transform: scale(1.05) translateY(-1px);
        }
        
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„åŠ è¼‰æŒ‡ç¤ºå™¨ */
        body.dark-mode .chart-loading {
            color: #1e40af;
            background: rgba(40, 40, 50, 0.8);
            backdrop-filter: blur(5px);
            padding: 20px;
            border-radius: 10px;
        }
        
        body.dark-mode .chart-loading .spinner {
            border-color: rgba(102, 126, 234, 0.2);
            border-top-color: #1e40af;
        }
        
        /* æ·±è‰²æ¨¡å¼ä¸‹åœ–è¡¨æ¨™ç±¤æ¨£å¼ */
        body.dark-mode label {
            color: rgba(255,255,255,0.9) !important;
            background: rgba(40,40,50,0.9) !important;
        }
        
        body.dark-mode div[style*="background: rgba(255,255,255,0.9)"] {
            background: rgba(40,40,50,0.9) !important;
            color: rgba(255,255,255,0.9) !important;
        }
    </style>
    
    <!-- è¼‰å…¥é€²åº¦æ¢ -->
    <script src="assets/loading-progress.js"></script>
    <script>
        // å„€è¡¨æ¿è¼‰å…¥è¨­å®š
        window.AUTO_START_LOADING = true;
        
        // è‡ªè¨‚è¼‰å…¥é€²åº¦è¿½è¹¤
        let dashboardLoadingSteps = 0;
        const totalSteps = 5; // TDX API, åœ‹é“æ•¸æ“š, çœé“æ•¸æ“š, å…¶ä»–æ•¸æ“š, åœ–è¡¨åˆå§‹åŒ–
        
        function updateDashboardProgress(step, label) {
            dashboardLoadingSteps = Math.min(step, totalSteps);
            const progress = (dashboardLoadingSteps / totalSteps) * 90; // ä¿ç•™10%çµ¦æœ€çµ‚å®Œæˆ
            window.setLoadingProgress(progress);
            if (label) window.updateLoadingLabel(label);
        }
        
        window.addEventListener('DOMContentLoaded', () => {
            window.startLoading({
                labelText: 'åˆå§‹åŒ–å„€è¡¨æ¿...',
                color: '#1e40af',
                showLabel: true
            });
            updateDashboardProgress(1, 'æª¢æŸ¥APIç‹€æ…‹...');
        });
    </script>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1><i class="fas fa-tachometer-alt"></i> ç›£è¦–å™¨å„€è¡¨æ¿</h1>
            <p class="header-subtitle">å³æ™‚ç›£æ§ç³»çµ±ç‹€æ…‹èˆ‡çµ±è¨ˆåˆ†æ</p>
        </div>
    </div>

    <div class="container">
        <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> è¿”å›é¦–é </a>
            <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode" style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #1e40af, #0891b2); color: white; border: none; cursor: pointer; margin-left: 15px; font-size: 1.2rem;">
                <i class="fas fa-moon"></i>
            </button>

        <!-- å³æ™‚æ›´æ–°æŒ‡ç¤ºå™¨ -->
        <div class="update-indicator">
            <div class="pulse"></div>
            <span>å³æ™‚æ›´æ–°ä¸­</span>
        </div>

        <!-- çµ±è¨ˆé¢æ¿ -->
        <div class="dashboard-stats">
            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-video"></i></div>
                <div class="stat-number" id="totalCameras">è¼‰å…¥ä¸­...</div>
                <div class="stat-label">ç›£è¦–å™¨ç¸½æ•¸</div>
                <div class="stat-trend trend-up" id="totalTrend"><i class="fas fa-arrow-up"></i> +0</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                <div class="stat-number" id="onlineCameras">è¼‰å…¥ä¸­...</div>
                <div class="stat-label">ç·šä¸Šç›£è¦–å™¨</div>
                <div class="stat-trend trend-up" id="onlineTrend"><i class="fas fa-arrow-up"></i> 95.2%</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <div class="stat-number" id="offlineCameras">è¼‰å…¥ä¸­...</div>
                <div class="stat-label">é›¢ç·šç›£è¦–å™¨</div>
                <div class="stat-trend trend-down" id="offlineTrend"><i class="fas fa-arrow-down"></i> 4.8%</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                <div class="stat-number" id="lastUpdate">è¼‰å…¥ä¸­...</div>
                <div class="stat-label">æœ€å¾Œæ›´æ–°</div>
                <div class="stat-trend trend-stable" id="updateTrend"><i class="fas fa-sync-alt"></i> è‡ªå‹•</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-road"></i></div>
                <div class="stat-number" id="highwayCameras">è¼‰å…¥ä¸­...</div>
                <div class="stat-label">åœ‹é“ç›£è¦–å™¨</div>
                <div class="stat-trend trend-stable" id="highwayTrend"><i class="fas fa-minus"></i> ç©©å®š</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-traffic-light"></i></div>
                <div class="stat-number" id="roadCameras">è¼‰å…¥ä¸­...</div>
                <div class="stat-label">çœé“ç›£è¦–å™¨</div>
                <div class="stat-trend trend-stable" id="roadTrend"><i class="fas fa-minus"></i> ç©©å®š</div>
            </div>
        </div>

        <!-- ç³»çµ±ç‹€æ…‹è¡¨æ ¼ -->
        <div class="status-section">
            <h3><i class="fas fa-list"></i> ç³»çµ±ç‹€æ…‹æ¦‚è¦½</h3>
            <table class="status-table">
                <thead>
                    <tr>
                        <th>ç³»çµ±åç¨±</th>
                        <th>ç‹€æ…‹</th>
                        <th>ç›£è¦–å™¨æ•¸é‡</th>
                        <th>å¯ç”¨ç‡</th>
                        <th>æœ€å¾Œæª¢æŸ¥</th>
                    </tr>
                </thead>
                <tbody id="systemStatusTable">
                    <tr>
                        <td><i class="fas fa-road"></i> åœ‹é“ç›£è¦–å™¨</td>
                        <td><span class="status-indicator status-online"></span>ç·šä¸Š</td>
                        <td id="highwayCount">è¼‰å…¥ä¸­...</td>
                        <td><span class="trend-up">98.5%</span></td>
                        <td id="highwayLastCheck">è¼‰å…¥ä¸­...</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-traffic-light"></i> çœé“ç›£è¦–å™¨</td>
                        <td><span class="status-indicator status-online"></span>ç·šä¸Š</td>
                        <td id="roadCount">è¼‰å…¥ä¸­...</td>
                        <td><span class="trend-up">96.2%</span></td>
                        <td id="roadLastCheck">è¼‰å…¥ä¸­...</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-tachometer-alt"></i> å¿«é€Ÿé“è·¯ç›£è¦–å™¨</td>
                        <td><span class="status-indicator status-online"></span>ç·šä¸Š</td>
                        <td id="expresswayCount">è¼‰å…¥ä¸­...</td>
                        <td><span class="trend-up">94.7%</span></td>
                        <td id="expresswayLastCheck">è¼‰å…¥ä¸­...</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-droplet"></i> æ°´è³‡æºç›£æ§</td>
                        <td><span class="status-indicator status-warning"></span>éƒ¨åˆ†</td>
                        <td id="waterCount">è¼‰å…¥ä¸­...</td>
                        <td><span class="trend-stable">89.3%</span></td>
                        <td id="waterLastCheck">è¼‰å…¥ä¸­...</td>
                    </tr>
                    <tr>
                        <td><i class="fas fa-mountain"></i> åœŸçŸ³æµç›£æ¸¬</td>
                        <td><span class="status-indicator status-online"></span>ç·šä¸Š</td>
                        <td id="debrisCount">è¼‰å…¥ä¸­...</td>
                        <td><span class="trend-up">92.1%</span></td>
                        <td id="debrisLastCheck">è¼‰å…¥ä¸­...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- åœ–è¡¨å€åŸŸ -->
        <div class="chart-section">
            <h3><i class="fas fa-chart-line"></i> ç›£è¦–å™¨ç‹€æ…‹è¶¨å‹¢</h3>
            <div class="chart-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="display: flex; gap: 10px;">
                        <button id="chart-1h" class="chart-btn" onclick="switchChartPeriod('1h')">1å°æ™‚</button>
                        <button id="chart-3h" class="chart-btn" onclick="switchChartPeriod('3h')">3å°æ™‚</button>
                        <button id="chart-6h" class="chart-btn" onclick="switchChartPeriod('6h')">6å°æ™‚</button>
                        <button id="chart-12h" class="chart-btn" onclick="switchChartPeriod('12h')">12å°æ™‚</button>
                        <button id="chart-24h" class="chart-btn active" onclick="switchChartPeriod('24h')">24å°æ™‚</button>
                        <button id="chart-7d" class="chart-btn" onclick="switchChartPeriod('7d')">7å¤©</button>
                        <button id="chart-30d" class="chart-btn" onclick="switchChartPeriod('30d')">30å¤©</button>
                    </div>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9rem; color: #333; background: rgba(255,255,255,0.9); padding: 4px 8px; border-radius: 4px;">
                            <input type="checkbox" id="autoRefresh" checked> è‡ªå‹•æ›´æ–°
                        </label>
                        <button onclick="refreshChart()" style="background: #1e40af; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                            <i class="fas fa-sync-alt"></i> æ›´æ–°
                        </button>
                    </div>
                </div>
                <div style="position: relative; height: 400px;">
                    <canvas id="availabilityChart"></canvas>
                </div>
                <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem;">
                    <div style="color: #333; background: rgba(255,255,255,0.9); padding: 4px 8px; border-radius: 4px;">
                        <span id="chartLastUpdate">æœ€å¾Œæ›´æ–°: --</span>
                    </div>
                    <div style="background: rgba(255,255,255,0.9); padding: 4px 8px; border-radius: 4px;">
                        <span style="color: #0891b2;">â—</span> åœ‹é“ç›£è¦–å™¨
                        <span style="color: #1e40af; margin-left: 15px;">â—</span> çœé“ç›£è¦–å™¨
                        <span style="color: #1e40af; margin-left: 15px;">â—</span> å¿«é€Ÿé“è·¯
                        <span style="color: #0891b2; margin-left: 15px;">â—</span> ç¸£å¸‚ç›£è¦–å™¨
                    </div>
                </div>
            </div>
        </div>

        <!-- API ç‹€æ…‹ç›£æ§åœ–è¡¨ -->
        <div class="chart-section">
            <h3><i class="fas fa-server"></i> API æœå‹™é‹è¡Œç‹€æ…‹</h3>
            <div class="chart-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button id="api-chart-1h" class="chart-btn" onclick="switchApiChartPeriod('1h')">1å°æ™‚</button>
                        <button id="api-chart-3h" class="chart-btn" onclick="switchApiChartPeriod('3h')">3å°æ™‚</button>
                        <button id="api-chart-6h" class="chart-btn" onclick="switchApiChartPeriod('6h')">6å°æ™‚</button>
                        <button id="api-chart-12h" class="chart-btn" onclick="switchApiChartPeriod('12h')">12å°æ™‚</button>
                        <button id="api-chart-24h" class="chart-btn active" onclick="switchApiChartPeriod('24h')">24å°æ™‚</button>
                    </div>
                    <div style="display: flex; gap: 15px; align-items: center;">
                        <label style="display: flex; align-items: center; gap: 5px; font-size: 0.9rem; color: #333; background: rgba(255,255,255,0.9); padding: 4px 8px; border-radius: 4px;">
                            <input type="checkbox" id="apiAutoRefresh" checked> APIè‡ªå‹•æª¢æ¸¬
                        </label>
                        <button onclick="refreshApiChart()" style="background: #1e40af; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">
                            <i class="fas fa-sync-alt"></i> æª¢æ¸¬
                        </button>
                    </div>
                </div>
                <div style="position: relative; height: 400px;">
                    <canvas id="apiStatusChart"></canvas>
                </div>
                <div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem;">
                    <div style="color: #333; background: rgba(255,255,255,0.9); padding: 4px 8px; border-radius: 4px;">
                        <span id="apiChartLastUpdate">æœ€å¾Œæª¢æ¸¬: --</span>
                    </div>
                    <div style="background: rgba(255,255,255,0.9); padding: 4px 8px; border-radius: 4px;">
                        <span style="color: #0891b2;">â—</span> TDX API
                        <span style="color: #FF5722; margin-left: 15px;">â—</span> æ°´åˆ©ç½² API
                        <span style="color: #1e40af; margin-left: 15px;">â—</span> ç’°ä¿ç½² API
                        <span style="color: #1e40af; margin-left: 15px;">â—</span> è¾²å§”æœƒ API
                        <span style="color: #0891b2; margin-left: 15px;">â—</span> åœ‹ç§‘æœƒ API
                    </div>
                </div>
            </div>
        </div>

        <!-- å³æ™‚å½±åƒå±•ç¤º -->
        <div class="chart-section">
            <h3><i class="fas fa-video"></i> å³æ™‚ç›£è¦–å™¨å½±åƒ</h3>
            <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                <button id="live-highway-btn" class="chart-btn active" onclick="switchLiveView('highway')">
                    <i class="fas fa-road"></i> åœ‹é“
                </button>
                <button id="live-expressway-btn" class="chart-btn" onclick="switchLiveView('expressway')">
                    <i class="fas fa-route"></i> å¿«é€Ÿå…¬è·¯
                </button>
                <button id="live-city-btn" class="chart-btn" onclick="switchLiveView('city')">
                    <i class="fas fa-city"></i> çœé“
                </button>
            </div>
            <div id="live-cameras-container" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px; margin-top: 15px;">
                <div style="text-align: center; padding: 40px; color: #999;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 10px;"></i><br>
                    è¼‰å…¥å³æ™‚å½±åƒä¸­...
                </div>
            </div>
        </div>
    </div>

    <script src="assets/navbar.js"></script>
    <script src="assets/dark-mode.js"></script>
    <script>
        let allSystemsData = {
            highway: { total: 0, online: 0, lastUpdate: null },
            road: { total: 0, online: 0, lastUpdate: null },
            expressway: { total: 0, online: 0, lastUpdate: null },
            water: { total: 0, online: 0, lastUpdate: null },
            debris: { total: 0, online: 0, lastUpdate: null }
        };

        // å³æ™‚å½±åƒç›¸é—œè®Šæ•¸
        let liveViewData = {
            highway: [],
            expressway: [],
            city: []
        };
        let currentLiveView = 'highway';

        // æ•¸å­—å‹•ç•«æ•ˆæœ
        function animateNumber(elementId, targetValue, duration = 1000) {
            const element = document.getElementById(elementId);
            if (!element) return;

            const startValue = parseInt(element.textContent) || 0;
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // ä½¿ç”¨ç·©å‹•å‡½æ•¸
                const easeOutCubic = 1 - Math.pow(1 - progress, 3);
                const currentValue = Math.round(startValue + (targetValue - startValue) * easeOutCubic);
                
                element.textContent = currentValue;
                
                if (progress < 1) {
                    requestAnimationFrame(update);
                }
            }
            
            requestAnimationFrame(update);
        }

        // æ›´æ–°æ™‚é–“é¡¯ç¤º
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-TW');
            document.getElementById('lastUpdate').textContent = timeString;
        }

        // è¼‰å…¥åœ‹é“ç›£è¦–å™¨æ•¸æ“š
        async function loadHighwayData() {
            try {
                console.log('è¼‰å…¥åœ‹é“ç›£è¦–å™¨æ•¸æ“š...');
                
                // é¡¯ç¤ºè¼‰å…¥ä¸­ç‹€æ…‹
                document.getElementById('highwayCameras').textContent = 'è¼‰å…¥ä¸­...';
                document.getElementById('highwayCount').textContent = 'è¼‰å…¥ä¸­...';
                document.getElementById('highwayLastCheck').textContent = 'æª¢æŸ¥ä¸­...';
                
                // æª¢æŸ¥ tdxApi æ˜¯å¦å¯ç”¨
                if (typeof tdxApi === 'undefined' || !tdxApi) {
                    throw new Error('TDX API å°šæœªåˆå§‹åŒ–');
                }
                
                // ä½¿ç”¨ TDX API è¼‰å…¥åœ‹é“ç›£è¦–å™¨ï¼ˆå–®ä¸€ç«¯é»ï¼Œé¿å…éå¤šè«‹æ±‚ï¼‰
                const endpoint = '/v2/Road/Traffic/CCTV/Freeway?$format=JSON';
                
                let response = null;
                
                try {
                    console.log(`ğŸ”„ è¼‰å…¥åœ‹é“ç›£è¦–å™¨: ${endpoint}`);
                    response = await tdxApi.fetchCCTV(endpoint);
                    
                    if (response && Array.isArray(response) && response.length > 0) {
                        console.log(`âœ… åœ‹é“æ•¸æ“šæˆåŠŸ: ${response.length} å€‹ç›£è¦–å™¨`);
                    }
                } catch (fetchError) {
                    console.warn(`âŒ åœ‹é“APIå¤±æ•—:`, fetchError.message);
                    response = null;
                }
                
                if (response && Array.isArray(response) && response.length > 0) {
                    allSystemsData.highway.total = response.length;
                    allSystemsData.highway.online = response.filter(c => 
                        c.VideoImageURL || c.PictureURL || c.LiveVideoImageURL || c.StreamURL
                    ).length;
                    allSystemsData.highway.lastUpdate = new Date();
                    
                    // æ·»åŠ å‹•ç•«æ•ˆæœ
                    animateNumber('highwayCameras', allSystemsData.highway.total);
                    animateNumber('highwayCount', allSystemsData.highway.total);
                    document.getElementById('highwayLastCheck').textContent = new Date().toLocaleTimeString('zh-TW');
                    
                    console.log(`âœ… åœ‹é“ç›£è¦–å™¨è¼‰å…¥æˆåŠŸ: ${allSystemsData.highway.total} å€‹`);
                } else if (response && Array.isArray(response) && response.length === 0) {
                    // API æˆåŠŸä½†ç„¡æ•¸æ“š
                    allSystemsData.highway.total = 0;
                    allSystemsData.highway.online = 0;
                    document.getElementById('highwayCameras').textContent = '0';
                    document.getElementById('highwayCount').textContent = '0';
                    document.getElementById('highwayLastCheck').textContent = new Date().toLocaleTimeString('zh-TW');
                    console.log('âš ï¸ åœ‹é“ç›£è¦–å™¨ï¼šAPI å›æ‡‰æˆåŠŸä½†ç„¡è³‡æ–™');
                } else {
                    throw new Error('ç„¡æ•ˆçš„å›æ‡‰æ ¼å¼');
                }
            } catch (error) {
                console.error('âŒ è¼‰å…¥åœ‹é“æ•¸æ“šéŒ¯èª¤:', error.message);
                
                // ç›´æ¥ä½¿ç”¨å‚™ç”¨æ•¸æ“šï¼Œä¸å†å˜—è©¦ä¼°ç®—é¿å…429éŒ¯èª¤
                const fallbackTotal = 1250;
                allSystemsData.highway.total = fallbackTotal;
                allSystemsData.highway.online = Math.floor(fallbackTotal * 0.985);
                
                animateNumber('highwayCameras', fallbackTotal);
                animateNumber('highwayCount', fallbackTotal);
                document.getElementById('highwayLastCheck').textContent = `${new Date().toLocaleTimeString('zh-TW')} (å‚™ç”¨æ•¸æ“š)`;
                
                console.log(`ğŸ”„ ä½¿ç”¨å‚™ç”¨æ•¸æ“š: ${fallbackTotal} å€‹åœ‹é“ç›£è¦–å™¨`);
            }
        }

        // è¼‰å…¥çœé“ç›£è¦–å™¨æ•¸æ“š
        async function loadRoadData() {
            console.log('è¼‰å…¥çœé“ç›£è¦–å™¨æ•¸æ“š...');
            
            // ç›´æ¥ä½¿ç”¨å‚™ç”¨æ•¸æ“šï¼Œé¿å…429éŒ¯èª¤
            console.log('âš ï¸ ä½¿ç”¨å‚™ç”¨æ•¸æ“šé¿å…APIé™åˆ¶');
            const fallbackTotal = 2180;
            allSystemsData.road.total = fallbackTotal;
            allSystemsData.road.online = Math.floor(fallbackTotal * 0.962);
            
            animateNumber('roadCameras', fallbackTotal);
            animateNumber('roadCount', fallbackTotal);
            document.getElementById('roadLastCheck').textContent = `${new Date().toLocaleTimeString('zh-TW')} (å‚™ç”¨æ•¸æ“š)`;
            
            console.log(`âœ… çœé“å‚™ç”¨æ•¸æ“šå·²è¼‰å…¥: ${fallbackTotal} å€‹ç›£è¦–å™¨`);
        }

        // æ¨¡æ“¬å…¶ä»–ç³»çµ±æ•¸æ“šï¼ˆå› ç‚ºAPIå¯èƒ½ä¸åŒï¼‰
        function loadOtherSystemsData() {
            // å¿«é€Ÿé“è·¯
            allSystemsData.expressway = { total: 156, online: 148, lastUpdate: new Date() };
            
            // æ°´è³‡æº
            allSystemsData.water = { total: 200, online: 178, lastUpdate: new Date() };
            
            // åœŸçŸ³æµ
            allSystemsData.debris = { total: 89, online: 82, lastUpdate: new Date() };
            
            // æ›´æ–°é¡¯ç¤ºï¼ˆä½¿ç”¨å‹•ç•«æ•ˆæœï¼‰
            animateNumber('expresswayCount', allSystemsData.expressway.total);
            document.getElementById('expresswayLastCheck').textContent = new Date().toLocaleTimeString('zh-TW');
            
            animateNumber('waterCount', allSystemsData.water.total);
            document.getElementById('waterLastCheck').textContent = new Date().toLocaleTimeString('zh-TW');
            
            animateNumber('debrisCount', allSystemsData.debris.total);
            document.getElementById('debrisLastCheck').textContent = new Date().toLocaleTimeString('zh-TW');
            
            console.log('âœ… å…¶ä»–ç³»çµ±æ•¸æ“šè¼‰å…¥å®Œæˆ');
        }

        // æ›´æ–°ç¸½é«”çµ±è¨ˆ
        function updateOverallStats() {
            const totalCameras = Object.values(allSystemsData).reduce((sum, system) => sum + system.total, 0);
            const totalOnline = Object.values(allSystemsData).reduce((sum, system) => sum + system.online, 0);
            const totalOffline = totalCameras - totalOnline;
            
            // ä½¿ç”¨å‹•ç•«æ•ˆæœæ›´æ–°æ•¸å­—
            animateNumber('totalCameras', totalCameras, 1500);
            animateNumber('onlineCameras', totalOnline, 1500);
            animateNumber('offlineCameras', totalOffline, 1500);
            
            // æ›´æ–°å¯ç”¨ç‡
            const onlineRate = totalCameras > 0 ? ((totalOnline / totalCameras) * 100).toFixed(1) : 0;
            document.getElementById('onlineTrend').innerHTML = `<i class="fas fa-arrow-up"></i> ${onlineRate}%`;
            
            const offlineRate = totalCameras > 0 ? ((totalOffline / totalCameras) * 100).toFixed(1) : 0;
            document.getElementById('offlineTrend').innerHTML = `<i class="fas fa-arrow-down"></i> ${offlineRate}%`;
            
            console.log(`ğŸ“Š ç¸½é«”çµ±è¨ˆæ›´æ–°: ç¸½æ•¸ ${totalCameras}, ç·šä¸Š ${totalOnline}, é›¢ç·š ${totalOffline}`);
        }

        // ç­‰å¾… TDX API åˆå§‹åŒ–
        async function waitForTdxApi() {
            let attempts = 0;
            const maxAttempts = 30; // æœ€å¤šç­‰å¾…30ç§’
            
            while (attempts < maxAttempts) {
                if (typeof tdxApi !== 'undefined' && tdxApi && typeof tdxApi.fetchCCTV === 'function') {
                    console.log('TDX API å·²å°±ç·’');
                    return true;
                }
                console.log(`ç­‰å¾… TDX API åˆå§‹åŒ–... (${attempts + 1}/${maxAttempts})`);
                await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾…1ç§’
                attempts++;
            }
            
            console.error('TDX API åˆå§‹åŒ–è¶…æ™‚');
            return false;
        }

        // è¼‰å…¥æ‰€æœ‰æ•¸æ“š
        async function loadAllData() {
            console.log('ğŸš€ é–‹å§‹è¼‰å…¥å„€è¡¨æ¿æ•¸æ“š...');
            
            try {
                // ç­‰å¾… TDX API åˆå§‹åŒ–
                updateDashboardProgress(2, 'åˆå§‹åŒ–APIé€£ç·š...');
                const apiReady = await waitForTdxApi();
                
                if (!apiReady) {
                    console.warn('âš ï¸ TDX API æœªå°±ç·’ï¼Œä½¿ç”¨å‚™ç”¨æ•¸æ“š');
                    updateDashboardProgress(3, 'è¼‰å…¥å‚™ç”¨æ•¸æ“š...');
                    loadFallbackData();
                } else {
                    // åºåˆ—è¼‰å…¥æ•¸æ“šä»¥é¿å…429éŒ¯èª¤
                    updateDashboardProgress(3, 'è¼‰å…¥åœ‹é“ç›£è¦–å™¨æ•¸æ“š...');
                    await loadHighwayData();
                    
                    // å»¶é²è¼‰å…¥çœé“æ•¸æ“šï¼Œé¿å…APIé™åˆ¶
                    await new Promise(resolve => setTimeout(resolve, 2000));
                    updateDashboardProgress(3.5, 'è¼‰å…¥çœé“ç›£è¦–å™¨æ•¸æ“š...');
                    await loadRoadData();
                }
                
                updateDashboardProgress(4, 'è¼‰å…¥å…¶ä»–ç³»çµ±æ•¸æ“š...');
                loadOtherSystemsData();
                updateOverallStats();
                updateLastUpdateTime();
                
                updateDashboardProgress(5, 'åˆå§‹åŒ–åœ–è¡¨...');
                console.log('âœ… å„€è¡¨æ¿æ•¸æ“šè¼‰å…¥å®Œæˆ');
                
                // å®Œæˆè¼‰å…¥
                setTimeout(() => {
                    window.finishLoading();
                }, 500);
                
            } catch (error) {
                console.error('âŒ å„€è¡¨æ¿æ•¸æ“šè¼‰å…¥å¤±æ•—:', error);
                updateDashboardProgress(3, 'è¼‰å…¥å‚™ç”¨æ•¸æ“š...');
                loadFallbackData();
                setTimeout(() => {
                    window.finishLoading();
                }, 500);
            }
        }

        // è¼‰å…¥å‚™ç”¨æ•¸æ“š
        function loadFallbackData() {
            console.log('ğŸ”„ è¼‰å…¥å‚™ç”¨æ•¸æ“š...');
            
            // åœ‹é“å‚™ç”¨æ•¸æ“š
            allSystemsData.highway.total = 1250;
            allSystemsData.highway.online = Math.floor(1250 * 0.985);
            animateNumber('highwayCameras', allSystemsData.highway.total);
            animateNumber('highwayCount', allSystemsData.highway.total);
            document.getElementById('highwayLastCheck').textContent = `${new Date().toLocaleTimeString('zh-TW')} (å‚™ç”¨)`;
            
            // çœé“å‚™ç”¨æ•¸æ“š
            allSystemsData.road.total = 2180;
            allSystemsData.road.online = Math.floor(2180 * 0.962);
            animateNumber('roadCameras', allSystemsData.road.total);
            animateNumber('roadCount', allSystemsData.road.total);
            document.getElementById('roadLastCheck').textContent = `${new Date().toLocaleTimeString('zh-TW')} (å‚™ç”¨)`;
            
            console.log('âœ… å‚™ç”¨æ•¸æ“šè¼‰å…¥å®Œæˆ');
        }

        // åœ–è¡¨ç›¸é—œè®Šæ•¸
        let availabilityChart = null;
        let apiStatusChart = null;
        let currentChartPeriod = '24h';
        let currentApiChartPeriod = '24h';
        let chartData = {
            labels: [],
            datasets: [
                {
                    label: 'åœ‹é“ç›£è¦–å™¨',
                    data: [],
                    borderColor: '#0891b2',
                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'çœé“ç›£è¦–å™¨',
                    data: [],
                    borderColor: '#1e40af',
                    backgroundColor: 'rgba(255, 152, 0, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'å¿«é€Ÿé“è·¯',
                    data: [],
                    borderColor: '#1e40af',
                    backgroundColor: 'rgba(33, 150, 243, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'ç¸£å¸‚ç›£è¦–å™¨',
                    data: [],
                    borderColor: '#0891b2',
                    backgroundColor: 'rgba(156, 39, 176, 0.1)',
                    tension: 0.4,
                    fill: true
                }
            ]
        };

        // APIç‹€æ…‹åœ–è¡¨æ•¸æ“š
        let apiChartData = {
            labels: [],
            datasets: [
                {
                    label: 'TDX API',
                    data: [],
                    borderColor: '#0891b2',
                    backgroundColor: 'rgba(76, 175, 80, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'æ°´åˆ©ç½² API',
                    data: [],
                    borderColor: '#FF5722',
                    backgroundColor: 'rgba(255, 87, 34, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'ç’°ä¿ç½² API',
                    data: [],
                    borderColor: '#1e40af',
                    backgroundColor: 'rgba(33, 150, 243, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'è¾²å§”æœƒ API',
                    data: [],
                    borderColor: '#1e40af',
                    backgroundColor: 'rgba(255, 152, 0, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'åœ‹ç§‘æœƒ API',
                    data: [],
                    borderColor: '#0891b2',
                    backgroundColor: 'rgba(156, 39, 176, 0.1)',
                    tension: 0.4,
                    fill: true
                }
            ]
        };

        // åˆå§‹åŒ–åœ–è¡¨
        function initChart() {
            const ctx = document.getElementById('availabilityChart').getContext('2d');
            
            availabilityChart = new Chart(ctx, {
                type: 'line',
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '24å°æ™‚ç›£è¦–å™¨å¯ç”¨ç‡è¶¨å‹¢',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'æ™‚é–“'
                            },
                            grid: {
                                color: 'rgba(200, 200, 200, 0.3)'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'å¯ç”¨ç‡ (%)'
                            },
                            min: 0,
                            max: 100,
                            grid: {
                                color: 'rgba(200, 200, 200, 0.3)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });

            // ç”Ÿæˆåˆå§‹æ•¸æ“š
            generateChartData(currentChartPeriod);
        }

        // åˆå§‹åŒ–APIç‹€æ…‹åœ–è¡¨
        function initApiChart() {
            const ctx = document.getElementById('apiStatusChart').getContext('2d');
            
            apiStatusChart = new Chart(ctx, {
                type: 'line',
                data: apiChartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: '24å°æ™‚ API æœå‹™å¯ç”¨ç‡',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y.toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'æ™‚é–“'
                            },
                            grid: {
                                color: 'rgba(200, 200, 200, 0.3)'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'API å¯ç”¨ç‡ (%)'
                            },
                            min: 0,
                            max: 100,
                            grid: {
                                color: 'rgba(200, 200, 200, 0.3)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });

            // ç”Ÿæˆåˆå§‹APIæ•¸æ“š
            generateApiChartData(currentApiChartPeriod);
        }

        // ç”Ÿæˆåœ–è¡¨æ•¸æ“š
        function generateChartData(period) {
            const now = new Date();
            let labels = [];
            let dataPoints = 4; // 4å€‹ç³»çµ±çš„æ•¸æ“š
            
            // æ ¹æ“šæ™‚é–“é€±æœŸç”Ÿæˆæ¨™ç±¤
            if (period === '1h') {
                // 1å°æ™‚ï¼Œæ¯5åˆ†é˜ä¸€å€‹é»
                for (let i = 11; i >= 0; i--) {
                    const time = new Date(now - i * 5 * 60 * 1000);
                    labels.push(time.getHours() + ':' + String(time.getMinutes()).padStart(2, '0'));
                }
            } else if (period === '3h') {
                // 3å°æ™‚ï¼Œæ¯15åˆ†é˜ä¸€å€‹é»
                for (let i = 11; i >= 0; i--) {
                    const time = new Date(now - i * 15 * 60 * 1000);
                    labels.push(time.getHours() + ':' + String(time.getMinutes()).padStart(2, '0'));
                }
            } else if (period === '6h') {
                // 6å°æ™‚ï¼Œæ¯30åˆ†é˜ä¸€å€‹é»
                for (let i = 11; i >= 0; i--) {
                    const time = new Date(now - i * 30 * 60 * 1000);
                    labels.push(time.getHours() + ':' + String(time.getMinutes()).padStart(2, '0'));
                }
            } else if (period === '12h') {
                // 12å°æ™‚ï¼Œæ¯å°æ™‚ä¸€å€‹é»
                for (let i = 11; i >= 0; i--) {
                    const time = new Date(now - i * 60 * 60 * 1000);
                    labels.push(time.getHours() + ':00');
                }
            } else if (period === '24h') {
                // 24å°æ™‚ï¼Œæ¯2å°æ™‚ä¸€å€‹é»
                for (let i = 11; i >= 0; i--) {
                    const time = new Date(now - i * 2 * 60 * 60 * 1000);
                    labels.push(time.getHours() + ':00');
                }
            } else if (period === '7d') {
                // 7å¤©ï¼Œæ¯å¤©ä¸€å€‹é»
                for (let i = 6; i >= 0; i--) {
                    const date = new Date(now - i * 24 * 60 * 60 * 1000);
                    labels.push((date.getMonth() + 1) + '/' + date.getDate());
                }
            } else if (period === '30d') {
                // 30å¤©ï¼Œæ¯å¤©ä¸€å€‹é»
                for (let i = 29; i >= 0; i--) {
                    const date = new Date(now - i * 24 * 60 * 60 * 1000);
                    labels.push((date.getMonth() + 1) + '/' + date.getDate());
                }
            }

            // ç‚ºæ¯å€‹ç³»çµ±ç”Ÿæˆæ¨¡æ“¬æ•¸æ“š
            chartData.labels = labels;
            
            // åœ‹é“ç›£è¦–å™¨æ•¸æ“šï¼ˆé«˜å¯ç”¨ç‡ï¼‰
            chartData.datasets[0].data = labels.map((_, index) => {
                const base = 95 + Math.random() * 4; // 95-99%
                const trend = Math.sin(index * 0.3) * 2; // è¼•å¾®æ³¢å‹•
                return Math.min(100, Math.max(90, base + trend));
            });

            // çœé“ç›£è¦–å™¨æ•¸æ“š
            chartData.datasets[1].data = labels.map((_, index) => {
                const base = 88 + Math.random() * 8; // 88-96%
                const trend = Math.sin(index * 0.4) * 3;
                return Math.min(100, Math.max(80, base + trend));
            });

            // å¿«é€Ÿé“è·¯æ•¸æ“š
            chartData.datasets[2].data = labels.map((_, index) => {
                const base = 91 + Math.random() * 6; // 91-97%
                const trend = Math.sin(index * 0.2) * 2;
                return Math.min(100, Math.max(85, base + trend));
            });

            // ç¸£å¸‚ç›£è¦–å™¨æ•¸æ“šï¼ˆç¨ä½å¯ç”¨ç‡ï¼‰
            chartData.datasets[3].data = labels.map((_, index) => {
                const base = 82 + Math.random() * 12; // 82-94%
                const trend = Math.sin(index * 0.5) * 4;
                return Math.min(100, Math.max(75, base + trend));
            });

            // æ›´æ–°åœ–è¡¨
            if (availabilityChart) {
                availabilityChart.update();
            }

            // æ›´æ–°æœ€å¾Œæ›´æ–°æ™‚é–“
            updateChartLastUpdate();
        }

        // åˆ‡æ›åœ–è¡¨æ™‚é–“é€±æœŸ
        function switchChartPeriod(period) {
            currentChartPeriod = period;
            
            // ç²å–åœ–è¡¨å®¹å™¨
            const chartContainer = document.querySelector('.chart-section');
            const canvas = document.getElementById('availabilityChart');
            
            // æ·»åŠ ç¸®æ”¾å‹•ç•«
            chartContainer.classList.add('scaling');
            
            // é¡¯ç¤ºåŠ è¼‰æŒ‡ç¤ºå™¨
            showChartLoading();
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆå¸¶å‹•ç•«æ•ˆæœï¼‰
            document.querySelectorAll('[id^="chart-"]').forEach(btn => {
                btn.classList.remove('active');
                btn.style.transform = 'scale(1)';
            });
            
            const activeBtn = document.getElementById(`chart-${period}`);
            activeBtn.classList.add('active');
            
            // æŒ‰éˆ•å‹•ç•«
            activeBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                activeBtn.style.transform = 'scale(1.05)';
            }, 100);
            
            // æ›´æ–°åœ–è¡¨æ¨™é¡Œ
            let title = '';
            if (period === '1h') title = '1å°æ™‚ç›£è¦–å™¨å¯ç”¨ç‡è¶¨å‹¢';
            else if (period === '3h') title = '3å°æ™‚ç›£è¦–å™¨å¯ç”¨ç‡è¶¨å‹¢';
            else if (period === '6h') title = '6å°æ™‚ç›£è¦–å™¨å¯ç”¨ç‡è¶¨å‹¢';
            else if (period === '12h') title = '12å°æ™‚ç›£è¦–å™¨å¯ç”¨ç‡è¶¨å‹¢';
            else if (period === '24h') title = '24å°æ™‚ç›£è¦–å™¨å¯ç”¨ç‡è¶¨å‹¢';
            else if (period === '7d') title = '7å¤©ç›£è¦–å™¨å¯ç”¨ç‡è¶¨å‹¢';
            else if (period === '30d') title = '30å¤©ç›£è¦–å™¨å¯ç”¨ç‡è¶¨å‹¢';
            
            // å»¶é²æ›´æ–°åœ–è¡¨ä»¥é…åˆå‹•ç•«
            setTimeout(() => {
                if (availabilityChart) {
                    availabilityChart.options.plugins.title.text = title;
                    generateChartData(period);
                }
                
                // å‹•ç•«å®Œæˆå¾Œç§»é™¤ç¸®æ”¾æ•ˆæœ
                setTimeout(() => {
                    chartContainer.classList.remove('scaling');
                    chartContainer.classList.add('zoom-in');
                    hideChartLoading();
                    
                    // æ¸…ç†å‹•ç•«é¡
                    setTimeout(() => {
                        chartContainer.classList.remove('zoom-in');
                    }, 600);
                }, 300);
            }, 200);
        }
        
        // é¡¯ç¤ºåœ–è¡¨åŠ è¼‰æŒ‡ç¤ºå™¨
        function showChartLoading() {
            const chartContainer = document.querySelector('.chart-section');
            const existing = chartContainer.querySelector('.chart-loading');
            if (!existing) {
                const loading = document.createElement('div');
                loading.className = 'chart-loading';
                loading.innerHTML = `
                    <div class="spinner"></div>
                    <div>è¼‰å…¥${currentChartPeriod}æ•¸æ“šä¸­...</div>
                `;
                chartContainer.style.position = 'relative';
                chartContainer.appendChild(loading);
            }
        }
        
        // éš±è—åœ–è¡¨åŠ è¼‰æŒ‡ç¤ºå™¨
        function hideChartLoading() {
            const loading = document.querySelector('.chart-loading');
            if (loading) {
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.remove();
                }, 300);
            }
        }

        // åˆ·æ–°åœ–è¡¨
        function refreshChart() {
            generateChartData(currentChartPeriod);
            
            // é¡¯ç¤ºåˆ·æ–°å‹•ç•«
            const btn = event.target.closest('button');
            const icon = btn.querySelector('i');
            icon.style.animation = 'spin 1s linear';
            setTimeout(() => {
                icon.style.animation = '';
            }, 1000);
        }

        // ç”ŸæˆAPIåœ–è¡¨æ•¸æ“š
        function generateApiChartData(period) {
            const now = new Date();
            let labels = [];
            
            // æ ¹æ“šæ™‚é–“é€±æœŸç”Ÿæˆæ¨™ç±¤
            if (period === '1h') {
                // 1å°æ™‚ï¼Œæ¯5åˆ†é˜ä¸€å€‹é»
                for (let i = 11; i >= 0; i--) {
                    const time = new Date(now - i * 5 * 60 * 1000);
                    labels.push(time.getHours() + ':' + String(time.getMinutes()).padStart(2, '0'));
                }
            } else if (period === '3h') {
                // 3å°æ™‚ï¼Œæ¯15åˆ†é˜ä¸€å€‹é»
                for (let i = 11; i >= 0; i--) {
                    const time = new Date(now - i * 15 * 60 * 1000);
                    labels.push(time.getHours() + ':' + String(time.getMinutes()).padStart(2, '0'));
                }
            } else if (period === '6h') {
                // 6å°æ™‚ï¼Œæ¯30åˆ†é˜ä¸€å€‹é»
                for (let i = 11; i >= 0; i--) {
                    const time = new Date(now - i * 30 * 60 * 1000);
                    labels.push(time.getHours() + ':' + String(time.getMinutes()).padStart(2, '0'));
                }
            } else if (period === '12h') {
                // 12å°æ™‚ï¼Œæ¯å°æ™‚ä¸€å€‹é»
                for (let i = 11; i >= 0; i--) {
                    const time = new Date(now - i * 60 * 60 * 1000);
                    labels.push(time.getHours() + ':00');
                }
            } else if (period === '24h') {
                // 24å°æ™‚ï¼Œæ¯2å°æ™‚ä¸€å€‹é»
                for (let i = 11; i >= 0; i--) {
                    const time = new Date(now - i * 2 * 60 * 60 * 1000);
                    labels.push(time.getHours() + ':00');
                }
            }

            // æ›´æ–°æ¨™ç±¤
            apiChartData.labels = labels;
            
            // TDX APIæ•¸æ“šï¼ˆé«˜å¯ç”¨ç‡ï¼‰
            apiChartData.datasets[0].data = labels.map((_, index) => {
                const base = 96 + Math.random() * 3; // 96-99%
                const trend = Math.sin(index * 0.2) * 1;
                return Math.min(100, Math.max(90, base + trend));
            });

            // æ°´åˆ©ç½² APIæ•¸æ“šï¼ˆä¸­ç­‰å¯ç”¨ç‡ï¼‰
            apiChartData.datasets[1].data = labels.map((_, index) => {
                const base = 85 + Math.random() * 10; // 85-95%
                const trend = Math.sin(index * 0.3) * 3;
                return Math.min(100, Math.max(70, base + trend));
            });

            // ç’°ä¿ç½² APIæ•¸æ“š
            apiChartData.datasets[2].data = labels.map((_, index) => {
                const base = 90 + Math.random() * 8; // 90-98%
                const trend = Math.sin(index * 0.25) * 2;
                return Math.min(100, Math.max(80, base + trend));
            });

            // è¾²å§”æœƒ APIæ•¸æ“š
            apiChartData.datasets[3].data = labels.map((_, index) => {
                const base = 88 + Math.random() * 7; // 88-95%
                const trend = Math.sin(index * 0.4) * 4;
                return Math.min(100, Math.max(75, base + trend));
            });

            // åœ‹ç§‘æœƒ APIæ•¸æ“š
            apiChartData.datasets[4].data = labels.map((_, index) => {
                const base = 93 + Math.random() * 5; // 93-98%
                const trend = Math.sin(index * 0.35) * 2;
                return Math.min(100, Math.max(85, base + trend));
            });

            // æ›´æ–°åœ–è¡¨
            if (apiStatusChart) {
                apiStatusChart.update();
            }

            // æ›´æ–°æœ€å¾Œæª¢æ¸¬æ™‚é–“
            updateApiChartLastUpdate();
        }

        // åˆ‡æ›APIåœ–è¡¨æ™‚é–“é€±æœŸ
        function switchApiChartPeriod(period) {
            currentApiChartPeriod = period;
            
            // ç²å–APIåœ–è¡¨å®¹å™¨
            const apiChartContainers = document.querySelectorAll('.chart-section');
            const apiChartContainer = apiChartContainers[1]; // ç¬¬äºŒå€‹åœ–è¡¨å®¹å™¨
            
            // æ·»åŠ ç¸®æ”¾å‹•ç•«
            apiChartContainer.classList.add('scaling');
            
            // é¡¯ç¤ºAPIåœ–è¡¨åŠ è¼‰æŒ‡ç¤ºå™¨
            showApiChartLoading();
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹ï¼ˆå¸¶å‹•ç•«æ•ˆæœï¼‰
            document.querySelectorAll('[id^="api-chart-"]').forEach(btn => {
                btn.classList.remove('active');
                btn.style.transform = 'scale(1)';
            });
            
            const activeBtn = document.getElementById(`api-chart-${period}`);
            activeBtn.classList.add('active');
            
            // æŒ‰éˆ•å‹•ç•«
            activeBtn.style.transform = 'scale(0.95)';
            setTimeout(() => {
                activeBtn.style.transform = 'scale(1.05)';
            }, 100);
            
            // æ›´æ–°åœ–è¡¨æ¨™é¡Œ
            let title = '';
            if (period === '1h') title = '1å°æ™‚ API æœå‹™å¯ç”¨ç‡';
            else if (period === '3h') title = '3å°æ™‚ API æœå‹™å¯ç”¨ç‡';
            else if (period === '6h') title = '6å°æ™‚ API æœå‹™å¯ç”¨ç‡';
            else if (period === '12h') title = '12å°æ™‚ API æœå‹™å¯ç”¨ç‡';
            else if (period === '24h') title = '24å°æ™‚ API æœå‹™å¯ç”¨ç‡';
            
            // å»¶é²æ›´æ–°åœ–è¡¨ä»¥é…åˆå‹•ç•«
            setTimeout(() => {
                if (apiStatusChart) {
                    apiStatusChart.options.plugins.title.text = title;
                    generateApiChartData(period);
                }
                
                // å‹•ç•«å®Œæˆå¾Œç§»é™¤ç¸®æ”¾æ•ˆæœ
                setTimeout(() => {
                    apiChartContainer.classList.remove('scaling');
                    apiChartContainer.classList.add('zoom-in');
                    hideApiChartLoading();
                    
                    // æ¸…ç†å‹•ç•«é¡
                    setTimeout(() => {
                        apiChartContainer.classList.remove('zoom-in');
                    }, 600);
                }, 300);
            }, 200);
        }
        
        // é¡¯ç¤ºAPIåœ–è¡¨åŠ è¼‰æŒ‡ç¤ºå™¨
        function showApiChartLoading() {
            const apiChartContainers = document.querySelectorAll('.chart-section');
            const apiChartContainer = apiChartContainers[1];
            const existing = apiChartContainer.querySelector('.chart-loading');
            if (!existing) {
                const loading = document.createElement('div');
                loading.className = 'chart-loading';
                loading.innerHTML = `
                    <div class="spinner"></div>
                    <div>è¼‰å…¥API ${currentApiChartPeriod}æ•¸æ“šä¸­...</div>
                `;
                apiChartContainer.style.position = 'relative';
                apiChartContainer.appendChild(loading);
            }
        }
        
        // éš±è—APIåœ–è¡¨åŠ è¼‰æŒ‡ç¤ºå™¨
        function hideApiChartLoading() {
            const apiChartContainers = document.querySelectorAll('.chart-section');
            const apiChartContainer = apiChartContainers[1];
            const loading = apiChartContainer.querySelector('.chart-loading');
            if (loading) {
                loading.style.opacity = '0';
                setTimeout(() => {
                    loading.remove();
                }, 300);
            }
        }

        // åˆ·æ–°APIåœ–è¡¨
        function refreshApiChart() {
            generateApiChartData(currentApiChartPeriod);
            
            // é¡¯ç¤ºåˆ·æ–°å‹•ç•«
            const btn = event.target.closest('button');
            const icon = btn.querySelector('i');
            icon.style.animation = 'spin 1s linear';
            setTimeout(() => {
                icon.style.animation = '';
            }, 1000);
        }

        // æ›´æ–°APIåœ–è¡¨æœ€å¾Œæª¢æ¸¬æ™‚é–“
        function updateApiChartLastUpdate() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-TW');
            const element = document.getElementById('apiChartLastUpdate');
            if (element) {
                element.textContent = `æœ€å¾Œæª¢æ¸¬: ${timeString}`;
            }
        }

        // è‡ªå‹•æ›´æ–°APIåœ–è¡¨ï¼ˆå¦‚æœå•Ÿç”¨ï¼‰
        function autoUpdateApiChart() {
            const autoRefresh = document.getElementById('apiAutoRefresh');
            if (autoRefresh && autoRefresh.checked) {
                generateApiChartData(currentApiChartPeriod);
            }
        }

        // æ›´æ–°åœ–è¡¨æœ€å¾Œæ›´æ–°æ™‚é–“
        function updateChartLastUpdate() {
            const now = new Date();
            const timeString = now.toLocaleString('zh-TW');
            const element = document.getElementById('chartLastUpdate');
            if (element) {
                element.textContent = `æœ€å¾Œæ›´æ–°: ${timeString}`;
            }
        }

        // è‡ªå‹•æ›´æ–°åœ–è¡¨ï¼ˆå¦‚æœå•Ÿç”¨ï¼‰
        function autoUpdateChart() {
            const autoRefresh = document.getElementById('autoRefresh');
            if (autoRefresh && autoRefresh.checked) {
                generateChartData(currentChartPeriod);
            }
        }

        // æ·»åŠ æ—‹è½‰å‹•ç•«CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        // å®šæœŸæ›´æ–°æ•¸æ“šï¼ˆæš«æ™‚ç¦ç”¨ï¼‰
        function startAutoUpdate() {
            console.log('âš ï¸ è‡ªå‹•æ›´æ–°å·²æš«æ™‚ç¦ç”¨ä»¥é¿å…APIé™åˆ¶');
            // æš«æ™‚ç¦ç”¨è‡ªå‹•æ•¸æ“šæ›´æ–°
            /* setInterval(() => {
                console.log('â° åŸ·è¡Œå®šæœŸæ›´æ–°ï¼ˆæ¯5åˆ†é˜ï¼‰');
                loadAllData();
                autoUpdateChart();
                autoUpdateApiChart();
            }, 300000); */
            
            setInterval(() => {
                updateLastUpdateTime();
            }, 1000);
        }

        // é é¢è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
        window.onload = function() {
            console.log('ğŸ¯ é é¢è¼‰å…¥å®Œæˆï¼Œé–‹å§‹åˆå§‹åŒ–...');
            console.log('TDX_CONFIG:', typeof TDX_CONFIG !== 'undefined' ? 'âœ… OK' : 'âŒ MISSING');
            console.log('tdxApi:', typeof tdxApi !== 'undefined' ? 'âœ… OK' : 'âŒ MISSING');
            
            // ç«‹å³è¼‰å…¥æ•¸æ“š
            loadAllData();
            
            // åˆå§‹åŒ–åœ–è¡¨
            setTimeout(() => {
                try {
                    initChart(); // åˆå§‹åŒ–ç›£è¦–å™¨å¯ç”¨ç‡åœ–è¡¨
                    initApiChart(); // åˆå§‹åŒ–APIç‹€æ…‹åœ–è¡¨
                    console.log('ğŸ“Š åœ–è¡¨åˆå§‹åŒ–å®Œæˆ');
                } catch (error) {
                    console.error('ğŸ“Š åœ–è¡¨åˆå§‹åŒ–å¤±æ•—:', error);
                }
            }, 2000);
            
            // é–‹å§‹è‡ªå‹•æ›´æ–°
            startAutoUpdate();
        };

        // å¦‚æœé é¢åœ¨è¼‰å…¥éç¨‹ä¸­ï¼Œç«‹å³åŸ·è¡ŒåŸºæœ¬åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ DOM è¼‰å…¥å®Œæˆï¼Œæº–å‚™é¡¯ç¤ºåˆå§‹ç‹€æ…‹...');
            
            // ç«‹å³é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            const elements = [
                'highwayCount', 'roadCount', 'expresswayCount', 'waterCount', 'debrisCount',
                'highwayLastCheck', 'roadLastCheck', 'expresswayLastCheck', 'waterLastCheck', 'debrisLastCheck'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element && element.textContent.includes('è¼‰å…¥ä¸­')) {
                    element.textContent = 'æº–å‚™ä¸­...';
                }
            });
        });

        // å³æ™‚å½±åƒåŠŸèƒ½
        function switchLiveView(type) {
            currentLiveView = type;
            document.querySelectorAll('[id^="live-"]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`live-${type}-btn`).classList.add('active');
            displayLiveView(type);
        }

        function displayLiveView(type) {
            const container = document.getElementById('live-cameras-container');
            const cameras = liveViewData[type] || [];
            
            if (cameras.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999; grid-column: 1/-1;">
                        <i class="fas fa-video-slash" style="font-size: 2rem; margin-bottom: 10px;"></i><br>
                        ç›®å‰æ²’æœ‰å¯ç”¨çš„å³æ™‚å½±åƒ
                    </div>
                `;
                return;
            }
            
            const html = cameras.slice(0, 12).map((camera, index) => {
                const imageUrl = camera.VideoImageUrl || camera.VideoImageURL || camera.VideoStreamURL || camera.PictureURL || '';
                const title = camera.RoadName || camera.FreewayNumber || 'ç›£è¦–å™¨';
                const location = camera.LocationMile || camera.LocationDescription || camera.City || '';
                
                return `
                    <div style="border: 1px solid #ddd; border-radius: 8px; overflow: hidden; background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="height: 200px; background: #f0f0f0; position: relative; overflow: hidden;">
                            ${imageUrl ? 
                                `<img src="${imageUrl}" alt="${title}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.style.display='none'; this.parentNode.innerHTML+='<div style=\"display:flex;align-items:center;justify-content:center;height:100%;color:#999;\"><i class=\"fas fa-exclamation-triangle\" style=\"font-size:1.5rem;\"></i></div>'">` :
                                `<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#ccc;"><i class="fas fa-video-slash" style="font-size:2rem;"></i></div>`
                            }
                        </div>
                        <div style="padding: 12px;">
                            <h4 style="margin: 0 0 8px 0; color: #1e40af; font-size: 0.95rem;">${title}</h4>
                            <p style="margin: 0 0 4px 0; font-size: 0.85rem; color: #666;">
                                <i class="fas fa-map-marker-alt" style="color: #FF9800;"></i> ${location}
                            </p>
                            <p style="margin: 0; font-size: 0.75rem; color: #999;">
                                <i class="fas fa-camera"></i> ${camera.CCTVID || 'æœªçŸ¥'}
                            </p>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html || '<div style="text-align: center; padding: 40px; color: #999; grid-column: 1/-1;">ç„¡å¯ç”¨å½±åƒ</div>';
        }

        // è¼‰å…¥å³æ™‚å½±åƒæ•¸æ“š
        async function loadLiveViewData() {
            try {
                // è¼‰å…¥åœ‹é“
                const hwayResponse = await tdxApi.fetchCCTV('/v2/Road/Traffic/CCTV/Freeway?$format=JSON');
                if (hwayResponse && Array.isArray(hwayResponse)) {
                    liveViewData.highway = hwayResponse.slice(0, 12);
                } else if (hwayResponse && hwayResponse.data && Array.isArray(hwayResponse.data)) {
                    liveViewData.highway = hwayResponse.data.slice(0, 12);
                }
                
                // è¼‰å…¥å¿«é€Ÿå…¬è·¯
                const expayResponse = await tdxApi.fetchCCTV('/v2/Road/Traffic/CCTV/ExpressWay?$format=JSON');
                if (expayResponse && Array.isArray(expayResponse)) {
                    liveViewData.expressway = expayResponse.slice(0, 12);
                } else if (expayResponse && expayResponse.data && Array.isArray(expayResponse.data)) {
                    liveViewData.expressway = expayResponse.data.slice(0, 12);
                }
                
                // è¼‰å…¥çœé“ï¼ˆä½¿ç”¨Highwayç«¯é»ä¸¦ç¯©é¸ï¼‰
                const provResponse = await tdxApi.fetchCCTV('/v2/Road/Traffic/CCTV/Highway?$format=JSON');
                if (provResponse && Array.isArray(provResponse)) {
                    liveViewData.city = provResponse.slice(0, 12);
                } else if (provResponse && provResponse.data && Array.isArray(provResponse.data)) {
                    liveViewData.city = provResponse.data.slice(0, 12);
                }
                
                displayLiveView('highway');
            } catch (error) {
                console.error('è¼‰å…¥å³æ™‚å½±åƒå¤±æ•—:', error);
                document.getElementById('live-cameras-container').innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999; grid-column: 1/-1;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 10px;"></i><br>
                        è¼‰å…¥å³æ™‚å½±åƒå¤±æ•—
                    </div>
                `;
            }
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œè¼‰å…¥å³æ™‚å½±åƒ
        window.addEventListener('load', () => {
            setTimeout(loadLiveViewData, 2000);
        });
        });
    </script>

    <!-- Back to Top Button -->
    <div class="back-to-top" id="backToTop" style="position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; background: linear-gradient(135deg, #1e40af, #0891b2); border-radius: 50%; display: none; align-items: center; justify-content: center; color: white; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 999; font-size: 1.2rem;">
        <i class="fas fa-arrow-up"></i>
    </div>
</body>
</html>
