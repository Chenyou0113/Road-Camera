# 降雨雷達整合回波圖更新文檔

## 更新日期
2025年11月10日

## 新增功能

### 1. 整合雷達資料源（2個新增）

已新增中央氣象署提供的兩個整合雷達回波圖資料：

#### 📍 雷達整合回波圖 - 臺灣(鄰近區域)_無地形
- **資料編碼**: O-A0058-003
- **覆蓋範圍**: 台灣鄰近區域
- **API URL**: https://opendata.cwa.gov.tw/fileapi/v1/opendataapi/O-A0058-003
- **特色**: 較小範圍，細節更清晰

#### 🌐 雷達整合回波圖 - 臺灣(較大範圍)_無地形
- **資料編碼**: O-A0058-001
- **覆蓋範圍**: 台灣較大範圍
- **API URL**: https://opendata.cwa.gov.tw/fileapi/v1/opendataapi/O-A0058-001
- **特色**: 涵蓋範圍大，包括鄰近海域

### 2. 現有個站雷達（保留）

繼續支援原有3個個站雷達：
- 🎯 樹林雷達 (O-A0084-001) - 新北市
- 🎯 南屯雷達 (O-A0084-002) - 台中市
- 🎯 林園雷達 (O-A0084-003) - 高雄市

## 系統架構改變

### RadarTransformer.js 更新

#### 新增方法
```javascript
// 按類型取得雷達（個站或整合）
RadarTransformer.getStationsByType(type)
// type 可為: 'individual' | 'integrated'
```

#### 更新的雷達站點配置
每個雷達站點現在包含：
```javascript
{
    code: '101',              // 唯一代碼
    name: 'xxx',              // 顯示名稱
    type: 'integrated',       // 'individual' 或 'integrated'
    dataId: 'O-A0058-003',    // CWA 資料編碼
    coverage: '鄰近區域',      // (整合雷達專用)
    // ... 其他欄位保持不變
}
```

#### 更新的統計面板
新增統計資訊：
- 📡 雷達資料源總數
- 🎯 個站雷達數量
- 🌐 整合雷達數量
- 📍 涵蓋縣市數
- 🔄 更新頻率

### rainfall-radar.html 頁面更新

#### 視覺分組
頁面現在分為兩個主要部分：

1. **🎯 個站雷達** 區域
   - 顯示3個地點特定的雷達
   - 適合查看特定地區的詳細降雨情況

2. **🌐 整合雷達** 區域
   - 顯示2個涵蓋全台的整合回波圖
   - 適合查看全台降雨總體分佈

#### 新增的 CSS 樣式
```css
.section-separator {
    邊界線分隔符
    視覺上區分不同類型雷達
}
```

## API 端點

### 整合雷達 API
```
基礎 URL: https://opendata.cwa.gov.tw/fileapi/v1/opendataapi

完整請求示例:
- 鄰近區域: /O-A0058-003?Authorization={KEY}&downloadType=WEB&format=JSON
- 較大範圍: /O-A0058-001?Authorization={KEY}&downloadType=WEB&format=JSON

授權金鑰: CWA-675CED45-09DF-4249-9599-B9B5A5AB761A
```

## 功能特性

### 1. 多層級降雨監測
- **個站雷達**: 3個地點監測 + 3個高精度雷達
- **整合雷達**: 2個全台範圍不同尺度的回波圖
- **總計**: 5個不同的雷達資料源

### 2. 智能分類顯示
- 自動分組顯示個站和整合雷達
- 統計面板自動計算各類型數量
- 便於用戶快速找到需要的資料

### 3. 統一的操作介面
- 所有雷達卡片採用相同設計
- 統一的模態視窗查看詳細資訊
- 統一的刷新和下載功能

## 使用說明

### 查看雷達資料
1. 訪問 `rainfall-radar.html`
2. 選擇查看：
   - 🎯 個站雷達 - 了解特定地區降雨
   - 🌐 整合雷達 - 了解全台降雨分佈

### 刷新資料
- 手動刷新: 點擊 "🔄 刷新資料" 按鈕
- 自動刷新: 每 10 分鐘自動更新一次

### 下載影像
- 點擊卡片進入詳細視窗
- 點擊 "⬇️ 下載回波圖" 按鈕
- 直接下載高解析度原始影像

## 技術細節

### 資料結構
```javascript
{
    code: 'station-code',           // 唯一標識
    name: 'Display Name',           // 顯示名稱
    type: 'individual|integrated',  // 類型
    imageUrl: 'https://...',        // 影像 URL
    timestamp: '2025-11-10T...',    // 更新時間
    fileSize: 12345,                // 檔案大小（位元組）
    error: null|'error message'     // 錯誤資訊
}
```

### 排序邏輯
- 個站雷達按照代碼 001-003 排序
- 整合雷達按照代碼 101-102 排序
- 每組內自動排序（由 getAllRadarEchoMaps 決定）

## 相容性

- ✅ 所有現有功能保留
- ✅ 向後相容（舊代碼仍可使用）
- ✅ 新增方法不影響現有方法
- ✅ 頁面佈局自適應所有螢幕尺寸

## 未來擴展

可考慮的未來功能：
- 允許用戶自訂顯示的雷達類型
- 新增時間軸回放功能
- 疊加地形或警戒區域
- 整合降雨預警通知

## 檔案修改列表

### 修改的檔案
1. `assets/radar-transformer.js`
   - 新增 2 個整合雷達站點配置
   - 新增 `getStationsByType()` 方法
   - 更新 `createStatsPanel()` 方法

2. `rainfall-radar.html`
   - 新增 `.section-separator` 樣式
   - 新增分開的雷達網格容器
   - 更新 `renderRadarCards()` 方法

### 新增的檔案
- `RADAR_INTEGRATION_UPDATE.md` (此文檔)

## 驗證清單

- ✅ 新增 2 個整合雷達配置
- ✅ 雷達代碼正確（101-102）
- ✅ API 端點有效
- ✅ 頁面分組顯示
- ✅ 統計面板更新
- ✅ 模態視窗保持功能
- ✅ 刷新和下載功能
- ✅ 錯誤處理完整

## 測試步驟

1. **載入頁面**
   ```
   訪問: rainfall-radar.html
   預期: 頁面正常載入，顯示兩個部分
   ```

2. **驗證個站雷達**
   ```
   預期: 显示樹林、南屯、林園三個雷達卡片
   ```

3. **驗證整合雷達**
   ```
   預期: 顯示台灣(鄰近區域)和台灣(較大範圍)兩個整合卡片
   ```

4. **統計面板**
   ```
   預期: 顯示 5 個雷達資料源、3 個個站、2 個整合
   ```

5. **刷新功能**
   ```
   預期: 點擊刷新按鈕，所有雷達資料重新載入
   ```

6. **詳細視窗**
   ```
   預期: 點擊卡片，模態視窗顯示詳細資訊和影像
   ```

## 支援資訊

如有問題或建議，請檢查：
1. 瀏覽器控制台是否有錯誤訊息
2. CWA API 授權金鑰是否有效
3. 網路連接是否正常
4. RadarTransformer.js 是否正確載入

---
**版本**: 1.1  
**最後更新**: 2025-11-10  
**狀態**: ✅ 生產就緒
