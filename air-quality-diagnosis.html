<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>空品測站診斷</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .debug { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        .warning { color: orange; font-weight: bold; }
    </style>
</head>
<body>
    <h1>空氣品質頁面診斷工具</h1>
    
    <div class="debug">
        <h3>JavaScript 載入測試</h3>
        <div id="jsTest">測試中...</div>
    </div>
    
    <div class="debug">
        <h3>DOM 元素檢查</h3>
        <div id="domTest">檢查中...</div>
    </div>
    
    <div class="debug">
        <h3>函數定義檢查</h3>
        <div id="functionTest">檢查中...</div>
    </div>
    
    <div class="debug">
        <h3>資料載入測試</h3>
        <div id="dataTest">測試中...</div>
    </div>
    
    <div class="debug">
        <h3>控制台訊息</h3>
        <div id="consoleMessages"></div>
    </div>

    <script>
        // 攔截控制台訊息
        const originalLog = console.log;
        const originalError = console.error;
        const consoleDiv = document.getElementById('consoleMessages');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleDiv.innerHTML += '<div style="color: blue;">[LOG] ' + args.join(' ') + '</div>';
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            consoleDiv.innerHTML += '<div class="error">[ERROR] ' + args.join(' ') + '</div>';
        };

        // 測試 1: JavaScript 基本功能
        document.getElementById('jsTest').innerHTML = '<span class="success">✓ JavaScript 正常運作</span>';
        
        // 測試 2: 載入原始頁面的 JavaScript 代碼進行測試
        fetch('air-quality.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('domTest').innerHTML = '<span class="success">✓ 可以讀取 air-quality.html</span>';
                
                // 檢查是否包含關鍵函數
                const hasLoadCameras = html.includes('function loadCameras');
                const hasLoadMockData = html.includes('function loadMockData');
                const hasDOMContentLoaded = html.includes('DOMContentLoaded');
                
                let functionStatus = '';
                if (hasLoadCameras) functionStatus += '<div class="success">✓ loadCameras 函數存在</div>';
                else functionStatus += '<div class="error">✗ loadCameras 函數缺失</div>';
                
                if (hasLoadMockData) functionStatus += '<div class="success">✓ loadMockData 函數存在</div>';
                else functionStatus += '<div class="error">✗ loadMockData 函數缺失</div>';
                
                if (hasDOMContentLoaded) functionStatus += '<div class="success">✓ DOMContentLoaded 事件處理存在</div>';
                else functionStatus += '<div class="error">✗ DOMContentLoaded 事件處理缺失</div>';
                
                document.getElementById('functionTest').innerHTML = functionStatus;
                
                // 檢查 HTML 結構
                const hasCamerasContainer = html.includes('id="cameras-container"');
                const hasDataSourceInfo = html.includes('id="dataSourceInfo"');
                
                let domStatus = '';
                if (hasCamerasContainer) domStatus += '<div class="success">✓ cameras-container 元素存在</div>';
                else domStatus += '<div class="error">✗ cameras-container 元素缺失</div>';
                
                if (hasDataSourceInfo) domStatus += '<div class="success">✓ dataSourceInfo 元素存在</div>';
                else domStatus += '<div class="error">✗ dataSourceInfo 元素缺失</div>';
                
                document.getElementById('domTest').innerHTML += '<br>' + domStatus;
                
            })
            .catch(error => {
                document.getElementById('domTest').innerHTML = '<span class="error">✗ 無法讀取 air-quality.html: ' + error + '</span>';
            });
        
        // 測試 3: 模擬資料載入
        setTimeout(() => {
            document.getElementById('dataTest').innerHTML = '<span class="success">✓ 測試完成 - 請檢查 air-quality.html 頁面</span>';
        }, 2000);
        
        console.log('診斷工具已載入');
    </script>
</body>
</html>