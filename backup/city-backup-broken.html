<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å°ç£å¸‚å€é“è·¯å³æ™‚ç›£è¦–å™¨å½±åƒæŸ¥è©¢ç³»çµ± - æ•´åˆ TDX äº¤é€šè³‡æ–™">
    <title>å¸‚å€é“è·¯ç›£è¦–å™¨ - å³æ™‚è·¯æ³ç›£æ§ç³»çµ±</title>
    
    <!-- External Resources -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    
    <!-- Project Stylesheets -->
    <link rel="stylesheet" href="assets/dark-mode.css">
    <link rel="stylesheet" href="assets/responsive-camera.css">
    
    <!-- Page Configuration -->
    <script>window.CURRENT_PAGE = 'city';</script>
    
    <style>
        /* ==================== åŸºç¤æ¨£å¼ ==================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', 'Noto Sans TC', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        /* ==================== æ¨™é ­å€åŸŸ ==================== */
        .header {
            background: white;
            padding: 25px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2rem;
            font-weight: 700;
        }
        
        .header-subtitle {
            text-align: center;
            color: #666;
            font-size: 1rem;
            margin-top: 8px;
        }
        
        /* ==================== å®¹å™¨èˆ‡ä½ˆå±€ ==================== */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* ==================== å°èˆªæŒ‰éˆ• ==================== */
        .nav-section {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        
        .theme-toggle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.3rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
        }
        
        /* ==================== è³‡è¨Šé¢æ¿ ==================== */
        .info-panel {
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8f4 100%);
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .info-panel h3 {
            color: #2E7D32;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .info-content {
            color: #333;
            line-height: 1.8;
        }
        
        .info-content a {
            color: #667eea;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .info-content a:hover {
            color: #764ba2;
            text-decoration: underline;
        }
        
        /* ==================== ç¯©é¸æ§åˆ¶ ==================== */
        .filter-section {
            display: flex;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-control {
            padding: 12px 16px;
            border-radius: 8px;
            border: 2px solid #667eea;
            font-size: 1rem;
            min-width: 150px;
            transition: all 0.3s ease;
            background: white;
        }
        
        .filter-control:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .reset-btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .reset-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        /* ==================== ç¸£å¸‚æŒ‰éˆ• ==================== */
        .city-buttons-panel {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .city-buttons-panel h3 {
            margin: 0 0 20px 0;
            color: #667eea;
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .city-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .city-button {
            padding: 10px 18px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px solid #667eea;
            border-radius: 25px;
            color: #667eea;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .city-button:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .city-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .city-button .count {
            background: rgba(255, 255, 255, 0.25);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        /* ==================== çµ±è¨ˆé¢æ¿ ==================== */
        .stats-panel {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            text-align: center;
        }
        
        .stat-item {
            padding: 15px;
            border-radius: 10px;
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        /* ==================== ç›£è¦–å™¨ç¶²æ ¼ ==================== */
        .cameras-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }
        
        @media (max-width: 768px) {
            .cameras-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .camera-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .camera-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
        }
        
        .camera-image {
            width: 100%;
            height: 220px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .camera-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .camera-card:hover .camera-image img {
            transform: scale(1.08);
        }
        
        .image-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(102, 126, 234, 0.85);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
            font-size: 1.2rem;
            font-weight: 500;
        }
        
        .camera-image:hover .image-overlay {
            opacity: 1;
        }
        
        .camera-info {
            padding: 20px;
        }
        
        .camera-info h3 {
            color: #667eea;
            margin-bottom: 12px;
            font-size: 1.15rem;
            font-weight: 600;
        }
        
        .camera-info p {
            color: #666;
            margin: 8px 0;
            font-size: 0.9rem;
            display: flex;
            align-items: start;
            gap: 8px;
        }
        
        .camera-info p i {
            margin-top: 2px;
            flex-shrink: 0;
        }
        
        .camera-location {
            color: #667eea !important;
            font-weight: 600 !important;
        }
        
        /* ==================== è¼‰å…¥å‹•ç•« ==================== */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 60px 20px;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            margin: 30px auto;
            max-width: 800px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .loading-icon {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: #667eea;
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .progress-bar-container {
            width: 100%;
            max-width: 500px;
            height: 10px;
            background: rgba(102, 126, 234, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }
        
        .loading-steps {
            width: 100%;
            max-width: 500px;
            margin-top: 25px;
        }
        
        .loading-step {
            display: flex;
            align-items: center;
            margin: 12px 0;
            padding: 10px 15px;
            font-size: 1rem;
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        
        .loading-step i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }
        
        .loading-step.active {
            background: rgba(102, 126, 234, 0.1);
        }
        
        .loading-stats {
            margin-top: 25px;
            font-size: 0.95rem;
            color: #666;
        }
        
        /* ==================== æ¨¡æ…‹è¦–çª— ==================== */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            overflow: auto;
        }
        
        .modal-content {
            position: relative;
            margin: 3% auto;
            width: 90%;
            max-width: 1200px;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .close {
            position: absolute;
            top: 20px;
            right: 40px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s ease;
        }
        
        .close:hover {
            color: #667eea;
            transform: rotate(90deg);
        }
        
        .modal-image {
            width: 100%;
            max-height: 70vh;
            object-fit: contain;
            border-radius: 12px;
        }
        
        .modal-info {
            background: white;
            padding: 30px;
            border-radius: 12px;
            margin-top: 20px;
        }
        
        .modal-info h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }
        
        .modal-info p {
            color: #666;
            margin: 10px 0;
            line-height: 1.8;
        }
        
        /* ==================== åˆ†é æ§åˆ¶ ==================== */
        .pagination {
            margin: 40px 0;
            text-align: center;
        }
        
        .pagination-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            display: inline-block;
        }
        
        .pagination button {
            padding: 12px 20px;
            margin: 0 5px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .pagination button:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }
        
        .pagination button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .page-info {
            margin: 0 15px;
            font-size: 1.1rem;
            color: #667eea;
            font-weight: 600;
        }
        
        /* ==================== è¿”å›é ‚éƒ¨æŒ‰éˆ• ==================== */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            z-index: 999;
            font-size: 1.3rem;
            transition: all 0.3s ease;
        }
        
        .back-to-top:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 25px rgba(0,0,0,0.4);
        }
        
        /* ==================== æ·±è‰²æ¨¡å¼ ==================== */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        body.dark-mode .header {
            background: linear-gradient(135deg, rgba(30,30,40,0.95) 0%, rgba(25,25,35,0.95) 100%);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        body.dark-mode .header h1 {
            color: #66BB6A;
        }
        
        body.dark-mode .header-subtitle {
            color: rgba(255,255,255,0.7);
        }
        
        body.dark-mode .back-btn {
            background: linear-gradient(135deg, #66BB6A 0%, #81C784 100%);
            color: #1a1a2e;
        }
        
        body.dark-mode .info-panel {
            background: linear-gradient(135deg, rgba(40,40,50,0.95) 0%, rgba(35,35,45,0.95) 100%);
            border-left-color: #66BB6A;
        }
        
        body.dark-mode .info-panel h3 {
            color: #66BB6A;
        }
        
        body.dark-mode .info-content {
            color: rgba(255,255,255,0.8);
        }
        
        body.dark-mode .filter-control {
            background: rgba(40,40,50,0.8);
            border-color: #66BB6A;
            color: white;
        }
        
        body.dark-mode .city-buttons-panel,
        body.dark-mode .stats-panel {
            background: linear-gradient(135deg, rgba(40,40,50,0.95) 0%, rgba(35,35,45,0.95) 100%);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        body.dark-mode .city-buttons-panel h3,
        body.dark-mode .stat-value {
            color: #66BB6A;
        }
        
        body.dark-mode .stat-label {
            color: rgba(255,255,255,0.7);
        }
        
        body.dark-mode .city-button {
            background: linear-gradient(135deg, rgba(40,40,50,0.8) 0%, rgba(35,35,45,0.8) 100%);
            border-color: #66BB6A;
            color: #66BB6A;
        }
        
        body.dark-mode .city-button:hover,
        body.dark-mode .city-button.active {
            background: linear-gradient(135deg, #66BB6A 0%, #81C784 100%);
            color: #1a1a2e;
        }
        
        body.dark-mode .camera-card {
            background: linear-gradient(135deg, rgba(40,40,50,0.95) 0%, rgba(35,35,45,0.95) 100%);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        body.dark-mode .camera-info h3 {
            color: #66BB6A;
        }
        
        body.dark-mode .camera-info p {
            color: rgba(255,255,255,0.7);
        }
        
        body.dark-mode .modal-info {
            background: linear-gradient(135deg, rgba(40,40,50,0.95) 0%, rgba(35,35,45,0.95) 100%);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        body.dark-mode .modal-info h2 {
            color: #66BB6A;
        }
        
        body.dark-mode .modal-info p {
            color: rgba(255,255,255,0.8);
        }
        
        body.dark-mode .pagination-content {
            background: linear-gradient(135deg, rgba(40,40,50,0.95) 0%, rgba(35,35,45,0.95) 100%);
            border: 1px solid rgba(255,255,255,0.1);
        }
    </style>
    
    <!-- Loading Progress Script -->
    <script src="assets/loading-progress.js"></script>
    <script src="assets/image-handler-simple.js"></script>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="container">
            <h1><i class="fas fa-city"></i> å¸‚å€é“è·¯ç›£è¦–å™¨</h1>
            <p class="header-subtitle">å³æ™‚å¸‚å€é“è·¯è·¯æ³ç›£æ§ç³»çµ± - æ•´åˆ TDX äº¤é€šè³‡æ–™</p>
        </div>
    </div>

    <div class="container">
        <!-- Navigation Section -->
        <div class="nav-section">
            <a href="index.html" class="back-btn">
                <i class="fas fa-arrow-left"></i> è¿”å›é¦–é 
            </a>
            <button class="theme-toggle" id="themeToggle" title="åˆ‡æ›æ·±è‰²æ¨¡å¼">
                <i class="fas fa-moon"></i>
            </button>
        </div>

        <!-- Info Panel -->
        <div class="info-panel" id="infoPanel">
            <h3 onclick="toggleInfoPanel()">
                <span>
                    <i class="fas fa-database"></i>
                    TDX äº¤é€šè³‡æ–™æœå‹™èªªæ˜
                </span>
                <i id="toggleIcon" class="fas fa-chevron-down"></i>
            </h3>
            <div class="info-content" id="infoContent" style="display: none;">
                <p>æœ¬ç³»çµ±ä½¿ç”¨<strong>äº¤é€šéƒ¨ TDX äº¤é€šè³‡æ–™æµé€šæœå‹™å¹³å°</strong>æä¾›çš„å³æ™‚å¸‚å€é“è·¯ç›£è¦–å™¨è³‡æ–™ã€‚</p>
                <div style="margin: 15px 0;">
                    <p><strong>ğŸ”— ç›¸é—œè³‡æºï¼š</strong></p>
                    <ul style="margin-left: 20px;">
                        <li>
                            <a href="https://tdx.transportdata.tw" target="_blank">
                                TDX äº¤é€šè³‡æ–™æµé€šæœå‹™å¹³å° <i class="fas fa-external-link-alt"></i>
                            </a>
                        </li>
                    </ul>
                </div>
                <p style="font-size: 0.9rem; color: #666; font-style: italic;">
                    ğŸ“Š æœ¬ç³»çµ±æ•´åˆå¤šå€‹ç¸£å¸‚çš„å¸‚å€é“è·¯ç›£è¦–å™¨ï¼Œæä¾›å…¨å°ç£å³æ™‚è·¯æ³æŸ¥è©¢æœå‹™ã€‚
                </p>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <select class="filter-control" id="citySelect" onchange="onCityChange()">
                <option value="">æ‰€æœ‰ç¸£å¸‚</option>
            </select>
            <select class="filter-control" id="districtSelect" onchange="applyFilters()" disabled>
                <option value="">è«‹å…ˆé¸æ“‡ç¸£å¸‚</option>
            </select>
            <input type="text" 
                   class="filter-control" 
                   id="searchInput" 
                   placeholder="æœå°‹è·¯æ®µæˆ–åœ°é»..." 
                   onkeyup="applyFilters()">
            <button class="reset-btn" onclick="resetFilters()">
                <i class="fas fa-redo"></i> é‡ç½®ç¯©é¸
            </button>
        </div>

        <!-- City Buttons Panel -->
        <div class="city-buttons-panel">
            <h3><i class="fas fa-map-marker-alt"></i> ç¸£å¸‚å¿«é€Ÿç¯©é¸</h3>
            <div class="city-buttons" id="cityButtons">
                <!-- ç¸£å¸‚æŒ‰éˆ•å°‡å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>

        <!-- Stats Panel -->
        <div class="stats-panel">
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="totalCameras">0</div>
                    <div class="stat-label">ç›£è¦–å™¨ç¸½æ•¸</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="availableCameras">0</div>
                    <div class="stat-label">å¯ç”¨å½±åƒ</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="filteredCameras">0</div>
                    <div class="stat-label">é¡¯ç¤ºæ•¸é‡</div>
                </div>
            </div>
        </div>

        <!-- Cameras Container -->
        <div id="cameras-container" class="loading">
            <div class="loading-icon">
                <i class="fas fa-road fa-spin"></i>
            </div>
            <div class="loading-title">è¼‰å…¥å¸‚å€é“è·¯ç›£è¦–å™¨ä¸­...</div>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar"></div>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination" style="display: none;">
            <div class="pagination-content">
                <button onclick="changePage('first')">
                    <i class="fas fa-angle-double-left"></i> é¦–é 
                </button>
                <button onclick="changePage('prev')">
                    <i class="fas fa-angle-left"></i> ä¸Šä¸€é 
                </button>
                <span class="page-info">
                    ç¬¬ <span id="currentPageNum">1</span> é ï¼Œå…± <span id="totalPagesNum">1</span> é 
                </span>
                <button onclick="changePage('next')">
                    ä¸‹ä¸€é  <i class="fas fa-angle-right"></i>
                </button>
                <button onclick="changePage('last')">
                    æœ«é  <i class="fas fa-angle-double-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="imageModal" class="modal" onclick="closeModal()">
        <span class="close">&times;</span>
        <div class="modal-content" onclick="event.stopPropagation()">
            <img id="modalImage" class="modal-image" src="" alt="ç›£è¦–å™¨å¤§åœ–">
            <div class="modal-info">
                <h2 id="modalTitle"></h2>
                <div id="modalDescription"></div>
                <div id="modalLocation"></div>
                <p id="modalStream"></p>
            </div>
        </div>
    </div>

    <!-- Back to Top Button -->
    <div class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <!-- Scripts -->
    <script src="assets/navbar.js"></script>
    <script src="assets/config.js"></script>
    <script src="assets/tdx-api.js"></script>
    <script src="assets/dark-mode.js"></script>
    
    <script>
        // ==================== å…¨å±€è®Šæ•¸ ====================
        let allCameras = [];
        let filteredCameras = [];
        let currentPage = 1;
        let itemsPerPage = 12;
        let totalPages = 1;

        // ==================== å·¥å…·å‡½æ•¸ ====================
        
        // åˆ‡æ›è³‡è¨Šé¢æ¿
        function toggleInfoPanel() {
            const content = document.getElementById('infoContent');
            const icon = document.getElementById('toggleIcon');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.className = 'fas fa-chevron-up';
            } else {
                content.style.display = 'none';
                icon.className = 'fas fa-chevron-down';
            }
        }

        // æ ¹æ“šç¶“ç·¯åº¦åˆ¤æ–·ç¸£å¸‚
        function getCityFromCoordinates(lon, lat) {
            if (!lon || !lat) return 'æœªçŸ¥';
            
            const cityRanges = [
                { name: 'å°åŒ—å¸‚', lonMin: 121.45, lonMax: 121.65, latMin: 24.95, latMax: 25.20 },
                { name: 'æ–°åŒ—å¸‚', lonMin: 121.30, lonMax: 121.80, latMin: 24.60, latMax: 25.30 },
                { name: 'æ¡ƒåœ’å¸‚', lonMin: 121.00, lonMax: 121.50, latMin: 24.80, latMax: 25.10 },
                { name: 'å°ä¸­å¸‚', lonMin: 120.50, lonMax: 121.20, latMin: 24.00, latMax: 24.50 },
                { name: 'å°å—å¸‚', lonMin: 120.00, lonMax: 120.50, latMin: 22.90, latMax: 23.40 },
                { name: 'é«˜é›„å¸‚', lonMin: 120.20, lonMax: 120.50, latMin: 22.50, latMax: 23.10 }
            ];
            
            for (const city of cityRanges) {
                if (lon >= city.lonMin && lon <= city.lonMax && 
                    lat >= city.latMin && lat <= city.latMax) {
                    return city.name;
                }
            }
            
            return 'å…¶ä»–åœ°å€';
        }

        // æå–é„‰é®å€è³‡è¨Š
        function extractDistrict(locationDescription) {
            if (!locationDescription) return '';
            
            const districtKeywords = ['å€', 'å¸‚', 'é„‰', 'é®'];
            for (const keyword of districtKeywords) {
                const regex = new RegExp(`([^\\s]{1,4}${keyword})`, 'g');
                const matches = locationDescription.match(regex);
                if (matches) return matches[0];
            }
            
            return '';
        }

        // ==================== è¼‰å…¥å‡½æ•¸ ====================
        
        async function loadCameras() {
            console.log('é–‹å§‹è¼‰å…¥å¸‚å€é“è·¯ç›£è¦–å™¨è³‡æ–™...');
            
            const container = document.getElementById('cameras-container');
            const progressBar = document.getElementById('progress-bar');
            
            try {
                // æ¨¡æ“¬è¼‰å…¥é€²åº¦
                let progress = 0;
                const progressInterval = setInterval(() => {
                    progress += 10;
                    if (progressBar) progressBar.style.width = `${Math.min(progress, 90)}%`;
                    if (progress >= 90) clearInterval(progressInterval);
                }, 200);
                
                // ç¸£å¸‚åˆ—è¡¨
                const cities = [
                    { name: 'å°åŒ—å¸‚', endpoint: '/v2/Road/Traffic/CCTV/City/Taipei?$format=JSON' },
                    { name: 'æ–°åŒ—å¸‚', endpoint: '/v2/Road/Traffic/CCTV/City/NewTaipei?$format=JSON' },
                    { name: 'æ¡ƒåœ’å¸‚', endpoint: '/v2/Road/Traffic/CCTV/City/Taoyuan?$format=JSON' },
                    { name: 'å°ä¸­å¸‚', endpoint: '/v2/Road/Traffic/CCTV/City/Taichung?$format=JSON' },
                    { name: 'å°å—å¸‚', endpoint: '/v2/Road/Traffic/CCTV/City/Tainan?$format=JSON' },
                    { name: 'é«˜é›„å¸‚', endpoint: '/v2/Road/Traffic/CCTV/City/Kaohsiung?$format=JSON' }
                ];
                
                let allCamerasData = [];
                
                // è¼‰å…¥å„ç¸£å¸‚è³‡æ–™
                for (const city of cities) {
                    try {
                        console.log(`è¼‰å…¥ ${city.name}...`);
                        const response = await tdxApi.fetchCCTV(city.endpoint);
                        
                        let cameras = Array.isArray(response) ? response : 
                                     (response.CCTVs || response.data || []);
                        
                        cameras = cameras.map(camera => ({
                            ...camera,
                            city: city.name,
                            City: city.name,
                            district: extractDistrict(camera.LocationDescription || '')
                        }));
                        
                        allCamerasData.push(...cameras);
                        console.log(`âœ… ${city.name}: ${cameras.length} å€‹ç›£è¦–å™¨`);
                    } catch (error) {
                        console.warn(`${city.name} è¼‰å…¥å¤±æ•—:`, error.message);
                    }
                }
                
                allCameras = allCamerasData;
                filteredCameras = allCameras;
                
                clearInterval(progressInterval);
                if (progressBar) progressBar.style.width = '100%';
                
                populateFilters();
                updateStats();
                displayCameras(allCameras);
                
                console.log(`âœ… è¼‰å…¥å®Œæˆï¼Œå…± ${allCameras.length} å€‹ç›£è¦–å™¨`);
                
            } catch (error) {
                console.error('è¼‰å…¥å¤±æ•—:', error);
                container.innerHTML = `
                    <div class="loading" style="color: #ff6b6b;">
                        <i class="fas fa-exclamation-triangle"></i><br>
                        è¼‰å…¥ç›£è¦–å™¨è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤<br><br>
                        <small>${error.message}</small>
                    </div>
                `;
            }
        }

        // ==================== UI æ›´æ–°å‡½æ•¸ ====================
        
        function populateFilters() {
            const cities = [...new Set(allCameras.map(c => c.city || c.City).filter(Boolean))].sort();
            
            const citySelect = document.getElementById('citySelect');
            citySelect.innerHTML = '<option value="">æ‰€æœ‰ç¸£å¸‚</option>' + 
                cities.map(city => {
                    const count = allCameras.filter(c => (c.city || c.City) === city).length;
                    return `<option value="${city}">${city} (${count})</option>`;
                }).join('');
            
            generateCityButtons(cities);
        }

        function generateCityButtons(cities)
