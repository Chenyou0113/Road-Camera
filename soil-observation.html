<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>æ°´åˆ©ç½²æ²³å·ç›£æ§å½±åƒ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; background: linear-gradient(135deg, #8D6E63 0%, #5D4037 100%); min-height: 100vh; }
        .header { background: white; padding: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        .header h1 { color: #8D6E63; text-align: center; margin-bottom: 10px; }
        .loading { text-align: center; padding: 50px; color: white; font-size: 1.2rem; }
        .cameras-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0; }
        @media (max-width: 1200px) { .cameras-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .cameras-grid { grid-template-columns: 1fr; } }
        .camera-card { 
            background: white; 
            border-radius: 10px; 
            padding: 15px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
            cursor: pointer; 
            transition: transform 0.3s; 
            position: relative; 
        }
        .camera-card:hover { transform: translateY(-5px); }
        .camera-card h3 { color: #8D6E63; margin-bottom: 10px; font-size: 1.1rem; }
        .camera-card p { color: #666; margin: 5px 0; font-size: 0.9rem; }
        .station-image { 
            width: 100%; 
            height: 200px; 
            background: #f0f0f0; 
            border-radius: 8px; 
            overflow: hidden; 
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .station-image img { width: 100%; height: 100%; object-fit: cover; }
        .no-image { color: #999; text-align: center; padding: 60px 20px; }
        .status-badge { 
            position: absolute; 
            top: 10px; 
            right: 10px; 
            padding: 4px 8px; 
            border-radius: 12px; 
            font-size: 0.75rem; 
            font-weight: bold; 
            color: white; 
        }
        .status-active { background: #4CAF50; }
        .status-inactive { background: #F44336; }
        .status-demo { background: #FF9800; }
        .status-live { background: #2196F3; }
        .info-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 8px; 
            margin-top: 10px; 
            font-size: 0.85rem;
        }
        .info-item { 
            background: #f8f9fa; 
            padding: 6px 8px; 
            border-radius: 4px; 
        }
        .info-label { color: #666; font-weight: bold; }
        .info-value { color: #333; margin-top: 2px; }
        .filter-select { 
            padding: 10px 15px; 
            border: 2px solid #8D6E63; 
            border-radius: 8px; 
            font-size: 1rem; 
            background: white; 
            color: #333; 
            cursor: pointer;
            transition: border-color 0.3s;
            min-width: 150px;
        }
        .filter-select:hover, .filter-select:focus { 
            border-color: #5D4037; 
            outline: none; 
        }
        .clear-button { 
            padding: 10px 15px; 
            background: #FF9800; 
            color: white; 
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
        }
        .clear-button:hover { 
            background: #F57C00; 
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1><i class="fas fa-water"></i> æ°´åˆ©ç½²æ²³å·åˆ†ç½²æµåŸŸç›£æ§å½±åƒ</h1>
            <p style="text-align: center; color: #666;">æ°´åˆ©ç½²å„æ²³å·åˆ†ç½²æµåŸŸèˆ‡ç–æ¿¬å·¥å€é ç«¯ç›£æ§å½±åƒ</p>
        </div>
    </div>
    <div class="container">
        <!-- å¿«é€Ÿåˆ‡æ›å°èˆªåˆ— -->
        <div style="background: white; padding: 15px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; justify-content: center;">
                <a href="index.html" style="padding: 8px 16px; background: #9C27B0; color: white; text-decoration: none; border-radius: 20px; font-size: 0.9rem;">
                    <i class="fas fa-home"></i> é¦–é 
                </a>
                <span style="color: #ddd;">|</span>
                <a href="road.html" style="padding: 8px 16px; background: #FF9800; color: white; text-decoration: none; border-radius: 20px; font-size: 0.9rem;">
                    <i class="fas fa-road"></i> å…¬è·¯ç›£è¦–å™¨
                </a>
                <a href="highway.html" style="padding: 8px 16px; background: #2196F3; color: white; text-decoration: none; border-radius: 20px; font-size: 0.9rem;">
                    <i class="fas fa-highway"></i> é«˜é€Ÿå…¬è·¯
                </a>
                <a href="city.html" style="padding: 8px 16px; background: #4CAF50; color: white; text-decoration: none; border-radius: 20px; font-size: 0.9rem;">
                    <i class="fas fa-city"></i> å¸‚å€ç›£è¦–å™¨
                </a>
                <a href="air-quality.html" style="padding: 8px 16px; background: #7B1FA2; color: white; text-decoration: none; border-radius: 20px; font-size: 0.9rem;">
                    <i class="fas fa-wind"></i> ç©ºå“æ¸¬ç«™
                </a>
                <a href="debris-flow.html" style="padding: 8px 16px; background: #795548; color: white; text-decoration: none; border-radius: 20px; font-size: 0.9rem;">
                    <i class="fas fa-mountain"></i> åœŸçŸ³æµç›£æ¸¬
                </a>
                <a href="soil-observation.html" style="padding: 8px 16px; background: #5D4037; color: white; text-decoration: none; border-radius: 20px; font-size: 0.9rem; border: 2px solid #8D6E63;">
                    <i class="fas fa-water"></i> æ²³å·ç›£æ§ âœ“
                </a>
            </div>
        </div>
        
        <!-- è³‡æ–™ä¾†æºèªªæ˜ -->
        <div style="background: white; padding: 15px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="color: #8D6E63; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> æ²³å·åˆ†ç½²ç›£æ§å½±åƒè³‡æ–™èªªæ˜</h3>
            <div style="margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid #8D6E63;">
                <p style="margin: 0; color: #555; font-size: 0.9rem; line-height: 1.5;">
                    æœ¬ç³»çµ±æ•´åˆ<strong>æ°´åˆ©ç½²å„æ²³å·åˆ†ç½²æµåŸŸèˆ‡ç–æ¿¬å·¥å€é ç«¯ç›£æ§ç³»çµ±</strong>çš„å½±åƒè³‡æ–™ï¼Œæä¾›å³æ™‚æ²³å·æ°´ä½ã€æµé‡ã€å·¥ç¨‹æ–½ä½œç­‰ç›£æ§å½±åƒã€‚
                    è‹¥ç„¡æ³•è¼‰å…¥å³æ™‚è³‡æ–™ï¼Œç³»çµ±æœƒè‡ªå‹•åˆ‡æ›ç‚ºç¤ºç¯„æ¨¡å¼ä»¥å±•ç¤ºåŠŸèƒ½ã€‚
                </p>
            </div>
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <div style="flex: 1;">
                    <p style="margin: 5px 0; color: #FF9800; font-weight: bold;" id="dataSourceInfo">
                        â€¢ è¼‰å…¥ä¸­...
                    </p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="window.location.reload()" style="padding: 8px 16px; background: #8D6E63; color: white; border: none; border-radius: 5px; cursor: pointer;">
                        <i class="fas fa-sync-alt"></i> é‡æ–°è¼‰å…¥
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ç¯©é¸é¸é … -->
        <div style="background: white; padding: 15px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                <select class="filter-select" id="riverSelect" onchange="applyFilters()">
                    <option value="">é¸æ“‡æ²³å·</option>
                </select>
                <select class="filter-select" id="authoritySelect" onchange="applyFilters()">
                    <option value="">é¸æ“‡æä¾›å–®ä½</option>
                </select>
                <button class="clear-button" onclick="clearFilters()">
                    <i class="fas fa-refresh"></i> æ¸…é™¤ç¯©é¸
                </button>
            </div>
        </div>
        
        <!-- çµ±è¨ˆè³‡è¨Š -->
        <div id="statsPanel" style="background: white; padding: 20px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
            <h3 style="color: #8D6E63; margin-bottom: 15px;"><i class="fas fa-chart-bar"></i> ç›£æ§ç«™çµ±è¨ˆ</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: #8D6E63;" id="totalStations">0</div>
                    <div style="color: #666; font-size: 0.9rem;">ç¸½ç›£æ§ç«™æ•¸</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: #4CAF50;" id="filteredStations">0</div>
                    <div style="color: #666; font-size: 0.9rem;">ç¯©é¸çµæœ</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: #2196F3;" id="countyCount">0</div>
                    <div style="color: #666; font-size: 0.9rem;">æ¶µè“‹æ²³å·</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: #FF9800;" id="videoStations">0</div>
                    <div style="color: #666; font-size: 0.9rem;">æœ‰å½±åƒè³‡æ–™</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 1.5rem; font-weight: bold; color: #9C27B0;" id="authorityCount">0</div>
                    <div style="color: #666; font-size: 0.9rem;">æä¾›å–®ä½æ•¸</div>
                </div>
            </div>
        </div>
        
        <div id="cameras-container" class="loading">è¼‰å…¥ä¸­...</div>
    </div>

    <script>
        let isUsingRealData = false;
        let allStations = [];
        let currentStations = [];
        
        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('æ°´åˆ©ç½²æ°´åˆ©é˜²ç½ç›£æ§é é¢è¼‰å…¥å®Œæˆ');
            loadWaterResourcesData();
        });
        
        async function loadWaterResourcesData() {
            console.log('é–‹å§‹è¼‰å…¥æ°´åˆ©ç½²æ²³å·ç›£æ§è³‡æ–™...');
            const container = document.getElementById('cameras-container');
            container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> è¼‰å…¥æ°´åˆ©ç½²æ²³å·ç›£æ§è³‡æ–™ä¸­...</div>';
            
            try {
                // å˜—è©¦è¼‰å…¥æ°´åˆ©ç½²å„æ²³å·åˆ†ç½²æµåŸŸèˆ‡ç–æ¿¬å·¥å€é ç«¯ç›£æ§å½±åƒ API
                console.log('æ­£åœ¨å˜—è©¦è¼‰å…¥æ°´åˆ©ç½²æ²³å·åˆ†ç½² API...');
                
                // å…ˆå˜—è©¦ç›´æ¥é€£æ¥
                let response;
                try {
                    container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> å˜—è©¦è¼‰å…¥æ°´åˆ©ç½²å³æ™‚è³‡æ–™...</div>';
                    response = await fetch('https://opendata.wra.gov.tw/api/v2/65d61e4b-c250-4170-bcfc-5fd323fdd13e?limit=1000&sort=_importdate%20desc&format=JSON');
                } catch (corsError) {
                    console.log('ç›´æ¥é€£æ¥å¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨ CORS ä»£ç†...');
                    container.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> å˜—è©¦æ›¿ä»£é€£æ¥æ–¹å¼...</div>';
                    // ä½¿ç”¨ CORS ä»£ç†
                    const proxyUrl = 'https://api.allorigins.win/raw?url=';
                    const targetUrl = encodeURIComponent('https://opendata.wra.gov.tw/api/v2/65d61e4b-c250-4170-bcfc-5fd323fdd13e?limit=1000&sort=_importdate%20desc&format=JSON');
                    response = await fetch(proxyUrl + targetUrl);
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('æ°´åˆ©ç½²æ²³å·åˆ†ç½² API å›æ‡‰:', data);
                
                if (data && data.records && Array.isArray(data.records) && data.records.length > 0) {
                    isUsingRealData = true;
                    document.getElementById('dataSourceInfo').innerHTML = 'â€¢ âœ… å³æ™‚è³‡æ–™è¼‰å…¥æˆåŠŸï¼ˆæ°´åˆ©ç½²é–‹æ”¾è³‡æ–™å¹³å°ï¼‰';
                    document.getElementById('dataSourceInfo').style.color = '#4CAF50';
                    
                    // è½‰æ›æ°´åˆ©ç½²æ²³å·åˆ†ç½²è³‡æ–™æ ¼å¼
                    allStations = data.records.map(station => ({
                        // åŸºæœ¬è³‡è¨Š
                        stationName: station.StationName || 'æœªå‘½åç›£æ§ç«™',
                        authority: station.Authority || '',
                        ccdIdentifier: station.CCDIdentifier || '',
                        
                        // åœ°ç†ä½ç½®
                        latitude: station.latitude_4326 || '',
                        longitude: station.Longitude_4326 || '',
                        coordinate: station.Coordinate || '',
                        
                        // æ²³å·è³‡è¨Š
                        riverName: station.RiverName || '',
                        riverCode: station.RiverCode || '',
                        
                        // å½±åƒè³‡è¨Š
                        imageURL: station.ImageURL || '',
                        
                        // ç‹€æ…‹
                        status: station.Status || ''
                    }));
                    
                    console.log('æ°´åˆ©ç½²æ²³å·ç›£æ§è³‡æ–™è¼‰å…¥æˆåŠŸ:', allStations.length, 'å€‹ç›£æ§ç«™');
                    if (allStations.length > 0) {
                        console.log('ç¬¬ä¸€å€‹ç›£æ§ç«™:', allStations[0]);
                    }
                    
                    currentStations = [...allStations];
                    populateFilters();
                    updateStatistics();
                    processWaterResourcesData(currentStations, container);
                    return;
                }
                
                throw new Error('ç„¡æ³•ç²å–è³‡æ–™');
                
            } catch (error) {
                console.error('è¼‰å…¥æ°´åˆ©ç½²æ²³å·ç›£æ§è³‡æ–™å¤±æ•—:', error);
                console.log('éŒ¯èª¤è©³æƒ…:', error.message);
                
                // å˜—è©¦ä½¿ç”¨å‚™ç”¨è³‡æ–™æºæˆ–è¼‰å…¥æ¨¡æ“¬è³‡æ–™
                console.log('åˆ‡æ›è‡³å‚™ç”¨æ²³å·ç›£æ§è³‡æ–™...');
                loadMockWaterResourcesData();
            }
        }
        
        function loadMockWaterResourcesData() {
            console.log('è¼‰å…¥ç¤ºç¯„æ°´åˆ©ç½²æ²³å·ç›£æ§è³‡æ–™...');
            console.log('èªªæ˜ï¼šç”±æ–¼ç¶²è·¯é€£ç·šæˆ– CORS æ”¿ç­–é™åˆ¶ï¼Œç„¡æ³•è¼‰å…¥å³æ™‚è³‡æ–™ï¼Œæ”¹ç”¨ç¤ºç¯„è³‡æ–™é¡¯ç¤ºåŠŸèƒ½');
            
            // ç¤ºç¯„æ°´åˆ©ç½²æ²³å·åˆ†ç½²ç›£æ§è³‡æ–™ - åŸºæ–¼çœŸå¯¦ç›£æ§ç«™ä½ç½®
            allStations = [
                {
                    stationName: 'æ¿æ°´æºª-é›†é›†æ””æ²³å °',
                    authority: 'ç¬¬ä¸‰æ²³å·åˆ†ç½²',
                    ccdIdentifier: 'WRA-R03-001',
                    latitude: '23.8302',
                    longitude: '120.7832',
                    coordinate: 'TWD97',
                    riverName: 'æ¿æ°´æºª',
                    riverCode: 'R0301',
                    imageURL: 'https://fhy.wra.gov.tw/ReservoirPage_2011/Images/1351002A.jpg',
                    status: 'æ­£å¸¸é‹ä½œ',
                    authorityType: 'æ°´åˆ©ç½²æ²³å·åˆ†ç½²',
                    county: 'å—æŠ•ç¸£'
                },
                {
                    stationName: 'å¤§ç”²æºª-çŸ³å²¡å£©',
                    authority: 'ç¬¬ä¸‰æ²³å·åˆ†ç½²',
                    ccdIdentifier: 'WRA-R03-002',
                    latitude: '24.2572',
                    longitude: '120.7922',
                    coordinate: 'TWD97',
                    riverName: 'å¤§ç”²æºª',
                    riverCode: 'R0401',
                    imageURL: 'https://fhy.wra.gov.tw/ReservoirPage_2011/Images/1351018A.jpg',
                    status: 'æ­£å¸¸é‹ä½œ',
                    authorityType: 'æ°´åˆ©ç½²æ²³å·åˆ†ç½²',
                    county: 'å°ä¸­å¸‚'
                },
                {
                    stationName: 'æ·¡æ°´æ²³-é—œæ¸¡',
                    authority: 'ç¬¬ä¸€æ²³å·åˆ†ç½²',
                    ccdIdentifier: 'WRA-R01-003',
                    latitude: '25.1175',
                    longitude: '121.4627',
                    coordinate: 'TWD97',
                    riverName: 'æ·¡æ°´æ²³',
                    riverCode: 'R0101',
                    imageURL: 'https://fhy.wra.gov.tw/ReservoirPage_2011/Images/1401001A.jpg',
                    status: 'æ­£å¸¸é‹ä½œ',
                    authorityType: 'æ°´åˆ©ç½²æ²³å·åˆ†ç½²',
                    county: 'å°åŒ—å¸‚'
                },
                {
                    stationName: 'é«˜å±æºª-é‡Œæ¸¯å¤§æ©‹',
                    authority: 'ç¬¬ä¸ƒæ²³å·åˆ†ç½²',
                    ccdIdentifier: 'WRA-R07-004',
                    latitude: '22.7781',
                    longitude: '120.4948',
                    coordinate: 'TWD97',
                    riverName: 'é«˜å±æºª',
                    riverCode: 'R0701',
                    imageURL: 'https://fhy.wra.gov.tw/ReservoirPage_2011/Images/1471009A.jpg',
                    status: 'æ­£å¸¸é‹ä½œ',
                    authorityType: 'æ°´åˆ©ç½²æ²³å·åˆ†ç½²',
                    county: 'å±æ±ç¸£'
                },
                {
                    stationName: 'è˜­é™½æºª-å“¡å±±',
                    authority: 'ç¬¬ä¸€æ²³å·åˆ†ç½²',
                    ccdIdentifier: 'WRA-R01-005',
                    latitude: '24.7394',
                    longitude: '121.6622',
                    coordinate: 'TWD97',
                    riverName: 'è˜­é™½æºª',
                    riverCode: 'R0102',
                    imageURL: 'https://fhy.wra.gov.tw/ReservoirPage_2011/Images/1421001A.jpg',
                    status: 'æ­£å¸¸é‹ä½œ',
                    authorityType: 'æ°´åˆ©ç½²æ²³å·åˆ†ç½²',
                    county: 'å®œè˜­ç¸£'
                },
                {
                    stationName: 'æ›¾æ–‡æºª-äºŒæºªå¤§æ©‹',
                    authority: 'ç¬¬å…­æ²³å·åˆ†ç½²',
                    ccdIdentifier: 'WRA-R06-006',
                    latitude: '23.1953',
                    longitude: '120.3923',
                    coordinate: 'TWD97',
                    riverName: 'æ›¾æ–‡æºª',
                    riverCode: 'R0601',
                    imageURL: 'https://fhy.wra.gov.tw/ReservoirPage_2011/Images/1461002A.jpg',
                    status: 'æ­£å¸¸é‹ä½œ',
                    authorityType: 'æ°´åˆ©ç½²æ²³å·åˆ†ç½²',
                    county: 'å°å—å¸‚'
                },
                {
                    stationName: 'é«˜å±æºª-æ–œå¼µæ©‹',
                    authority: 'ç¬¬ä¸ƒæ²³å·åˆ†ç½²',
                    ccdIdentifier: 'CCD-003',
                    latitude: '22.7341',
                    longitude: '120.4892',
                    coordinate: 'TWD97',
                    riverName: 'é«˜å±æºª',
                    riverCode: 'R0801',
                    imageURL: 'https://via.placeholder.com/400x300/2196F3/FFFFFF?text=é«˜å±æºª-æ–œå¼µæ©‹',
                    status: 'æ­£å¸¸',
                    authorityType: 'æ°´åˆ©ç½²ï¼ˆèˆ‡ç¸£å¸‚æ”¿åºœåˆå»ºï¼‰',
                    county: 'é«˜é›„å¸‚'
                },
                {
                    stationName: 'è˜­é™½æºª-è˜­é™½å¤§æ©‹',
                    authority: 'ç¬¬ä¸€æ²³å·åˆ†ç½²',
                    ccdIdentifier: 'CCD-004',
                    latitude: '24.7392',
                    longitude: '121.7892',
                    coordinate: 'TWD97',
                    riverName: 'è˜­é™½æºª',
                    riverCode: 'R0101',
                    imageURL: 'https://via.placeholder.com/400x300/4CAF50/FFFFFF?text=è˜­é™½æºª-è˜­é™½å¤§æ©‹',
                    status: 'æ­£å¸¸',
                    authorityType: 'æ°´åˆ©ç½²',
                    county: 'å®œè˜­ç¸£'
                },
                {
                    stationName: 'æ·¡æ°´æ²³-é—œæ¸¡å¤§æ©‹',
                    authority: 'ç¬¬åæ²³å·åˆ†ç½²',
                    ccdIdentifier: 'WRA-R10-007',
                    latitude: '25.1241',
                    longitude: '121.4592',
                    coordinate: 'TWD97',
                    riverName: 'æ·¡æ°´æ²³',
                    riverCode: 'R0201',
                    imageURL: '',
                    status: 'ç¶­è­·ä¸­',
                    authorityType: 'æ°´åˆ©ç½²ï¼ˆèˆ‡ç¸£å¸‚æ”¿åºœåˆå»ºï¼‰',
                    county: 'æ–°åŒ—å¸‚'
                },
                {
                    stationName: 'èŠ±è“®æºª-èŠ±è“®å¤§æ©‹',
                    authority: 'ç¬¬ä¹æ²³å·åˆ†ç½²',
                    ccdIdentifier: 'WRA-R09-008',
                    latitude: '23.9739',
                    longitude: '121.6015',
                    coordinate: 'TWD97',
                    riverName: 'èŠ±è“®æºª',
                    riverCode: 'R0901',
                    imageURL: 'https://fhy.wra.gov.tw/ReservoirPage_2011/Images/1481001A.jpg',
                    status: 'æ­£å¸¸é‹ä½œ',
                    authorityType: 'æ°´åˆ©ç½²æ²³å·åˆ†ç½²',
                    county: 'èŠ±è“®ç¸£'
                },
                {
                    stationName: 'å‘å—æºª-çŸ¥æœ¬',
                    authority: 'ç¬¬å…«æ²³å·åˆ†ç½²',
                    ccdIdentifier: 'WRA-R08-009',
                    latitude: '22.7216',
                    longitude: '121.0854',
                    coordinate: 'TWD97',
                    riverName: 'å‘å—æºª',
                    riverCode: 'R0801',
                    imageURL: 'https://fhy.wra.gov.tw/ReservoirPage_2011/Images/1491001A.jpg',
                    status: 'æ­£å¸¸é‹ä½œ',
                    authorityType: 'æ°´åˆ©ç½²æ²³å·åˆ†ç½²',
                    county: 'å°æ±ç¸£'
                }
            ];
            
            isUsingRealData = false;
            document.getElementById('dataSourceInfo').innerHTML = 'â€¢ ä½¿ç”¨ç¤ºç¯„è³‡æ–™ï¼ˆç„¡æ³•é€£æ¥å®˜æ–¹ APIï¼Œé¡¯ç¤ºæ²³å·åˆ†ç½²ç›£æ§ç«™ç¯„ä¾‹ï¼‰';
            document.getElementById('dataSourceInfo').style.color = '#FF9800';
            
            currentStations = [...allStations];
            populateFilters();
            updateStatistics();
            processWaterResourcesData(currentStations, document.getElementById('cameras-container'));
        }
        
        function populateFilters() {
            // å¡«å……ç¸£å¸‚ç¯©é¸
            // å°ç£ç¸£å¸‚æ¨™æº–æ’åº - ç”±åŒ—åˆ°å—ï¼Œç›´è½„å¸‚å„ªå…ˆ
            const TAIWAN_CITY_ORDER = [
                'å°åŒ—å¸‚', 'æ–°åŒ—å¸‚', 'æ¡ƒåœ’å¸‚', 'å°ä¸­å¸‚', 'å°å—å¸‚', 'é«˜é›„å¸‚',
                'åŸºéš†å¸‚', 'æ–°ç«¹å¸‚', 'å˜‰ç¾©å¸‚',
                'æ–°ç«¹ç¸£', 'è‹—æ —ç¸£', 'å½°åŒ–ç¸£', 'å—æŠ•ç¸£', 'é›²æ—ç¸£', 'å˜‰ç¾©ç¸£', 'å±æ±ç¸£',
                'å®œè˜­ç¸£', 'èŠ±è“®ç¸£', 'å°æ±ç¸£',
                'æ¾æ¹–ç¸£', 'é‡‘é–€ç¸£', 'é€£æ±Ÿç¸£'
            ];
            
            const countySelect = document.getElementById('countySelect');
            const counties = [...new Set(allStations.map(s => s.county).filter(c => c))];
            
            // æŒ‰ç…§å°ç£ç¸£å¸‚æ¨™æº–é †åºæ’åˆ—
            const sortedCounties = counties.sort((a, b) => {
                const indexA = TAIWAN_CITY_ORDER.indexOf(a);
                const indexB = TAIWAN_CITY_ORDER.indexOf(b);
                // å¦‚æœåœ¨æ¨™æº–é †åºä¸­æ‰¾ä¸åˆ°ï¼Œå‰‡æ”¾åœ¨æœ€å¾Œä¸¦æŒ‰å­—æ¯æ’åº
                if (indexA === -1 && indexB === -1) return a.localeCompare(b);
                if (indexA === -1) return 1;
                if (indexB === -1) return -1;
                return indexA - indexB;
            });
            
            countySelect.innerHTML = '<option value="">é¸æ“‡ç¸£å¸‚</option>';
            sortedCounties.forEach(county => {
                const option = document.createElement('option');
                option.value = county;
                option.textContent = county;
                countySelect.appendChild(option);
            });
        }
        
        function applyFilters() {
            const selectedAuthorityType = document.getElementById('authorityTypeSelect').value;
            const selectedCounty = document.getElementById('countySelect').value;
            
            currentStations = allStations.filter(station => {
                let match = true;
                
                if (selectedAuthorityType) {
                    match = match && (station.authorityType === selectedAuthorityType);
                }
                
                if (selectedCounty) {
                    match = match && (station.county === selectedCounty);
                }
                
                return match;
            });
            
            updateStatistics();
            const container = document.getElementById('cameras-container');
            processWaterResourcesData(currentStations, container);
        }
        
        function clearFilters() {
            document.getElementById('authorityTypeSelect').value = '';
            document.getElementById('countySelect').value = '';
            currentStations = [...allStations];
            updateStatistics();
            const container = document.getElementById('cameras-container');
            processWaterResourcesData(currentStations, container);
        }
        
        function processWaterResourcesData(stations, container) {
            console.log('é–‹å§‹è™•ç†æ°´åˆ©ç½²æ²³å·ç›£æ§è³‡æ–™:', stations.length, 'å€‹ç›£æ§ç«™');
            
            if (stations.length === 0) {
                container.innerHTML = '<div class="loading">ç„¡ç¬¦åˆæ¢ä»¶çš„ç›£æ§ç«™</div>';
                return;
            }
            
            const html = stations.map((station, index) => {
                const stationName = station.stationName || 'æœªå‘½åç›£æ§ç«™';
                const county = station.county || '';
                const riverName = station.riverName || '';
                const riverCode = station.riverCode || '';
                const status = station.status || 'æœªçŸ¥';
                const imageUrl = station.imageURL || '';
                const ccdIdentifier = station.ccdIdentifier || '';
                const authority = station.authority || '';
                const authorityType = station.authorityType || '';
                const coordinate = station.coordinate || '';
                const latitude = station.latitude || '';
                const longitude = station.longitude || '';
                
                // ç‹€æ…‹æ¨™ç±¤æ¨£å¼
                let statusClass = 'status-live';
                let statusText = 'æ­£å¸¸';
                
                if (status && (status.includes('ç•°å¸¸') || status.includes('æ•…éšœ'))) {
                    statusClass = 'status-inactive';
                    statusText = 'ç•°å¸¸';
                } else if (status && status.includes('ç¶­è­·')) {
                    statusClass = 'status-inactive';
                    statusText = 'ç¶­è­·';
                } else if (status && status.includes('æ­£å¸¸')) {
                    statusClass = 'status-active';
                    statusText = 'æ­£å¸¸';
                }
                
                // åˆ¤æ–·å°ˆå€é¡å‹
                let zoneType = '';
                let zoneColor = '';
                if (authorityType === 'æ°´åˆ©ç½²') {
                    zoneType = 'æ°´åˆ©ç½²å°ˆå€';
                    zoneColor = '#2196F3';
                } else if (authorityType === 'æ°´åˆ©ç½²ï¼ˆèˆ‡ç¸£å¸‚æ”¿åºœåˆå»ºï¼‰') {
                    zoneType = 'åœ°æ–¹æ”¿åºœå°ˆå€';
                    zoneColor = '#4CAF50';
                }
                
                // å»ºç«‹å½±åƒå€å¡Š
                const imageHtml = imageUrl ? 
                    `<div class="station-image">
                        <img src="${imageUrl}" alt="${stationName}å½±åƒ" 
                             onerror="handleImageError(this, '${stationName}')"
                             onload="handleImageLoad(this)"
                             style="opacity: 0; transition: opacity 0.3s ease;">
                    </div>` :
                    `<div class="station-image">
                        <div class="no-image">
                            <i class="fas fa-camera-slash"></i><br>
                            ç„¡å½±åƒè³‡æ–™
                        </div>
                    </div>`;
                
                return `
                    <div class="camera-card">
                        <div class="status-badge ${statusClass}">${statusText}</div>
                        <h3><i class="fas fa-water"></i> ${stationName}</h3>
                        <p><i class="fas fa-map-marker-alt"></i> ${county}</p>
                        ${zoneType ? `<p style="color: ${zoneColor}; font-weight: bold; margin: 5px 0;"><i class="fas fa-building"></i> ${zoneType}</p>` : ''}
                        
                        ${imageHtml}
                        
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">æä¾›å–®ä½</div>
                                <div class="info-value">${authority || 'N/A'}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">æ²³å·åç¨±</div>
                                <div class="info-value">${riverName || 'N/A'}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">æ²³å·ä»£ç¢¼</div>
                                <div class="info-value">${riverCode || 'N/A'}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">CCDç·¨è™Ÿ</div>
                                <div class="info-value">${ccdIdentifier || 'N/A'}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">åæ¨™ç³»çµ±</div>
                                <div class="info-value">${coordinate || 'N/A'}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">ç¶“ç·¯åº¦</div>
                                <div class="info-value">${latitude && longitude ? `${latitude}, ${longitude}` : 'N/A'}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `<div class="cameras-grid">${html}</div>`;
            console.log('æ°´åˆ©ç½²æ²³å·ç›£æ§è³‡æ–™é¡¯ç¤ºå®Œæˆ');
        }
        
        function updateStatistics() {
            const total = allStations.length;
            const filtered = currentStations.length;
            const counties = new Set(currentStations.map(s => s.county).filter(c => c)).size;
            const withImage = currentStations.filter(s => s.imageURL && s.imageURL.trim() !== '').length;
            const waterAgency = currentStations.filter(s => s.authorityType === 'æ°´åˆ©ç½²').length;
            const localGov = currentStations.filter(s => s.authorityType === 'æ°´åˆ©ç½²ï¼ˆèˆ‡ç¸£å¸‚æ”¿åºœåˆå»ºï¼‰').length;
            
            document.getElementById('totalStations').textContent = total;
            document.getElementById('filteredStations').textContent = filtered;
            document.getElementById('countyCount').textContent = counties;
            document.getElementById('videoStations').textContent = withImage;
            document.getElementById('waterAgencyStations').textContent = waterAgency;
            document.getElementById('localGovStations').textContent = localGov;
        }

        // åœ–ç‰‡è¼‰å…¥æˆåŠŸè™•ç†
        function handleImageLoad(img) {
            img.style.opacity = '1';
            console.log('âœ… æ²³å·ç›£æ§å½±åƒè¼‰å…¥æˆåŠŸ:', img.alt);
        }

        // åœ–ç‰‡è¼‰å…¥å¤±æ•—è™•ç†
        function handleImageError(img, stationName) {
            console.warn('âš ï¸ æ²³å·ç›£æ§å½±åƒè¼‰å…¥å¤±æ•—:', img.src, 'ç›£æ§ç«™:', stationName);
            
            // å˜—è©¦é‡æ–°è¼‰å…¥ä¸€æ¬¡
            if (!img.dataset.retried) {
                img.dataset.retried = 'true';
                setTimeout(() => {
                    console.log('ğŸ”„ é‡è©¦è¼‰å…¥æ²³å·ç›£æ§å½±åƒ:', img.src);
                    const originalSrc = img.src.split('?')[0]; // ç§»é™¤ä¹‹å‰çš„åƒæ•¸
                    img.src = originalSrc + '?retry=' + Date.now();
                }, 2000);
                return;
            }
            
            // é‡è©¦å¤±æ•—ï¼Œé¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
            img.parentElement.innerHTML = `
                <div class="no-image">
                    <i class="fas fa-exclamation-triangle" style="color: #FF5722;"></i><br>
                    <small style="color: #666; font-size: 0.8rem;">å½±åƒæš«æ™‚ç„¡æ³•è¼‰å…¥</small><br>
                    <small style="color: #999; font-size: 0.7rem;">${stationName}</small><br>
                    <button onclick="retryLoadImage('${img.src.split('?')[0]}', this.parentElement, '${stationName}')" 
                            style="margin-top: 5px; padding: 4px 8px; background: #8D6E63; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 0.7rem;">
                        <i class="fas fa-redo"></i> é‡è©¦
                    </button>
                </div>
            `;
        }

        // æ‰‹å‹•é‡è©¦è¼‰å…¥åœ–ç‰‡
        function retryLoadImage(imageSrc, container, stationName) {
            container.innerHTML = `
                <div class="no-image">
                    <i class="fas fa-spinner fa-spin" style="color: #8D6E63;"></i><br>
                    <small style="color: #666; font-size: 0.8rem;">é‡æ–°è¼‰å…¥ä¸­...</small>
                </div>
            `;
            
            setTimeout(() => {
                container.innerHTML = `
                    <img src="${imageSrc}?manual_retry=${Date.now()}" 
                         alt="${stationName}å½±åƒ" 
                         onerror="handleImageError(this, '${stationName}')"
                         onload="handleImageLoad(this)"
                         style="opacity: 0; transition: opacity 0.3s ease; width: 100%; height: 100%; object-fit: cover;">
                `;
            }, 500);
        }
    </script>
</body>
</html>
