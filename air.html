<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç£å³æ™‚ç©ºå“æˆ°æƒ…å®¤</title>
    
    <!-- Leaflet Map -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* === é é¢æ¨™é¡Œ === */
        .page-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .page-header h1 {
            font-size: 2.5em;
            color: #1a73e8;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .page-header .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        /* === çµ±è¨ˆåˆ— === */
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            border-top: 4px solid #1a73e8;
        }

        .stat-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .stat-item .label {
            font-size: 0.9em;
            color: #888;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-item .value {
            font-size: 2.5em;
            font-weight: 800;
            color: #1a73e8;
        }

        .stat-item.worst .value {
            color: #d32f2f;
        }

        .stat-item.avg .value {
            color: #f57c00;
        }

        /* === æ§åˆ¶åˆ— === */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .controls input {
            flex: 1;
            min-width: 250px;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .controls input:focus {
            outline: none;
            border-color: #1a73e8;
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
        }

        /* åœ–ä¾‹ */
        .legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95em;
        }

        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 0 3px rgba(0,0,0,0.3);
        }

        .legend-dot.good { background: #009966; }
        .legend-dot.moderate { background: #ffde33; }
        .legend-dot.unhealthy-sensitive { background: #ff9933; }
        .legend-dot.unhealthy { background: #cc0033; }
        .legend-dot.very-unhealthy { background: #660099; }
        .legend-dot.hazardous { background: #7e0023; }

        /* === å…§å®¹å€ === */
        #air-dashboard {
            display: grid;
            grid-template-columns: 1.2fr 1fr;
            gap: 20px;
            height: 75vh;
            margin-bottom: 20px;
        }

        #air-map {
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            background: white;
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        /* åœ°åœ–åŠ è¼‰ç‹€æ…‹ */
        .map-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
        }

        .map-loading .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f0f0f0;
            border-top: 4px solid #1a73e8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* === å¡ç‰‡åˆ—è¡¨ === */
        .air-list-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .air-list-container .list-header {
            font-size: 0.95em;
            font-weight: 700;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e0e0e0;
            margin-bottom: 12px;
        }

        #air-grid {
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        /* å¡ç‰‡æ¨£å¼ */
        .air-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 12px;
            border-left: 5px solid #ccc;
            position: relative;
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid #e0e0e0;
            border-left-width: 5px;
        }

        .air-card:hover {
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            background: #fff;
        }

        .air-card .card-name {
            font-weight: 700;
            font-size: 1em;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .air-card .county {
            font-size: 0.75em;
            color: #999;
            font-weight: normal;
        }

        .air-card .aqi-display {
            display: flex;
            align-items: baseline;
            gap: 8px;
            margin-bottom: 6px;
        }

        .air-card .aqi-val {
            font-size: 2em;
            font-weight: 800;
        }

        .air-card .status-badge {
            font-size: 0.75em;
            padding: 3px 8px;
            border-radius: 4px;
            background: #f0f0f0;
            color: #666;
            font-weight: 600;
        }

        .air-card .detail-item {
            font-size: 0.85em;
            color: #777;
            margin-top: 5px;
            display: flex;
            justify-content: space-between;
        }

        .air-card .detail-label {
            color: #999;
        }

        .air-card .detail-value {
            font-weight: 600;
            color: #333;
        }

        /* === ç©ºç‹€æ…‹ === */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            text-align: center;
            color: #999;
        }

        .empty-state .icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: #ccc;
        }

        .empty-state p {
            margin: 5px 0;
        }

        /* === éŒ¯èª¤è¨Šæ¯ === */
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #c62828;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .error-message .icon {
            font-size: 1.5em;
        }

        /* === éŸ¿æ‡‰å¼è¨­è¨ˆ === */
        @media (max-width: 1024px) {
            #air-dashboard {
                grid-template-columns: 1fr;
                height: auto;
                gap: 20px;
            }

            #air-map {
                height: 400px;
            }

            .air-list-container {
                max-height: 400px;
            }

            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .controls input {
                min-width: 100%;
            }

            .legend {
                justify-content: center;
            }

            .page-header h1 {
                font-size: 2em;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .stats-bar {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .page-header h1 {
                font-size: 1.5em;
                gap: 8px;
            }

            .stat-item {
                padding: 15px;
            }

            .stat-item .value {
                font-size: 2em;
            }

            #air-map {
                height: 300px;
            }

            .air-list-container {
                max-height: 300px;
            }

            .air-card .aqi-val {
                font-size: 1.5em;
            }
        }

        /* === æ²è»¸ç¾åŒ– === */
        #air-grid::-webkit-scrollbar {
            width: 6px;
        }

        #air-grid::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        #air-grid::-webkit-scrollbar-thumb {
            background: #1a73e8;
            border-radius: 10px;
        }

        #air-grid::-webkit-scrollbar-thumb:hover {
            background: #1557b0;
        }

        /* Leaflet è‡ªè¨‚æ¨£å¼ */
        .leaflet-control-attribution {
            font-size: 0.75em;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é é¢æ¨™é¡Œ -->
        <div class="page-header">
            <h1>
                <i class="fas fa-wind"></i>
                å°ç£å³æ™‚ç©ºå“æˆ°æƒ…å®¤
            </h1>
            <p class="subtitle">ä¸€è¦½å…¨å°80+åœ‹å®¶ç´šæ¸¬ç«™çš„å¯¦æ™‚ç©ºæ°£å“è³ªæŒ‡æ•¸</p>
        </div>

        <!-- çµ±è¨ˆåˆ— -->
        <div class="stats-bar">
            <div class="stat-item">
                <span class="label">ğŸ“Š å…¨å°æ¸¬ç«™</span>
                <span class="value" id="total-stations">-</span>
            </div>
            <div class="stat-item avg">
                <span class="label">ğŸŒ¡ï¸ å¹³å‡ AQI</span>
                <span class="value" id="avg-aqi">-</span>
            </div>
            <div class="stat-item worst">
                <span class="label">ğŸ’¨ ç©ºæ°£æœ€å·®</span>
                <span class="value" id="worst-station">-</span>
            </div>
            <div class="stat-item">
                <span class="label">âœ… è‰¯å¥½æ¸¬ç«™</span>
                <span class="value" id="good-count">-</span>
            </div>
        </div>

        <!-- æ§åˆ¶åˆ— -->
        <div class="controls">
            <input 
                type="text" 
                id="search-input" 
                placeholder="ğŸ” æœå°‹æ¸¬ç«™åç¨± (ä¾‹å¦‚: æ¿æ©‹ã€å°ä¸­ã€é«˜é›„)..."
            >
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot good"></div>
                    <span>è‰¯å¥½</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot moderate"></div>
                    <span>æ™®é€š</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot unhealthy-sensitive"></div>
                    <span>æ•æ„Ÿæ—ç¾¤</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot unhealthy"></div>
                    <span>ä¸å¥åº·</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot very-unhealthy"></div>
                    <span>éå¸¸ä¸å¥åº·</span>
                </div>
            </div>
        </div>

        <!-- éŒ¯èª¤è¨Šæ¯å€ -->
        <div id="error-container" style="display: none;">
            <div class="error-message">
                <span class="icon"><i class="fas fa-exclamation-circle"></i></span>
                <span id="error-text">ç„¡æ³•è¼‰å…¥ç©ºå“è³‡æ–™ï¼Œè«‹é‡æ–°æ•´ç†é é¢</span>
            </div>
        </div>

        <!-- å…§å®¹å€ -->
        <div id="air-dashboard">
            <!-- åœ°åœ– -->
            <div id="air-map">
                <div class="map-loading">
                    <div class="spinner"></div>
                    <p>æ­£åœ¨è¼‰å…¥åœ°åœ–...</p>
                </div>
            </div>

            <!-- å¡ç‰‡åˆ—è¡¨ -->
            <div class="air-list-container">
                <div class="list-header">ç©ºå“æ¸¬ç«™åˆ—è¡¨</div>
                <div id="air-grid"></div>
            </div>
        </div>
    </div>

    <!-- Google Analytics (å¯é¸) -->
    <script>
        // === AQI å·¥å…·å‡½æ•¸ ===
        function getAQIColor(aqi) {
            if (aqi <= 50) return { code: '#009966', name: 'è‰¯å¥½' };
            if (aqi <= 100) return { code: '#ffde33', name: 'æ™®é€š' };
            if (aqi <= 150) return { code: '#ff9933', name: 'å°æ•æ„Ÿæ—ç¾¤ä¸å¥åº·' };
            if (aqi <= 200) return { code: '#cc0033', name: 'å°æ‰€æœ‰æ—ç¾¤ä¸å¥åº·' };
            if (aqi <= 300) return { code: '#660099', name: 'éå¸¸ä¸å¥åº·' };
            return { code: '#7e0023', name: 'å±å®³' };
        }

        function getAQIShortName(aqi) {
            if (aqi <= 50) return 'è‰¯å¥½';
            if (aqi <= 100) return 'æ™®é€š';
            if (aqi <= 150) return 'æ•æ„Ÿæ—ç¾¤';
            if (aqi <= 200) return 'ä¸å¥åº·';
            if (aqi <= 300) return 'éå¸¸ä¸å¥åº·';
            return 'å±å®³';
        }

        // === å…¨å±€è®Šæ•¸ ===
        let allStations = [];
        let map = null;
        let markers = [];
        let mapInitialized = false;

        // === åˆå§‹åŒ– ===
        async function initAirPage() {
            try {
                // åˆå§‹åŒ–åœ°åœ–
                initMap();

                // æŠ“å–è³‡æ–™
                const stations = await fetchAirQualityData();
                allStations = stations;

                // æ’åºï¼šç©ºæ°£æœ€å·®æ’æœ€å‰
                allStations.sort((a, b) => b.aqi - a.aqi);

                // æ¸²æŸ“ UI
                renderUI(allStations);
                updateStats(allStations);

                // ç¶å®šæœå°‹
                bindSearchEvent();

                // éš±è—åœ°åœ–åŠ è¼‰ç‹€æ…‹
                document.querySelector('.map-loading').style.display = 'none';

            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±æ•—:', error);
                showError(`ç„¡æ³•è¼‰å…¥ç©ºå“è³‡æ–™: ${error.message}`);
            }
        }

        // === åˆå§‹åŒ–åœ°åœ– ===
        function initMap() {
            if (mapInitialized) return;

            map = L.map('air-map').setView([23.6, 121.0], 7);

            // æ·»åŠ åœ°åœ–ç“¦ç‰‡
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                attribution: 'Â© OpenStreetMap, Â© CartoDB',
                maxZoom: 19
            }).addTo(map);

            mapInitialized = true;
        }

        // === æŠ“å–ç©ºå“è³‡æ–™ ===
        async function fetchAirQualityData() {
            // âœ¨ æ”¹é€²ï¼šä¸å†ç›´æ¥å‘¼å«ç’°ä¿ç½² API (æœƒè¢« CORS æ“‹)
            // æ”¹æˆå‘¼å«è‡ªå·±çš„å¾Œç«¯ API (Cloudflare Functions)
            // é€™æ¨£çš„å¥½è™•ï¼š
            // 1. è§£æ±º CORS å•é¡Œ
            // 2. API Key ä¸æœƒæ´©æ¼ (è—åœ¨å¾Œç«¯ç’°å¢ƒè®Šæ•¸)
            // 3. è‡ªå‹•å¿«å– 10 åˆ†é˜ï¼Œç¯€çœ API é¡åº¦
            // 4. è³‡æ–™å·²ç¶“éæ¸…æ´—ï¼Œåªæœ‰éœ€è¦çš„æ¬„ä½

            try {
                // âœ… æ”¹æˆå‘¼å«è‡ªå·±çš„å¾Œç«¯ API
                const response = await fetch('/api/air-quality');
                
                if (!response.ok) {
                    throw new Error(`API Error: HTTP ${response.status}`);
                }

                // å¾Œç«¯å·²ç¶“æ¸…æ´—éè³‡æ–™ï¼Œç›´æ¥å›å‚³é™£åˆ—
                const stations = await response.json();

                if (!Array.isArray(stations)) {
                    throw new Error('è³‡æ–™æ ¼å¼ç•°å¸¸');
                }

                // è³‡æ–™å·²ç¶“æ¸…æ´—éäº†ï¼Œç›´æ¥å›å‚³
                return stations.filter(s => s.lat && s.lon); // éæ¿¾æœ‰æ•ˆåº§æ¨™

            } catch (error) {
                console.error('ğŸŒ¤ï¸ ç©ºå“ API è¼‰å…¥å¤±æ•—:', error);
                console.warn('æç¤ºï¼šè«‹ç¢ºä¿ Cloudflare å¾Œå°å·²è¨­å®š MOENV_API_KEY ç’°å¢ƒè®Šæ•¸');
                
                // å¦‚æœå¤±æ•—ï¼Œè¿”å›ç¤ºç¯„è³‡æ–™
                return getDefaultData();
            }
        }

        // === ç¤ºç¯„è³‡æ–™ ===
        function getDefaultData() {
            return [
                { id: '1', name: 'æ¿æ©‹', county: 'æ–°åŒ—å¸‚', lat: 25.0092, lon: 121.4605, aqi: 78, pm25: 25, pm10: 45 },
                { id: '2', name: 'å°åŒ—', county: 'å°åŒ—å¸‚', lat: 25.0330, lon: 121.5654, aqi: 65, pm25: 18, pm10: 35 },
                { id: '3', name: 'æ–°èŠ', county: 'æ–°åŒ—å¸‚', lat: 25.0586, lon: 121.4308, aqi: 82, pm25: 28, pm10: 52 },
                { id: '4', name: 'å°ä¸­', county: 'å°ä¸­å¸‚', lat: 24.1477, lon: 120.6736, aqi: 95, pm25: 35, pm10: 68 },
                { id: '5', name: 'é«˜é›„', county: 'é«˜é›„å¸‚', lat: 22.6428, lon: 120.3014, aqi: 88, pm25: 31, pm10: 58 },
            ];
        }

        // === æ¸²æŸ“ UI ===
        function renderUI(stations) {
            const grid = document.getElementById('air-grid');
            grid.innerHTML = '';

            // æ¸…é™¤èˆŠæ¨™è¨˜
            markers.forEach(m => {
                if (map && map.hasLayer(m)) {
                    map.removeLayer(m);
                }
            });
            markers = [];

            if (stations.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ”</div>
                        <p>æ‰¾ä¸åˆ°ç¬¦åˆçš„æ¸¬ç«™</p>
                        <p style="font-size: 0.85em; color: #ccc;">è©¦è©¦å…¶ä»–æœå°‹è©å½™</p>
                    </div>
                `;
                return;
            }

            // æ¸²æŸ“å¡ç‰‡
            stations.forEach((st, index) => {
                const color = getAQIColor(st.aqi);
                const statusName = getAQIShortName(st.aqi);

                // å»ºç«‹å¡ç‰‡
                const card = document.createElement('div');
                card.className = 'air-card';
                card.style.borderLeftColor = color.code;

                const pm25Text = st.pm25 ? `${st.pm25.toFixed(1)} Î¼g/mÂ³` : '-';

                card.innerHTML = `
                    <div class="card-name">
                        <span>${st.name}</span>
                        <span class="county">${st.county}</span>
                    </div>
                    <div class="aqi-display">
                        <span class="aqi-val" style="color: ${color.code};">${st.aqi}</span>
                        <span class="status-badge">${statusName}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">PM2.5:</span>
                        <span class="detail-value">${pm25Text}</span>
                    </div>
                `;

                // é»æ“Šå¡ç‰‡ï¼Œåœ°åœ–é£›åˆ°è©²ä½ç½®
                card.onclick = () => {
                    if (map) {
                        map.flyTo([st.lat, st.lon], 13, { duration: 0.8 });
                    }
                };

                grid.appendChild(card);

                // å»ºç«‹åœ°åœ–æ¨™è¨˜
                if (st.lat && st.lon && map) {
                    const marker = L.circleMarker([st.lat, st.lon], {
                        radius: 8,
                        fillColor: color.code,
                        color: '#fff',
                        weight: 2,
                        opacity: 1,
                        fillOpacity: 0.85
                    }).bindPopup(`
                        <div style="width: 150px;">
                            <strong>${st.name}</strong><br>
                            <span style="color: #999; font-size: 0.9em;">${st.county}</span>
                            <hr style="margin: 8px 0; border: none; border-top: 1px solid #e0e0e0;">
                            <div style="font-size: 0.9em; line-height: 1.6;">
                                <div><strong>AQI: <span style="color: ${color.code}; font-size: 1.2em;">${st.aqi}</span></strong> (${statusName})</div>
                                <div>PM2.5: <strong>${pm25Text}</strong></div>
                                ${st.pm10 ? `<div>PM10: <strong>${st.pm10.toFixed(1)}</strong></div>` : ''}
                            </div>
                        </div>
                    `);

                    marker.addTo(map);
                    markers.push(marker);
                }
            });
        }

        // === æ›´æ–°çµ±è¨ˆ ===
        function updateStats(stations) {
            if (stations.length === 0) {
                document.getElementById('total-stations').textContent = '-';
                document.getElementById('avg-aqi').textContent = '-';
                document.getElementById('worst-station').textContent = '-';
                document.getElementById('good-count').textContent = '-';
                return;
            }

            // è¨ˆç®—çµ±è¨ˆ
            const totalAQI = stations.reduce((sum, s) => sum + s.aqi, 0);
            const avgAQI = Math.round(totalAQI / stations.length);
            const worstStation = stations[0];
            const goodCount = stations.filter(s => s.aqi <= 50).length;

            document.getElementById('total-stations').textContent = stations.length;
            document.getElementById('avg-aqi').textContent = avgAQI;
            document.getElementById('worst-station').textContent = `${worstStation.name} (${worstStation.aqi})`;
            document.getElementById('good-count').textContent = goodCount;

            // æ ¹æ“šå¹³å‡å€¼è‘—è‰²
            const avgColor = getAQIColor(avgAQI);
            document.getElementById('avg-aqi').style.color = avgColor.code;

            // æ ¹æ“šæœ€å·®å€¼è‘—è‰²
            const worstColor = getAQIColor(worstStation.aqi);
            document.getElementById('worst-station').style.color = worstColor.code;
        }

        // === ç¶å®šæœå°‹äº‹ä»¶ ===
        function bindSearchEvent() {
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                const filtered = allStations.filter(s => 
                    s.name.toLowerCase().includes(term) || 
                    s.county.toLowerCase().includes(term)
                );
                renderUI(filtered);
                updateStats(filtered);
            });
        }

        // === é¡¯ç¤ºéŒ¯èª¤ ===
        function showError(message) {
            const container = document.getElementById('error-container');
            const textEl = document.getElementById('error-text');
            textEl.textContent = message;
            container.style.display = 'block';
        }

        // === å•Ÿå‹• ===
        document.addEventListener('DOMContentLoaded', initAirPage);

        // è‡ªå‹•æ¯ 10 åˆ†é˜åˆ·æ–°ä¸€æ¬¡è³‡æ–™
        setInterval(() => {
            console.log('è‡ªå‹•åˆ·æ–°ç©ºå“è³‡æ–™...');
            initAirPage();
        }, 600000);

        // å…¨å±€éŒ¯èª¤è™•ç†
        window.addEventListener('error', (e) => {
            console.error('å…¨å±€éŒ¯èª¤:', e.error);
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('æœªè™•ç†çš„ Promise æ‹’çµ•:', e.reason);
        });
    </script>
</body>
</html>
