<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>空品測站除錯</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; background: #f5f5f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .debug-info { background: white; padding: 20px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .cameras-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0; }
        @media (max-width: 768px) { .cameras-grid { grid-template-columns: 1fr; } }
        .camera-card { background: white; border-radius: 10px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .camera-card h3 { color: #9C27B0; margin-bottom: 10px; }
        .station-image { width: 100%; height: 200px; background: #f0f0f0; border-radius: 8px; overflow: hidden; margin: 10px 0; }
        .station-image img { width: 100%; height: 100%; object-fit: cover; }
        .no-image { color: #999; text-align: center; padding: 60px 20px; }
        .status-badge { position: absolute; top: 10px; right: 10px; padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; color: white; background: #FF9800; }
    </style>
</head>
<body>
    <div class="container">
        <h1>空品測站除錯頁面</h1>
        
        <div class="debug-info">
            <h3>除錯資訊</h3>
            <div id="debugLog"></div>
        </div>
        
        <div id="cameras-container">載入中...</div>
    </div>

    <script>
        function log(message) {
            const debugLog = document.getElementById('debugLog');
            debugLog.innerHTML += '<p>' + new Date().toLocaleTimeString() + ': ' + message + '</p>';
            console.log(message);
        }

        function loadTestData() {
            log('開始載入測試資料...');
            
            const mockData = {
                records: [
                    {
                        sitename: '中山',
                        county: '臺北市',
                        aqi: '42',
                        status: '良好',
                        publishtime: new Date().toISOString(),
                        pm2_5: '15',
                        pm10: '28',
                        o3: '45',
                        co: '0.3',
                        so2: '2',
                        no2: '18',
                        siteid: 'TPE001',
                        imageUrl: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&h=600&fit=crop&auto=format',
                        location: '臺北市中山區中山北路二段',
                        elevation: '8公尺',
                        coordinates: '25.0635°N, 121.5230°E'
                    },
                    {
                        sitename: '萬華',
                        county: '臺北市',
                        aqi: '58',
                        status: '普通',
                        publishtime: new Date(Date.now() - 1000*60*30).toISOString(),
                        pm2_5: '22',
                        pm10: '35',
                        o3: '38',
                        co: '0.4',
                        so2: '3',
                        no2: '25',
                        siteid: 'TPE002',
                        imageUrl: 'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=800&h=600&fit=crop&auto=format',
                        location: '臺北市萬華區和平西路三段',
                        elevation: '6公尺',
                        coordinates: '25.0308°N, 121.5077°E'
                    }
                ]
            };
            
            log('測試資料包含 ' + mockData.records.length + ' 個測站');
            log('第一個測站: ' + mockData.records[0].sitename);
            
            processAirQualityData(mockData);
        }

        function processAirQualityData(data) {
            log('處理空品資料: ' + data.records.length + ' 個測站');
            
            const container = document.getElementById('cameras-container');
            
            const html = data.records.map(station => {
                const name = station.sitename || '未命名測站';
                const county = station.county || '未知地區';
                const aqi = station.aqi || 'N/A';
                
                log('處理測站: ' + name + ', 縣市: ' + county + ', AQI: ' + aqi);
                
                // 建立影像區塊
                const imageHtml = station.imageUrl ? 
                    `<div class="station-image">
                        <img src="${station.imageUrl}" alt="${name}測站影像" onerror="this.parentElement.innerHTML='<div class=\\'no-image\\'><i class=\\'fas fa-camera-slash\\'></i><br>影像載入失敗</div>'">
                    </div>` :
                    `<div class="station-image">
                        <div class="no-image">
                            <i class="fas fa-camera-slash"></i><br>
                            無影像資料
                        </div>
                    </div>`;
                
                return `
                    <div class="camera-card" style="position: relative;">
                        <div class="status-badge">模擬</div>
                        <h3><i class="fas fa-map-marker-alt"></i> ${name}</h3>
                        <p style="color: #888;"><i class="fas fa-map"></i> ${county}</p>
                        
                        ${imageHtml}
                        
                        <div style="margin-top: 10px;">
                            <div style="font-size: 0.9rem; color: #666;">空氣品質指標</div>
                            <div style="font-size: 1.5rem; font-weight: bold; color: #4CAF50;">${aqi}</div>
                            <div style="font-size: 0.8rem; color: #666;">良好</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = `<div class="cameras-grid">${html}</div>`;
            
            log('頁面更新完成');
        }

        // 頁面載入時執行
        document.addEventListener('DOMContentLoaded', function() {
            log('頁面載入完成，開始測試...');
            setTimeout(loadTestData, 1000);
        });
    </script>
</body>
</html>