<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§ª é›·é”è½‰æ›å·¥å…·æ¸¬è©¦</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .header h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .test-section {
            margin-bottom: 25px;
            padding-bottom: 25px;
            border-bottom: 1px solid #e2e8f0;
        }

        .test-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .test-section h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 10px;
        }

        button:hover {
            background: #5568d3;
        }

        button:active {
            transform: scale(0.98);
        }

        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        select, input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        .output-box {
            background: #f7fafc;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .success { color: #276749; background: #f0fff4; border-color: #48bb78; }
        .error { color: #742a2a; background: #fff5f5; border-color: #f56565; }
        .info { color: #2c5282; background: #ebf8ff; border-color: #4299e1; }

        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 6px;
            background: #f7fafc;
            border-left: 4px solid #667eea;
        }

        .result.success {
            background: #f0fff4;
            border-left-color: #48bb78;
        }

        .result.error {
            background: #fff5f5;
            border-left-color: #f56565;
        }

        .result-title {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .result-item {
            margin: 5px 0;
            font-size: 13px;
            word-break: break-all;
        }

        .station-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin: 15px 0;
        }

        .station-btn {
            padding: 8px 12px;
            background: #e2e8f0;
            color: #333;
            border: 2px solid transparent;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
        }

        .station-btn:hover {
            background: #cbd5e0;
        }

        .station-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .console {
            background: #1a202c;
            color: #68d391;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª RadarTransformer æ¸¬è©¦å·¥å…·</h1>
            <p>ç›´æ¥æ¸¬è©¦ RadarTransformer çš„ API é€£æ¥å’Œ XML è§£æåŠŸèƒ½</p>
        </div>

        <div class="content">
            <!-- ç¬¬ä¸€éƒ¨åˆ†ï¼šç›´æ¥ API æ¸¬è©¦ -->
            <div class="test-section">
                <h2>ğŸ“¡ ç¬¬ä¸€æ­¥ï¼šç›´æ¥ API æ¸¬è©¦</h2>
                <p style="margin-bottom: 15px; color: #666;">é¸æ“‡ä¸€å€‹é›·é”ç«™é€²è¡Œ API æ¸¬è©¦</p>
                
                <div class="station-selector">
                    <button class="station-btn active" onclick="selectStation('001')">ğŸ¯ 001 (æ°´æ—)</button>
                    <button class="station-btn" onclick="selectStation('002')">ğŸ¯ 002 (å—å±¯)</button>
                    <button class="station-btn" onclick="selectStation('003')">ğŸ¯ 003 (æ—åœ’)</button>
                    <button class="station-btn" onclick="selectStation('101')">ğŸŒ 101 (é™„è¿‘)</button>
                    <button class="station-btn" onclick="selectStation('102')">ğŸŒ 102 (å¤§ç¯„åœ)</button>
                </div>

                <button onclick="testDirectAPI()">ğŸš€ ç™¼é€ API è«‹æ±‚</button>

                <div id="api-result" class="output-box info" style="display: none;"></div>
            </div>

            <!-- ç¬¬äºŒéƒ¨åˆ†ï¼šXML è§£ææ¸¬è©¦ -->
            <div class="test-section">
                <h2>ğŸ§¬ ç¬¬äºŒæ­¥ï¼šXML è§£ææ¸¬è©¦</h2>
                <p style="margin-bottom: 15px; color: #666;">è²¼ä¸Š API å›æ‡‰çš„ XML æˆ– JSON ä¸¦æ¸¬è©¦è§£æ</p>
                
                <div class="input-group">
                    <label for="xml-input">XML/JSON å›æ‡‰ï¼š</label>
                    <textarea id="xml-input" placeholder="è²¼ä¸Š API å›æ‡‰..."></textarea>
                </div>

                <button onclick="testXMLParsing()">ğŸ” è§£æ XML/JSON</button>
                <button onclick="clearXMLInput()">ğŸ—‘ï¸ æ¸…é™¤</button>

                <div id="parse-result" class="output-box info" style="display: none;"></div>
            </div>

            <!-- ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®Œæ•´è½‰æ›æµç¨‹æ¸¬è©¦ -->
            <div class="test-section">
                <h2>âš™ï¸ ç¬¬ä¸‰æ­¥ï¼šå®Œæ•´è½‰æ›æµç¨‹</h2>
                <p style="margin-bottom: 15px; color: #666;">ä½¿ç”¨ RadarTransformer å®Œæ•´çš„ getRadarEchoMap æ–¹æ³•</p>
                
                <button onclick="testFullTransform()">ğŸš€ æ¸¬è©¦å®Œæ•´æµç¨‹</button>

                <div id="transform-result" class="output-box info" style="display: none;"></div>
            </div>

            <!-- ç¬¬å››éƒ¨åˆ†ï¼šæ§åˆ¶å° -->
            <div class="test-section">
                <h2>ğŸ“‹ å³æ™‚æ§åˆ¶å°è¼¸å‡º</h2>
                <div id="console" class="console"></div>
            </div>
        </div>
    </div>

    <script src="Road-Camera/assets/radar-transformer.js"></script>

    <script>
        let selectedStation = '001';
        const consoleLogs = [];

        // æ””æˆªæ§åˆ¶å°è¼¸å‡º
        const origLog = console.log;
        const origError = console.error;
        const origWarn = console.warn;

        console.log = function(...args) {
            origLog.apply(console, args);
            addConsoleLog(args.join(' '));
        };
        console.error = function(...args) {
            origError.apply(console, args);
            addConsoleLog('âŒ ' + args.join(' '));
        };
        console.warn = function(...args) {
            origWarn.apply(console, args);
            addConsoleLog('âš ï¸ ' + args.join(' '));
        };

        function addConsoleLog(msg) {
            consoleLogs.push(msg);
            const consoleEl = document.getElementById('console');
            consoleEl.innerHTML = consoleLogs.slice(-30).join('\n');
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        function selectStation(code) {
            selectedStation = code;
            document.querySelectorAll('.station-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        async function testDirectAPI() {
            const resultEl = document.getElementById('api-result');
            resultEl.className = 'output-box info';
            resultEl.textContent = 'â³ æ­£åœ¨è«‹æ±‚ API...';
            resultEl.style.display = 'block';

            try {
                console.log(`\n${'='.repeat(60)}`);
                console.log(`æ¸¬è©¦ç›´æ¥ API - ç«™é» ${selectedStation}`);
                console.log(`${'='.repeat(60)}`);

                // ä½¿ç”¨ RadarTransformer çš„æ–¹æ³•
                const result = await RadarTransformer.getRadarEchoMap(selectedStation);

                console.log(`æœ€çµ‚çµæœ:`, result);

                if (result.error) {
                    resultEl.className = 'output-box error';
                    resultEl.innerHTML = `âŒ éŒ¯èª¤:\n${result.error}`;
                } else {
                    resultEl.className = 'output-box success';
                    resultEl.innerHTML = `âœ… æˆåŠŸ!\n\n${JSON.stringify(result, null, 2)}`;
                }

            } catch (error) {
                console.error('API æ¸¬è©¦å¤±æ•—:', error);
                resultEl.className = 'output-box error';
                resultEl.innerHTML = `âŒ ç•°å¸¸:\n${error.message}\n\n${error.stack}`;
            }
        }

        function testXMLParsing() {
            const input = document.getElementById('xml-input').value.trim();
            const resultEl = document.getElementById('parse-result');

            if (!input) {
                alert('è«‹å…ˆè²¼ä¸Š XML/JSON å›æ‡‰');
                return;
            }

            try {
                console.log(`\n${'='.repeat(60)}`);
                console.log(`æ¸¬è©¦ XML/JSON è§£æ`);
                console.log(`${'='.repeat(60)}`);

                let result;
                if (input.includes('<?xml') || input.includes('<') || input.includes('cwaopendata')) {
                    console.log('åµæ¸¬ç‚º XML æ ¼å¼');
                    result = RadarTransformer.parseRadarXML(input);
                } else if (input.startsWith('{')) {
                    console.log('åµæ¸¬ç‚º JSON æ ¼å¼');
                    result = JSON.parse(input);
                } else {
                    throw new Error('æœªçŸ¥æ ¼å¼');
                }

                console.log('è§£æçµæœ:', result);

                if (result.success === false || !result.imageUrl) {
                    resultEl.className = 'output-box error';
                    resultEl.innerHTML = `âŒ è§£æå¤±æ•—\n\n${JSON.stringify(result, null, 2)}`;
                } else {
                    resultEl.className = 'output-box success';
                    resultEl.innerHTML = `âœ… è§£ææˆåŠŸ\n\n${JSON.stringify(result, null, 2)}`;
                }

                resultEl.style.display = 'block';

            } catch (error) {
                console.error('è§£æç•°å¸¸:', error);
                resultEl.className = 'output-box error';
                resultEl.innerHTML = `âŒ ç•°å¸¸:\n${error.message}`;
                resultEl.style.display = 'block';
            }
        }

        function clearXMLInput() {
            document.getElementById('xml-input').value = '';
            document.getElementById('parse-result').style.display = 'none';
        }

        async function testFullTransform() {
            const resultEl = document.getElementById('transform-result');
            resultEl.className = 'output-box info';
            resultEl.textContent = 'â³ æ­£åœ¨åŸ·è¡Œå®Œæ•´è½‰æ›æµç¨‹...';
            resultEl.style.display = 'block';

            try {
                console.log(`\n${'='.repeat(60)}`);
                console.log(`å®Œæ•´è½‰æ›æµç¨‹ - æ‰€æœ‰ç«™é»`);
                console.log(`${'='.repeat(60)}`);

                const results = await RadarTransformer.getAllRadarEchoMaps();

                console.log('æ‰€æœ‰çµæœ:', results);

                const summary = {
                    ç¸½è¨ˆ: results.length,
                    æˆåŠŸ: results.filter(r => !r.error).length,
                    å¤±æ•—: results.filter(r => r.error).length,
                    è©³ç´°: results
                };

                resultEl.className = results.filter(r => r.error).length === 0 ? 'output-box success' : 'output-box error';
                resultEl.innerHTML = JSON.stringify(summary, null, 2);

            } catch (error) {
                console.error('è½‰æ›å¤±æ•—:', error);
                resultEl.className = 'output-box error';
                resultEl.innerHTML = `âŒ ç•°å¸¸:\n${error.message}`;
            }
        }

        // æª¢æŸ¥ RadarTransformer æ˜¯å¦å·²è¼‰å…¥
        window.addEventListener('load', () => {
            console.log('é é¢å·²è¼‰å…¥');
            if (typeof RadarTransformer !== 'undefined') {
                console.log('âœ… RadarTransformer å·²æˆåŠŸè¼‰å…¥');
                console.log('å¯ç”¨æ–¹æ³•:', Object.getOwnPropertyNames(RadarTransformer).filter(name => typeof RadarTransformer[name] === 'function'));
            } else {
                console.error('âŒ RadarTransformer æœªæˆåŠŸè¼‰å…¥');
            }
        });
    </script>
</body>
</html>
