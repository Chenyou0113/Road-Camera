<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°éµå³æ™‚åˆ°é›¢ç«™çœ‹æ¿ - TDX</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/dark-mode.css">
    <link rel="stylesheet" href="assets/mobile-responsive.css">
    <script>window.CURRENT_PAGE = 'train-liveboard';</script>
    <script src="assets/config.js"></script>
    <script src="assets/tdx-api.js"></script>
    <script src="assets/station-code-mapping.js"></script>
    <script src="assets/train-line-classification.js"></script>
    <script src="assets/train-data-transformer.js"></script>
    <script src="assets/train-liveboard-manager.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Microsoft JhengHei', Arial, sans-serif; 
            background: linear-gradient(135deg, #1e40af 0%, #0891b2 100%); 
            min-height: 100vh; 
        }
        .header { 
            background: white; 
            padding: 20px 0; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 0 20px; 
        }
        .header h1 { 
            color: #1e40af; 
            text-align: center; 
            margin-bottom: 10px; 
        }
        .header p {
            text-align: center;
            color: #666;
            font-size: 0.95rem;
        }
        .back-btn { 
            display: inline-block; 
            padding: 10px 20px; 
            background: #1e40af; 
            color: white; 
            text-decoration: none; 
            border-radius: 5px; 
            margin: 20px 0; 
            transition: background 0.3s;
        }
        .back-btn:hover { 
            background: #0891b2; 
        }
        .loading { 
            text-align: center; 
            padding: 50px; 
            color: white; 
            font-size: 1.2rem; 
        }
        
        /* è»Šç«™é¸æ“‡å€åŸŸ */
        .station-selector { 
            background: white; 
            margin: 20px 0; 
            padding: 25px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .station-selector h3 { 
            color: #1e40af; 
            margin-bottom: 15px; 
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .selector-row { 
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 15px; 
            align-items: end;
        }
        .selector-group { 
            display: flex; 
            flex-direction: column; 
        }
        .selector-group label { 
            margin-bottom: 8px; 
            font-weight: bold; 
            color: #333; 
        }
        .selector-group select { 
            padding: 12px; 
            border-radius: 8px; 
            border: 2px solid #1e40af; 
            font-size: 1rem; 
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        .selector-group select:hover {
            border-color: #0891b2;
        }
        .selector-group select:focus {
            outline: none;
            border-color: #0891b2;
            box-shadow: 0 0 0 3px rgba(118, 75, 162, 0.1);
        }
        .selector-group button { 
            padding: 12px 25px; 
            background: #1e40af; 
            color: white; 
            cursor: pointer; 
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
        }
        .selector-group button:hover { 
            background: #0891b2; 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .selector-group button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        /* åˆ—è»Šçœ‹æ¿å€åŸŸ */
        .liveboard-container {
            background: white;
            margin: 20px 0;
            padding: 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .liveboard-header {
            background: linear-gradient(135deg, #1e40af 0%, #0891b2 100%);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .liveboard-header h2 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .update-time {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        /* åˆ—è»Šè¡¨æ ¼ */
        .train-table {
            width: 100%;
            border-collapse: collapse;
        }
        .train-table thead {
            background: #f8f9fa;
        }
        .train-table th {
            padding: 15px;
            text-align: left;
            font-weight: bold;
            color: #1e40af;
            border-bottom: 2px solid #1e40af;
        }
        .train-table td {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        .train-table tbody tr:hover {
            background: #f8f9fa;
        }
        .train-number {
            font-weight: bold;
            color: #1e40af;
            font-size: 1.1rem;
        }
        .train-type {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-right: 8px;
        }
        .train-type.express { background: #ff6b6b; color: white; }
        .train-type.local { background: #4ecdc4; color: white; }
        .train-type.limited { background: #ffd93d; color: #333; }
        .train-type.chu-kuang { background: #ff8c42; color: white; }
        .train-type.tze-chiang { background: #e74c3c; color: white; }
        .train-type.tze-chiang-normal { background: #e74c3c; color: white; font-weight: bold; }
        .train-type.tze-chiang-3000 { background: #FF0000; color: white; font-weight: bold; box-shadow: 0 0 8px rgba(255, 0, 0, 0.5); }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: bold;
        }
        .status-badge.ontime { background: #27ae60; color: white; }
        .status-badge.delayed { background: #e74c3c; color: white; }
        .status-badge.early { background: #3498db; color: white; }
        
        .direction-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.85rem;
            background: #1e40af;
            color: white;
        }
        
        /* ç¯©é¸æŒ‰éˆ• */
        .filter-btn {
            padding: 8px 15px;
            background: white;
            border: 2px solid #1e40af;
            color: #1e40af;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .filter-btn:hover {
            background: #f0f7ff;
            transform: translateY(-2px);
        }
        
        .filter-btn.active {
            background: #1e40af;
            color: white;
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
        }
        
        /* å‹•ç•« */
        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .train-table tbody tr {
            animation: slideIn 0.3s ease-out;
        }

        /* å·²é›¢ç«™åˆ—è»Šæ¨£å¼ */
        .train-table tr.departed-train {
            opacity: 0.6;
        }
        .train-table tr.departed-train td {
            color: #999;
            text-decoration: line-through;
        }
        .train-table tr.departed-train .train-number,
        .train-table tr.departed-train .status-badge,
        .train-table tr.departed-train .direction-badge,
        .train-table tr.departed-train .train-type {
            opacity: 0.6;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        .no-data i {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }
        
        /* çµ±è¨ˆé¢æ¿ */
        .stats-panel { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin: 20px 0; 
        }
        .stat-card { 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            text-align: center; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .stat-number { 
            font-size: 2rem; 
            font-weight: bold; 
            color: #1e40af; 
        }
        .stat-label { 
            color: #666; 
            margin-top: 5px; 
        }
        
        /* è³‡è¨Šé¢æ¿ - å¢å¼·ç‰ˆ */
        .info-panel {
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
            border-left: 5px solid #d32f2f;
            border-right: 1px solid #ddd;
            border-top: 1px solid #ddd;
            border-bottom: 1px solid #ddd;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .info-panel h3 {
            color: #d32f2f;
            margin: 0 0 15px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
        }
        .info-panel h3 i:first-child {
            margin-right: 10px;
        }
        .info-panel p {
            color: #333;
            line-height: 1.6;
            margin: 10px 0;
        }
        .info-panel ul {
            color: #333;
            line-height: 1.8;
        }
        .info-panel ol {
            color: #333;
            line-height: 1.8;
        }
        .info-panel details {
            color: #666;
        }
        .info-panel summary {
            color: #1e40af;
        }
        
        /* æ·±è‰²æ¨¡å¼ */
        body.dark-mode {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        body.dark-mode .header {
            background: linear-gradient(135deg, rgba(40,40,50,0.95) 0%, rgba(30,30,40,0.85) 100%);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        body.dark-mode .header h1 {
            color: #66BB6A;
        }
        body.dark-mode .header p {
            color: rgba(255,255,255,0.7);
        }
        body.dark-mode .back-btn {
            background: #66BB6A;
            color: #1a1a2e;
        }
        body.dark-mode .back-btn:hover {
            background: #81C784;
        }
        body.dark-mode .station-selector {
            background: linear-gradient(135deg, rgba(40,40,50,0.95) 0%, rgba(30,30,40,0.85) 100%);
            border: 1px solid rgba(255,255,255,0.1);
        }
        body.dark-mode .station-selector h3 {
            color: #66BB6A;
        }
        body.dark-mode .selector-group label {
            color: rgba(255,255,255,0.9);
        }
        body.dark-mode .selector-group select {
            background: rgba(255,255,255,0.1);
            color: white;
            border-color: #66BB6A;
        }
        body.dark-mode .selector-group select option {
            background: #2a2a3e;
            color: white;
        }
        body.dark-mode .selector-group button {
            background: #66BB6A;
            color: #1a1a2e;
        }
        body.dark-mode .selector-group button:hover {
            background: #81C784;
        }
        body.dark-mode .liveboard-container {
            background: linear-gradient(135deg, rgba(40,40,50,0.95) 0%, rgba(30,30,40,0.85) 100%);
            border: 1px solid rgba(255,255,255,0.1);
        }
        body.dark-mode .liveboard-header {
            background: linear-gradient(135deg, #66BB6A 0%, #81C784 100%);
            color: #1a1a2e;
        }
        body.dark-mode .train-table thead {
            background: rgba(102, 187, 106, 0.1);
        }
        body.dark-mode .train-table th {
            color: #66BB6A;
            border-bottom-color: #66BB6A;
        }
        body.dark-mode .train-table td {
            color: rgba(255,255,255,0.9);
            border-bottom-color: rgba(255,255,255,0.1);
        }
        body.dark-mode .train-table tbody tr:hover {
            background: rgba(102, 187, 106, 0.1);
        }
        body.dark-mode .train-number {
            color: #66BB6A;
        }
        body.dark-mode .stat-card {
            background: linear-gradient(135deg, rgba(40,40,50,0.95) 0%, rgba(30,30,40,0.85) 100%);
            border: 1px solid rgba(255,255,255,0.1);
        }
        body.dark-mode .stat-number {
            color: #66BB6A;
        }
        body.dark-mode .stat-label {
            color: rgba(255,255,255,0.7);
        }
        body.dark-mode .info-panel {
            background: linear-gradient(135deg, rgba(60,50,50,0.95) 0%, rgba(50,40,40,0.95) 100%);
            border-left-color: #ff6b6b;
            box-shadow: 0 2px 8px rgba(0,0,0,0.5);
        }
        body.dark-mode .info-panel h3 {
            color: #ff6b6b;
        }
        body.dark-mode .info-panel p {
            color: rgba(255,255,255,0.85);
        }
        body.dark-mode .info-panel ul {
            color: rgba(255,255,255,0.85);
        }
        body.dark-mode .info-panel ol {
            color: rgba(255,255,255,0.85);
        }
        body.dark-mode .info-panel ol li {
            color: rgba(255,255,255,0.85) !important;
        }
        body.dark-mode .info-panel ul li {
            color: rgba(255,255,255,0.85) !important;
        }
        body.dark-mode .info-panel details {
            background: rgba(30,30,40,0.8);
            color: rgba(255,255,255,0.8);
        }
        body.dark-mode .info-panel details > div {
            background: rgba(40,40,50,0.95) !important;
        }
        body.dark-mode .info-panel details p,
        body.dark-mode .info-panel details ol,
        body.dark-mode .info-panel details li,
        body.dark-mode .info-panel details strong {
            color: rgba(255,255,255,0.9) !important;
        }
        body.dark-mode .info-panel a {
            color: #66BB6A !important;
        }
        body.dark-mode .info-panel summary {
            color: #66BB6A;
        }
        body.dark-mode .no-data {
            color: rgba(255,255,255,0.5);
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .selector-row {
                grid-template-columns: 1fr;
            }
            .train-table {
                font-size: 0.9rem;
            }
            .train-table th,
            .train-table td {
                padding: 10px 8px;
            }
            .stats-panel {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .stats-panel {
                grid-template-columns: 1fr;
            }
        }
    </style>
    
    <!-- è¼‰å…¥é€²åº¦æ¢ -->
    <script src="assets/loading-progress.js"></script>
    <script>
        window.AUTO_START_LOADING = false;
        
        window.addEventListener('DOMContentLoaded', () => {
            window.startLoading({
                labelText: 'åˆå§‹åŒ–å°éµå³æ™‚çœ‹æ¿...',
                color: '#1e40af',
                showLabel: true
            });
        });
    </script>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1><i class="fas fa-train"></i> å°éµå³æ™‚åˆ°é›¢ç«™çœ‹æ¿</h1>
            <p>å³æ™‚æŸ¥è©¢è»Šç«™åˆ—è»Šåˆ°é›¢ç«™è³‡è¨Šï¼ˆå‹•æ…‹å‰å¾Œ30åˆ†é˜ï¼‰</p>
        </div>
    </div>

    <div class="container">
        <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> è¿”å›é¦–é </a>
            <button class="theme-toggle" id="themeToggle" title="Toggle Dark Mode" style="width: 45px; height: 45px; border-radius: 50%; background: linear-gradient(135deg, #1e40af, #0891b2); color: white; border: none; cursor: pointer; margin-left: 15px; font-size: 1.2rem;">
                <i class="fas fa-moon"></i>
            </button>
        
        <!-- è³‡è¨Šé¢æ¿ - åŒ…å«é‡è¦æ•¸æ“šå»¶é²å’Œä¾†æºèªªæ˜ -->
        <div class="info-panel" id="infoPanel">
            <h3 onclick="toggleInfoPanel()">
                <span>
                    <i class="fas fa-info-circle"></i>
                    é‡è¦èªªæ˜ - å°éµå³æ™‚çœ‹æ¿æ•¸æ“šä¾†æº
                </span>
                <i id="toggleIcon" class="fas fa-chevron-up" style="transition: transform 0.3s ease;"></i>
            </h3>
            <div id="infoContent">
                <!-- é‡è¦è­¦å‘Š - æ•¸æ“šå»¶é² -->
                <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 12px; margin-bottom: 15px; border-radius: 4px;">
                    <p style="margin: 0; color: #856404;">
                        <strong style="font-size: 1.1em;">â±ï¸ é‡è¦æç¤ºï¼šæœ¬çœ‹æ¿è³‡æ–™å»¶é²ç´„ <span style="color: #d32f2f; font-size: 1.15em;">2 åˆ†é˜</span></strong>
                    </p>
                    <p style="margin: 5px 0 0 0; color: #856404; font-size: 0.95em;">
                        æœ¬è³‡æ–™ä¾†è‡ªå°éµå®˜æ–¹ TDX å¹³å°ï¼Œæ˜¯ç¶“éè™•ç†è½‰æ›çš„æ•¸æ“šï¼Œä¸æ˜¯å³æ™‚ç›´æ’­è³‡æ–™ã€‚
                    </p>
                </div>

                <!-- æ•¸æ“šä¾†æºèªªæ˜ -->
                <div style="margin-bottom: 15px;">
                    <p style="margin: 0 0 8px 0;">
                        <strong>ğŸ“Š è³‡æ–™ä¾†æºèˆ‡è™•ç†æ–¹å¼ï¼š</strong>
                    </p>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #555;">
                        <li>æœ¬çœ‹æ¿è³‡æ–™ä¾†è‡ªäº¤é€šéƒ¨ TDX äº¤é€šè³‡æ–™æµé€šæœå‹™å¹³å°</li>
                        <li>TDX å°‡å°éµã€Œåˆ—è»Šå³æ™‚æº–é»/èª¤é»è³‡æ–™ã€èˆ‡ã€Œæ¯æ—¥æ™‚åˆ»è¡¨ã€çµåˆè½‰æ›è€Œæˆ</li>
                        <li>è³‡æ–™æœƒç¶“éç´„ 2 åˆ†é˜çš„è™•ç†å’Œå‚³è¼¸å»¶é²</li>
                        <li>æœ¬çœ‹æ¿æ¯ 2 åˆ†é˜è‡ªå‹•æ›´æ–°ä¸€æ¬¡</li>
                    </ul>
                </div>

                <!-- èˆ‡ç«™å…§é¡¯ç¤ºçš„å·®ç•° -->
                <div style="background: #f3e5f5; border-left: 4px solid #9c27b0; padding: 12px; margin-bottom: 15px; border-radius: 4px;">
                    <p style="margin: 0 0 8px 0; color: #4a148c;">
                        <strong>âš ï¸ èˆ‡ç«™å…§ TIDS é¡¯ç¤ºçš„å·®ç•°ï¼š</strong>
                    </p>
                    <p style="margin: 0; color: #4a148c; font-size: 0.95em;">
                        æœ¬çœ‹æ¿è³‡æ–™ï¼ˆä¾†è‡ª TDXï¼‰èˆ‡ç«™å…§æœˆå°ä¸Šé¡¯ç¤ºçš„ã€Œåˆ—è»Šå³æ™‚åˆ°é›¢ç«™é›»å­çœ‹æ¿ã€ï¼ˆTIDSï¼‰è³‡æ–™ä¾†æºä¸åŒï¼Œ
                        <strong>ç„¡æ³•ä¿è­‰å®Œå…¨ä¸€è‡´</strong>ã€‚å»ºè­°æŸ¥è©¢å¾Œç›´æ¥é€²å…¥è»Šç«™æœˆå°å€åŸŸï¼Œ
                        <strong style="color: #d32f2f;">ä»¥ç«™å…§ TIDS é¡¯ç¤ºç‚ºä¸»</strong>ã€‚
                    </p>
                </div>

                <!-- ä½¿ç”¨å»ºè­° -->
                <div style="margin-bottom: 15px;">
                    <p style="margin: 0 0 8px 0;">
                        <strong>ğŸ‘¥ ä½¿ç”¨å»ºè­°ï¼š</strong>
                    </p>
                    <ul style="margin: 5px 0; padding-left: 20px; color: #555;">
                        <li>æœ¬çœ‹æ¿é©åˆäº†è§£è»Šæ¬¡åˆ°é›¢ç‹€æ…‹æˆ–è¦åŠƒè¡Œç¨‹ä½¿ç”¨</li>
                        <li>é‡è¦è¡Œç¨‹è«‹é€²å…¥è»Šç«™å¾Œä»¥ç«™å…§ TIDS æœˆå°é¡¯ç¤ºç‚ºæº–</li>
                        <li>é‡åˆ°ç•°å¸¸å»¶èª¤å¯è©¢å•ç«™å‹™äººå“¡æœ€æ–°ç‹€æ³</li>
                    </ul>
                </div>

                <!-- æŠ€è¡“ç´°ç¯€ï¼ˆå¯é¸å±•é–‹ï¼‰ -->
                <details style="background: #f5f5f5; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                    <summary style="cursor: pointer; font-weight: bold; color: #1e40af;">
                        ğŸ”§ æŠ€è¡“ç´°ç¯€ï¼ˆè³‡æ–™è½‰æ›æ–¹æ³•ï¼‰
                    </summary>
                    <div style="margin-top: 10px; font-size: 0.9em; color: #333; padding: 10px; background: #ffffff; border-radius: 3px;">
                        <p style="margin: 0 0 8px 0; color: #333;">
                            <strong style="color: #222;">TDX è³‡æ–™è½‰æ›æµç¨‹ï¼š</strong>
                        </p>
                        <ol style="margin: 5px 0; padding-left: 20px; color: #333;">
                            <li style="color: #333;">å°éµæä¾›ï¼šæ—¥å¸¸æ™‚åˆ»è¡¨ + å³æ™‚åˆ—è»Šå»¶èª¤è³‡è¨Š</li>
                            <li style="color: #333;">TDX è™•ç†ï¼šçµåˆæ™‚åˆ»è¡¨å’Œå»¶èª¤è³‡è¨Šï¼Œè½‰æ›æˆè»Šç«™åˆ¥ã€æ–¹å‘åˆ¥çš„åˆ°é›¢ç«™è³‡æ–™</li>
                            <li style="color: #333;">è³‡æ–™è¼¸å‡ºï¼šä»¥ã€ŒStationLiveBoardã€æ ¼å¼æä¾›å‰å¾Œ 30 åˆ†é˜åˆ—è»Šè³‡è¨Š</li>
                            <li style="color: #333;">æœ¬çœ‹æ¿ï¼šé€²ä¸€æ­¥ç¯©é¸å’Œçµ„ç¹”æˆç”¨æˆ¶å‹å–„çš„è¡¨æ ¼å½¢å¼</li>
                        </ol>
                        <p style="margin: 8px 0 0 0; font-style: italic; color: #666;">
                            å› æ­¤æœ¬è³‡æ–™ç‚ºã€Œæº–å¯¦æ™‚ã€è€Œéã€Œå®Œå…¨å¯¦æ™‚ã€
                        </p>

                        <p style="margin: 15px 0 8px 0; color: #333;">
                            <strong style="color: #222;">è»Šç«™ä»£ç¢¼ç³»çµ±èªªæ˜ï¼š</strong>
                        </p>
                        <table style="width: 100%; border-collapse: collapse; margin: 8px 0; color: #333;">
                            <tr style="background: #f9f9f9;">
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;"><strong>ä»£ç¢¼é¡å‹</strong></th>
                                <th style="border: 1px solid #ddd; padding: 8px; text-align: left;"><strong>ç”¨é€”</strong></th>
                            </tr>
                            <tr>
                                <td style="border: 1px solid #ddd; padding: 8px; color: #333;"><strong>StationID</strong></td>
                                <td style="border: 1px solid #ddd; padding: 8px; color: #333;">åˆ—è»Šæ’é»ç³»çµ±ä»£ç¢¼ï¼ˆæœ¬çœ‹æ¿ä½¿ç”¨ TDX API æŸ¥è©¢ï¼‰</td>
                            </tr>
                            <tr style="background: #f9f9f9;">
                                <td style="border: 1px solid #ddd; padding: 8px; color: #333;"><strong>StationCode</strong></td>
                                <td style="border: 1px solid #ddd; padding: 8px; color: #333;">ç¥¨å‹™ç³»çµ±è»Šç«™ç°¡ç¢¼ï¼ˆè¨‚ç¥¨ç³»çµ±ä½¿ç”¨ï¼‰</td>
                            </tr>
                        </table>
                        <p style="margin: 8px 0 0 0; font-size: 0.85em; color: #666;">
                            â„¹ï¸ <strong>æ³¨æ„ï¼š</strong>å…©å€‹ç³»çµ±çš„ä»£ç¢¼å¯èƒ½ä¸åŒã€‚åŠ å€¼æ¥­è€…ï¼ˆå¦‚æœ¬çœ‹æ¿ï¼‰éœ€äº†è§£å·®ç•°ä¸¦é€²è¡Œé©ç•¶çš„ç³»çµ±è½‰æ›ã€‚
                        </p>
                    </div>
                </details>

                <!-- ç›¸é—œè³‡æºé€£çµ -->
                <p style="margin-top: 15px; margin-bottom: 5px;">
                    <strong>ğŸ“š ç›¸é—œè³‡æºï¼š</strong>
                </p>
                <p style="margin: 5px 0;">
                    ğŸ”— <a href="https://tdx.transportdata.tw" target="_blank" style="color: #1e40af; text-decoration: none; font-weight: bold;">
                        TDX äº¤é€šè³‡æ–™æµé€šæœå‹™å¹³å° <i class="fas fa-external-link-alt" style="font-size: 0.75rem;"></i>
                    </a>
                </p>
                <p style="margin: 5px 0;">
                    ğŸ”— <a href="https://www.tra.gov.tw" target="_blank" style="color: #1e40af; text-decoration: none; font-weight: bold;">
                        å°ç£éµè·¯ç®¡ç†å±€å®˜æ–¹ç¶²ç«™ <i class="fas fa-external-link-alt" style="font-size: 0.75rem;"></i>
                    </a>
                </p>
            </div>
        </div>

        <!-- çµ±è¨ˆé¢æ¿ -->
        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-number" id="totalTrains">0</div>
                <div class="stat-label">åˆ—è»Šç¸½æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="departureTrains">0</div>
                <div class="stat-label">å³å°‡é›¢ç«™</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="delayedTrains">0</div>
                <div class="stat-label">å»¶èª¤åˆ—è»Š</div>
            </div>
        </div>

        <!-- è»Šç«™é¸æ“‡ -->
        <div class="station-selector">
            <h3><i class="fas fa-map-marker-alt"></i> é¸æ“‡è»Šç«™</h3>
            <div class="selector-row">
                <div class="selector-group">
                    <label for="lineSelect">è·¯ç·š</label>
                    <select id="lineSelect" onchange="onLineChange()">
                        <option value="">è«‹é¸æ“‡è·¯ç·š</option>
                        <option value="all">å…¨éƒ¨è»Šç«™</option>
                        <option value="westernMain">è¥¿éƒ¨å¹¹ç·š</option>
                        <option value="westernCoast">è¥¿éƒ¨å¹¹ç·š-æµ·ç·š</option>
                        <option value="easternMain">æ±éƒ¨å¹¹ç·š</option>
                        <option value="southLink">å±æ±-å—è¿´ç·š</option>
                        <option value="pingxiLine">å¹³æºªç·š</option>
                        <option value="neiwanLine">å…§ç£ç·š</option>
                        <option value="jijiLine">é›†é›†ç·š</option>
                        <option value="chengzhuiLine">æˆè¿½ç·š</option>
                        <option value="shalunLine">æ²™å´™ç·š</option>
                        <option value="liujiaLine">å…­å®¶ç·š</option>
                        <option value="shenaLine">æ·±æ¾³ç·š</option>
                    </select>
                </div>
                <div class="selector-group">
                    <label for="stationSelect">è»Šç«™</label>
                    <select id="stationSelect">
                        <option value="">è«‹å…ˆé¸æ“‡è·¯ç·š</option>
                    </select>
                </div>
                <div class="selector-group">
                    <label>&nbsp;</label>
                    <button onclick="queryLiveboard()" id="queryBtn">
                        <i class="fas fa-search"></i> æŸ¥è©¢çœ‹æ¿
                    </button>
                </div>
            </div>
        </div>

        <!-- çœ‹æ¿å®¹å™¨ -->
        <div id="liveboardContainer" style="display: none;">
            <div class="liveboard-container">
                <div class="liveboard-header">
                    <h2 id="stationTitle">
                        <i class="fas fa-train"></i>
                        <span id="stationName">é¸æ“‡è»Šç«™</span>
                    </h2>
                    <div class="update-time">
                        <i class="fas fa-clock"></i> æ›´æ–°æ™‚é–“ï¼š<span id="updateTime">--</span>
                        <i class="fas fa-sync-alt" id="refreshIcon" style="margin-left: 15px; cursor: pointer; transition: transform 0.3s ease;" title="ç«‹å³åˆ·æ–°"></i>
                    </div>
                </div>

                <!-- ç¯©é¸å’Œæ’åºæ§ä»¶ -->
                <div style="background: #f8f9fa; padding: 15px 20px; border-bottom: 1px solid #e0e0e0; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                    <div style="display: flex; gap: 10px;">
                        <button class="filter-btn" data-filter="all" onclick="setFilter('all')" title="é¡¯ç¤ºå…¨éƒ¨åœé åˆ—è»Š">
                            <i class="fas fa-list"></i> å…¨éƒ¨
                        </button>
                        <button class="filter-btn" data-filter="arrival" onclick="setFilter('arrival')" title="åªé¡¯ç¤ºå³å°‡åˆ°ç«™">
                            <i class="fas fa-arrow-down"></i> åˆ°ç«™
                        </button>
                        <button class="filter-btn" data-filter="departure" onclick="setFilter('departure')" title="åªé¡¯ç¤ºå³å°‡é›¢ç«™">
                            <i class="fas fa-arrow-up"></i> é›¢ç«™
                        </button>
                        <button class="filter-btn" data-filter="delayed" onclick="setFilter('delayed')" title="åªé¡¯ç¤ºå»¶èª¤åˆ—è»Š">
                            <i class="fas fa-exclamation-triangle"></i> å»¶èª¤
                        </button>
                        <button class="filter-btn" data-filter="pass-through" onclick="setFilter('pass-through')" title="é¡¯ç¤ºé€šéä¸åœçš„åˆ—è»Š">
                            <i class="fas fa-forward"></i> é€šéä¸åœ
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-left: auto;">
                        <select id="sortSelect" onchange="setSort(this.value)" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 5px; background: white; cursor: pointer;">
                            <option value="time">æ™‚é–“é †åº</option>
                            <option value="trainNo">è»Šæ¬¡æ’åº</option>
                            <option value="type">è»Šç¨®åˆ†é¡</option>
                            <option value="delay">å»¶èª¤æ’åº</option>
                        </select>
                        <button onclick="exportTableData()" style="padding: 8px 12px; background: #1e40af; color: white; border: none; border-radius: 5px; cursor: pointer; transition: all 0.3s;">
                            <i class="fas fa-download"></i> åŒ¯å‡º
                        </button>
                    </div>
                </div>
                <table class="train-table">
                    <thead>
                        <tr>
                            <th>è»Šæ¬¡</th>
                            <th>è»Šç¨®</th>
                            <th>æ–¹å‘</th>
                            <th>çµ‚é»ç«™</th>
                            <th>æ™‚é–“</th>
                            <th>ç‹€æ…‹</th>
                        </tr>
                    </thead>
                    <tbody id="trainTableBody">
                        <tr>
                            <td colspan="7" class="no-data">
                                <i class="fas fa-train"></i>
                                <p>è«‹é¸æ“‡è»Šç«™ä¸¦æŸ¥è©¢</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="assets/navbar.js"></script>
    <script src="assets/dark-mode.js"></script>
    <script>
        // å°éµè»Šç«™è³‡æ–™ï¼ˆå…§åµŒï¼‰
        const stationData = {
            western: [
                {name:"åŸºéš†",code:"0900"},{name:"ä¸‰å‘",code:"0910"},{name:"å…«å µ",code:"0920"},{name:"ä¸ƒå µ",code:"0930"},{name:"ç™¾ç¦",code:"0940"},{name:"äº”å µ",code:"0950"},{name:"æ±æ­¢",code:"0960"},{name:"æ±ç§‘",code:"0970"},{name:"å—æ¸¯",code:"0980"},{name:"æ¾å±±",code:"0990"},{name:"è‡ºåŒ—",code:"1000"},{name:"è¬è¯",code:"1010"},{name:"æ¿æ©‹",code:"1020"},{name:"æµ®æ´²",code:"1030"},{name:"æ¨¹æ—",code:"1040"},{name:"å—æ¨¹æ—",code:"1050"},{name:"å±±ä½³",code:"1060"},{name:"é¶¯æ­Œ",code:"1070"},{name:"æ¡ƒåœ’",code:"1080"},{name:"å…§å£¢",code:"1090"},{name:"ä¸­å£¢",code:"1100"},{name:"åŸ”å¿ƒ",code:"1110"},{name:"æ¥Šæ¢…",code:"1120"},{name:"å¯Œå²¡",code:"1130"},{name:"æ–°å¯Œ",code:"1140"},{name:"åŒ—æ¹–",code:"1150"},{name:"æ¹–å£",code:"1160"},{name:"æ–°è±",code:"1170"},{name:"ç«¹åŒ—",code:"1180"},{name:"åŒ—æ–°ç«¹",code:"1190"},{name:"æ–°ç«¹",code:"1210"},{name:"ä¸‰å§“æ©‹",code:"1220"},{name:"é¦™å±±",code:"1230"},{name:"å´é ‚",code:"1240"},{name:"ç«¹å—",code:"1250"},{name:"é€ æ©‹",code:"3140"},{name:"è±å¯Œ",code:"3150"},{name:"è‹—æ —",code:"3160"},{name:"å—å‹¢",code:"3170"},{name:"éŠ…é‘¼",code:"3180"},{name:"ä¸‰ç¾©",code:"3190"},{name:"æ³°å®‰",code:"3210"},{name:"åé‡Œ",code:"3220"},{name:"è±åŸ",code:"3230"},{name:"æ —æ—",code:"3240"},{name:"æ½­å­",code:"3250"},{name:"é ­å®¶å",code:"3260"},{name:"æ¾ç«¹",code:"3270"},{name:"å¤ªåŸ",code:"3280"},{name:"ç²¾æ­¦",code:"3290"},{name:"è‡ºä¸­",code:"3300"},{name:"äº”æ¬Š",code:"3310"},{name:"å¤§æ…¶",code:"3320"},{name:"çƒæ—¥",code:"3330"},{name:"æ–°çƒæ—¥",code:"3340"},{name:"æˆåŠŸ",code:"3350"},{name:"å½°åŒ–",code:"3360"},{name:"èŠ±å£‡",code:"3370"},{name:"å¤§æ‘",code:"3380"},{name:"å“¡æ—",code:"3390"},{name:"æ°¸é–",code:"3400"},{name:"ç¤¾é ­",code:"3410"},{name:"ç”°ä¸­",code:"3420"},{name:"äºŒæ°´",code:"3430"},{name:"æ—å…§",code:"3450"},{name:"çŸ³æ¦´",code:"3460"},{name:"æ–—å…­",code:"3470"},{name:"æ–—å—",code:"3480"},{name:"çŸ³é¾œ",code:"3490"},{name:"å¤§æ—",code:"4050"},{name:"æ°‘é›„",code:"4060"},{name:"å˜‰åŒ—",code:"4070"},{name:"å˜‰ç¾©",code:"4080"},{name:"æ°´ä¸Š",code:"4090"},{name:"å—é–",code:"4100"},{name:"å¾Œå£",code:"4110"},{name:"æ–°ç‡Ÿ",code:"4120"},{name:"æŸ³ç‡Ÿ",code:"4130"},{name:"æ—é³³ç‡Ÿ",code:"4140"},{name:"éš†ç”°",code:"4150"},{name:"æ‹”æ—",code:"4160"},{name:"å–„åŒ–",code:"4170"},{name:"å—ç§‘",code:"4180"},{name:"æ–°å¸‚",code:"4190"},{name:"æ°¸åº·",code:"4200"},{name:"å¤§æ©‹",code:"4210"},{name:"è‡ºå—",code:"4220"},{name:"æ—æ£®",code:"4230"},{name:"å—è‡ºå—",code:"4240"},{name:"ä¿å®‰",code:"4250"},{name:"ä»å¾·",code:"4260"},{name:"ä¸­æ´²",code:"4270"},{name:"å¤§æ¹–",code:"4290"},{name:"è·¯ç«¹",code:"4300"},{name:"å²¡å±±",code:"4310"},{name:"æ©‹é ­",code:"4320"},{name:"æ¥ æ¢“",code:"4330"},{name:"æ–°å·¦ç‡Ÿ",code:"4340"},{name:"å·¦ç‡Ÿ",code:"4350"},{name:"å…§æƒŸ",code:"4360"},{name:"ç¾è¡“é¤¨",code:"4370"},{name:"é¼“å±±",code:"4380"},{name:"ä¸‰å¡Šå",code:"4390"},{name:"é«˜é›„",code:"4400"},{name:"æ°‘æ—",code:"4410"},{name:"ç§‘å·¥é¤¨",code:"4420"},{name:"æ­£ç¾©",code:"4430"},{name:"é³³å±±",code:"4440"},{name:"å¾Œåº„",code:"4450"},{name:"ä¹æ›²å ‚",code:"4460"},{name:"å…­å¡Šå",code:"4470"},{name:"å±æ±",code:"5000"}
            ],
            coastal: [
                {name:"è«‡æ–‡",code:"2110"},{name:"å¤§å±±",code:"2120"},{name:"å¾Œé¾",code:"2130"},{name:"é¾æ¸¯",code:"2140"},{name:"ç™½æ²™å±¯",code:"2150"},{name:"æ–°åŸ”",code:"2160"},{name:"é€šéœ„",code:"2170"},{name:"è‹‘è£¡",code:"2180"},{name:"æ—¥å—",code:"2190"},{name:"å¤§ç”²",code:"2200"},{name:"è‡ºä¸­æ¸¯",code:"2210"},{name:"æ¸…æ°´",code:"2220"},{name:"æ²™é¹¿",code:"2230"},{name:"é¾äº•",code:"2240"},{name:"å¤§è‚š",code:"2250"},{name:"è¿½åˆ†",code:"2260"}
            ],
            eastern: [
                {name:"å…«å µ",code:"0920"},{name:"æš–æš–",code:"7390"},{name:"å››è…³äº­",code:"7380"},{name:"ç‘èŠ³",code:"7360"},{name:"çŒ´ç¡",code:"7350"},{name:"ä¸‰è²‚å¶º",code:"7330"},{name:"ç‰¡ä¸¹",code:"7320"},{name:"é›™æºª",code:"7310"},{name:"è²¢å¯®",code:"7300"},{name:"ç¦éš†",code:"7290"},{name:"çŸ³åŸ",code:"7280"},{name:"å¤§é‡Œ",code:"7270"},{name:"å¤§æºª",code:"7260"},{name:"é¾œå±±",code:"7250"},{name:"å¤–æ¾³",code:"7240"},{name:"é ­åŸ",code:"7230"},{name:"é ‚åŸ”",code:"7220"},{name:"ç¤æºª",code:"7210"},{name:"å››åŸ",code:"7200"},{name:"å®œè˜­",code:"7190"},{name:"äºŒçµ",code:"7180"},{name:"ä¸­é‡Œ",code:"7170"},{name:"ç¾…æ±",code:"7160"},{name:"å†¬å±±",code:"7150"},{name:"æ–°é¦¬",code:"7140"},{name:"è˜‡æ¾³æ–°ç«™",code:"7130"},{name:"è˜‡æ¾³",code:"7120"},{name:"æ°¸æ¨‚",code:"7110"},{name:"æ±æ¾³",code:"7100"},{name:"å—æ¾³",code:"7090"},{name:"æ­¦å¡”",code:"7080"},{name:"æ¼¢æœ¬",code:"7070"},{name:"å’Œå¹³",code:"7060"},{name:"å’Œä»",code:"7050"},{name:"å´‡å¾·",code:"7040"},{name:"æ–°åŸ",code:"7030"},{name:"æ™¯ç¾",code:"7020"},{name:"åŒ—åŸ”",code:"7010"},{name:"èŠ±è“®",code:"7000"},{name:"å‰å®‰",code:"6250"},{name:"å¿—å­¸",code:"6240"},{name:"å¹³å’Œ",code:"6230"},{name:"å£½è±",code:"6220"},{name:"è±ç”°",code:"6210"},{name:"æ—æ¦®æ–°å…‰",code:"6200"},{name:"å—å¹³",code:"6190"},{name:"é³³æ—",code:"6180"},{name:"è¬æ¦®",code:"6170"},{name:"å…‰å¾©",code:"6160"},{name:"å¤§å¯Œ",code:"6150"},{name:"å¯Œæº",code:"6140"},{name:"ç‘ç©—",code:"6130"},{name:"ä¸‰æ°‘",code:"6120"},{name:"ç‰é‡Œ",code:"6110"},{name:"æ±é‡Œ",code:"6100"},{name:"æ±ç«¹",code:"6090"},{name:"å¯Œé‡Œ",code:"6080"},{name:"æ± ä¸Š",code:"6070"},{name:"æµ·ç«¯",code:"6060"},{name:"é—œå±±",code:"6050"},{name:"ç‘å’Œ",code:"6040"},{name:"ç‘æº",code:"6030"},{name:"é¹¿é‡",code:"6020"},{name:"å±±é‡Œ",code:"6010"},{name:"è‡ºæ±",code:"6000"}
            ],
            southLink: [
                {name:"å±æ±",code:"5000"},{name:"æ­¸ä¾†",code:"5010"},{name:"éºŸæ´›",code:"5020"},{name:"è¥¿å‹¢",code:"5030"},{name:"ç«¹ç”°",code:"5040"},{name:"æ½®å·",code:"5050"},{name:"å´é ‚",code:"5060"},{name:"å—å·",code:"5070"},{name:"é®å®‰",code:"5080"},{name:"æ—é‚Š",code:"5090"},{name:"ä½³å†¬",code:"5100"},{name:"æ±æµ·",code:"5110"},{name:"æ‹å¯®",code:"5120"},{name:"åŠ ç¥¿",code:"5130"},{name:"å…§ç…",code:"5140"},{name:"æ‹å±±",code:"5160"},{name:"å¤§æ­¦",code:"5190"},{name:"ç€§æºª",code:"5200"},{name:"é‡‘å´™",code:"5210"},{name:"å¤ªéº»é‡Œ",code:"5220"},{name:"çŸ¥æœ¬",code:"5230"},{name:"åº·æ¨‚",code:"5240"},{name:"è‡ºæ±",code:"6000"}
            ]
        };
        
        let stationsByLine = {};
        let allStations = [];
        let currentStationId = '';
        let currentStationName = '';
        let allTrains = []; // ä¿å­˜æ‰€æœ‰åŸå§‹åˆ—è»Šè³‡æ–™ - åˆå§‹ç‚ºç©º
        let allApiTrains = []; // ä¿å­˜ API å›æ‡‰çš„å…¨éƒ¨åˆ—è»Šï¼ˆç”¨æ–¼è­˜åˆ¥é€šéä¸åœçš„åˆ—è»Šï¼‰
        let currentFilterMode = 'arrival'; // é è¨­ç¯©é¸æ¨¡å¼
        let currentSortMode = 'time';
        let autoRefreshInterval = null;
        let isDataLoaded = false; // ç”¨æ–¼è¿½è¹¤æ˜¯å¦å·²æŸ¥è©¢éè»Šç«™

        /**
         * è¨­ç½®ç¯©é¸æ¨¡å¼
         */
        function setFilter(mode) {
            currentFilterMode = mode;
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-filter="${mode}"]`).classList.add('active');
            
            // é‡æ–°é¡¯ç¤ºåˆ—è»Š
            applyFiltersAndSort();
        }

        /**
         * è¨­ç½®æ’åºæ¨¡å¼
         */
        function setSort(mode) {
            currentSortMode = mode;
            applyFiltersAndSort();
        }

        /**
         * æ‡‰ç”¨ç¯©é¸å’Œæ’åº
         */
        function applyFiltersAndSort() {
            // ã€æ–°å¢ã€‘å¦‚æœæ˜¯ã€Œé€šéä¸åœã€æ¨¡å¼ï¼Œä½¿ç”¨ allApiTrainsï¼›å¦å‰‡ä½¿ç”¨ allTrains
            let sourceTrains = currentFilterMode === 'pass-through' ? allApiTrains : allTrains;
            let filtered = trainLiveboardManager.filterTrains(sourceTrains, currentFilterMode);
            let sorted = trainLiveboardManager.sortTrains(filtered, currentSortMode);
            displayTrains(sorted);
        }

        /**
         * ç«‹å³åˆ·æ–°
         */
        function quickRefresh() {
            const icon = document.getElementById('refreshIcon');
            if (icon) {
                icon.style.animation = 'spin 1s linear';
                setTimeout(() => {
                    icon.style.animation = '';
                }, 1000);
            }
            loadLiveboard();
        }

        /**
         * åŒ¯å‡ºè¡¨æ ¼è³‡æ–™
         */
        function exportTableData() {
            trainLiveboardManager.exportToCSV(allTrains);
        }

        // è¼‰å…¥è»Šç«™ä»£ç¢¼è³‡æ–™ï¼ˆä½¿ç”¨æ–°çš„è·¯ç·šåˆ†é¡ç³»çµ±ï¼‰
        function loadStationData() {
            console.log('è¼‰å…¥è·¯ç·šåˆ†é¡è³‡æ–™');
            
            // ä½¿ç”¨æ–°çš„è·¯ç·šåˆ†é¡ç³»çµ±
            if (typeof trainLineClassification !== 'undefined') {
                // å°‡è·¯ç·šåˆ†é¡è½‰æ›ç‚ºé é¢ä½¿ç”¨çš„æ ¼å¼
                // æ³¨æ„ï¼šä½¿ç”¨ StationID è€Œä¸æ˜¯ StationCode
                stationsByLine = {};
                for (const [lineKey, lineData] of Object.entries(trainLineClassification)) {
                    stationsByLine[lineKey] = lineData.stations.map(s => {
                        const stationId = getStationIdFromCode(s.code);
                        return {
                            id: stationId,        // ä½¿ç”¨ StationIDï¼ˆç”¨æ–¼ API æŸ¥è©¢ï¼‰
                            code: s.code,         // ä¿ç•™ StationCodeï¼ˆç¥¨å‹™ç³»çµ±ç”¨ï¼‰
                            name: s.name
                        };
                    });
                }
                
                initAllStations();
                console.log('âœ… è»Šç«™è³‡æ–™è¼‰å…¥å®Œæˆï¼Œç¸½å…±', allStations.length, 'å€‹è»Šç«™');
                console.log('ğŸ“ è·¯ç·šæ•¸é‡:', Object.keys(stationsByLine).length);
                console.log('ğŸ“‹ æç¤ºï¼šç³»çµ±ä½¿ç”¨ StationID æŸ¥è©¢ APIï¼Œå¯é€é StationCode é€²è¡Œç¥¨å‹™ç³»çµ±è½‰æ›');
            } else {
                console.error('trainLineClassification æœªè¼‰å…¥');
            }
        }

        // åˆå§‹åŒ–æ‰€æœ‰è»Šç«™åˆ—è¡¨
        function initAllStations() {
            const stationSet = new Map(); // ä½¿ç”¨ Map ä¾†å»é‡
            
            for (const lineData of Object.values(stationsByLine)) {
                for (const station of lineData) {
                    if (!stationSet.has(station.id)) {
                        stationSet.set(station.id, station);
                    }
                }
            }
            
            allStations = Array.from(stationSet.values());
            allStations.sort((a, b) => a.id.localeCompare(b.id));
        }

        // è·¯ç·šè®Šæ›´äº‹ä»¶
        function onLineChange() {
            const lineSelect = document.getElementById('lineSelect');
            const stationSelect = document.getElementById('stationSelect');
            const selectedLine = lineSelect.value;

            if (!selectedLine) {
                stationSelect.innerHTML = '<option value="">è«‹å…ˆé¸æ“‡è·¯ç·š</option>';
                return;
            }

            let stations = [];
            if (selectedLine === 'all') {
                stations = allStations;
            } else if (stationsByLine[selectedLine]) {
                stations = stationsByLine[selectedLine];
            }
            
            stationSelect.innerHTML = '<option value="">è«‹é¸æ“‡è»Šç«™</option>' +
                stations.map(station => 
                    `<option value="${station.id}">${station.name}</option>`
                ).join('');
                
            console.log(`å·²è¼‰å…¥ ${stations.length} å€‹${selectedLine === 'all' ? 'å…¨éƒ¨' : trainLineClassification[selectedLine]?.name || selectedLine}è»Šç«™`);
        }

        // æŸ¥è©¢çœ‹æ¿
        async function queryLiveboard() {
            const stationSelect = document.getElementById('stationSelect');
            const selectedStationId = stationSelect.value;
            
            if (!selectedStationId) {
                alert('è«‹é¸æ“‡è»Šç«™');
                return;
            }

            currentStationId = selectedStationId;
            currentStationName = stationSelect.options[stationSelect.selectedIndex].text;

            await loadLiveboard();
            
            // å•Ÿå‹•è‡ªå‹•åˆ·æ–°ï¼ˆæ¯2åˆ†é˜ï¼‰
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            autoRefreshInterval = setInterval(loadLiveboard, 120000);
        }

        // è¼‰å…¥çœ‹æ¿è³‡æ–™
        async function loadLiveboard() {
            const container = document.getElementById('liveboardContainer');
            const stationTitle = document.getElementById('stationName');
            const tableBody = document.getElementById('trainTableBody');
            
            stationTitle.textContent = currentStationName;
            container.style.display = 'block';
            
            tableBody.innerHTML = `
                <tr>
                    <td colspan="7" class="no-data">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>è¼‰å…¥çœ‹æ¿è³‡æ–™ä¸­...</p>
                    </td>
                </tr>
            `;

            try {
                // ä½¿ç”¨æ­£ç¢ºçš„ LiveBoard API ç«¯é»
                const endpoint = `/v2/Rail/TRA/LiveBoard?StationID=${currentStationId}&$format=JSON`;
                const response = await tdxApi.fetch(endpoint);
                
                console.log('âœ… APIå›æ‡‰:', response);
                console.log('ğŸ” æŸ¥è©¢è»Šç«™ ID:', currentStationId, 'è»Šç«™å:', currentStationName);
                
                let trains = [];
                if (Array.isArray(response)) {
                    trains = response;
                }

                console.log(`ğŸ“Š API è¿”å› ${trains.length} ç­åˆ—è»Šè³‡è¨Šï¼ˆåŒ…å«å‰å¾Œç«™é»ï¼‰`);

                // ã€é‡è¦ä¿®å¾©ã€‘å®¢æˆ¶ç«¯ç¯©é¸ï¼šåˆ©ç”¨ StationID + StationName é›™é‡é©—è­‰
                // TDX API å¯èƒ½è¿”å›æ™‚é–“çª—å£å…§çš„æ‰€æœ‰åˆ—è»Šï¼Œéœ€è¦åŒæ™‚é©—è­‰ StationID å’Œ StationName
                const filteredTrains = trains.filter(train => {
                    // ç²å–ç•¶å‰æŸ¥è©¢è»Šç«™çš„åç¨±
                    const currentStationOption = document.getElementById('stationSelect').options[document.getElementById('stationSelect').selectedIndex];
                    const currentStationName = currentStationOption.text;
                    
                    // é›™é‡é©—è­‰ï¼šStationID å’Œ StationName éƒ½å¿…é ˆåŒ¹é…
                    const stationIdMatch = train.StationID === currentStationId;
                    const stationNameMatch = train.StationName?.Zh_tw === currentStationName || 
                                           train.StationName?.En === currentStationName;
                    
                    const hasStationStop = stationIdMatch && stationNameMatch;
                    
                    if (!hasStationStop) {
                        const trainStationName = train.StationName?.Zh_tw || train.StationName?.En || 'æœªçŸ¥';
                        if (!stationIdMatch && !stationNameMatch) {
                            console.warn(`âš ï¸ åˆ—è»Š ${train.TrainNo} è¢«éæ¿¾ï¼š[ID: ${train.StationID} vs ${currentStationId}] [åç¨±: ${trainStationName} vs ${currentStationName}]`);
                        } else if (!stationIdMatch) {
                            console.warn(`âš ï¸ åˆ—è»Š ${train.TrainNo} è¢«éæ¿¾ï¼šStationID ä¸ç¬¦ (${train.StationID} â‰  ${currentStationId})`);
                        } else {
                            console.warn(`âš ï¸ åˆ—è»Š ${train.TrainNo} è¢«éæ¿¾ï¼šStationName ä¸ç¬¦ (${trainStationName} â‰  ${currentStationName})`);
                        }
                    }
                    
                    return hasStationStop;
                });

                console.log(`âœ… ç¯©é¸çµæœï¼š${filteredTrains.length} ç­åˆ—è»ŠçœŸå¯¦åœé åœ¨ ${currentStationName} (${currentStationId})`);

                // ã€æ–°å¢ã€‘è¨ˆç®—é€šéä¸åœçš„åˆ—è»Š
                const passThroughTrains = trains.filter(train => {
                    // é€šéä¸åœ = API è¿”å›ä½†ä¸åœé åœ¨è©²ç«™çš„åˆ—è»Š
                    const stationIdMatch = train.StationID === currentStationId;
                    const stationNameMatch = train.StationName?.Zh_tw === currentStationName || 
                                           train.StationName?.En === currentStationName;
                    return !(stationIdMatch && stationNameMatch); // åè½‰é‚è¼¯ï¼šä¸ç¬¦åˆåœé æ¢ä»¶
                });
                console.log(`ğŸ“Š é€šéä¸åœçš„åˆ—è»Šï¼š${passThroughTrains.length} ç­`);

                // ä¿å­˜éæ¿¾å¾Œçš„åˆ—è»Šè³‡æ–™å’Œå…¨éƒ¨ API åˆ—è»Š
                allTrains = filteredTrains;
                allApiTrains = passThroughTrains; // ä¿å­˜é€šéä¸åœçš„åˆ—è»Š
                
                // æ¨™è¨˜å·²è¼‰å…¥éè³‡æ–™ï¼ˆé˜²æ­¢é¡¯ç¤ºç¤ºä¾‹æ•¸æ“šï¼‰
                isDataLoaded = true;
                
                // é è¨­ç¯©é¸ç‚º 'arrival'ï¼ˆå³å°‡åˆ°ç«™ï¼‰
                currentFilterMode = 'arrival';
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector('[data-filter="arrival"]').classList.add('active');

                updateUpdateTime();
                applyFiltersAndSort(); // ä½¿ç”¨ç¯©é¸å’Œæ’åºé¡¯ç¤º
                updateStats(filteredTrains);

                // æª¢æ¸¬ç•°å¸¸
                const anomalies = trainLiveboardManager.detectAnomalies(filteredTrains);
                if (anomalies.critical.length > 0) {
                    trainLiveboardManager.showToast(
                        'âš ï¸ åš´é‡è­¦ç¤º',
                        `æœ‰ ${anomalies.critical.length} ç­åˆ—è»Šåš´é‡å»¶èª¤ï¼`
                    );
                }

            } catch (error) {
                console.error('âŒ è¼‰å…¥çœ‹æ¿è³‡æ–™å¤±æ•—:', error);
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="no-data">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>è¼‰å…¥å¤±æ•—: ${error.message}</p>
                            <button onclick="loadLiveboard()" style="margin-top: 10px; padding: 8px 16px; background: #1e40af; color: white; border: none; border-radius: 5px; cursor: pointer;">
                                <i class="fas fa-refresh"></i> é‡æ–°è¼‰å…¥
                            </button>
                        </td>
                    </tr>
                `;
            }
        }

        // é¡¯ç¤ºåˆ—è»Šè³‡æ–™
        function displayTrains(trains) {
            const tableBody = document.getElementById('trainTableBody');
            
            // å¦‚æœæœªæŸ¥è©¢éè»Šç«™ï¼Œé¡¯ç¤ºæç¤º
            if (!isDataLoaded) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="no-data">
                            <i class="fas fa-train"></i>
                            <p>è«‹é¸æ“‡è»Šç«™ä¸¦æŸ¥è©¢</p>
                            <p style="font-size: 0.85rem; margin-top: 10px; color: #999;">
                                1. åœ¨ä¸Šæ–¹é¸æ“‡è·¯ç·š<br>
                                2. é¸æ“‡è»Šç«™<br>
                                3. é»æ“Šã€ŒæŸ¥è©¢çœ‹æ¿ã€æŒ‰éˆ•
                            </p>
                        </td>
                    </tr>
                `;
                return;
            }
            
            if (!trains || trains.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="no-data">
                            <i class="fas fa-info-circle"></i>
                            <p>ç›®å‰æ²’æœ‰åˆ—è»Šè³‡è¨Š</p>
                            <p style="font-size: 0.85rem; margin-top: 10px; color: #999;">
                                ${currentFilterMode === 'all' 
                                    ? 'å¯èƒ½åŸå› ï¼šæ­¤æ™‚æ®µæ²’æœ‰åˆ—è»Šç¶“éæ­¤ç«™ï¼Œæˆ–åˆ—è»Šå°šæœªç™¼è»Š'
                                    : 'æ²’æœ‰ç¬¦åˆç¯©é¸æ¢ä»¶çš„åˆ—è»Š'}
                            </p>
                        </td>
                    </tr>
                `;
                return;
            }

            const rows = trains.map(train => {
                const trainType = trainLiveboardManager.getTrainTypeInfo(train);
                const direction = train.Direction || 0;
                const directionIcon = direction === 0 ? 'arrow-down' : 'arrow-up';
                const directionText = direction === 0 ? 'å—ä¸‹' : 'åŒ—ä¸Š';
                
                // ã€æ”¹é€²ã€‘åªä½¿ç”¨é›¢ç«™æ™‚é–“
                const departureTime = trainLiveboardManager.formatTime(train.ScheduledDepartureTime);
                
                const status = trainLiveboardManager.getTrainStatus(train);
                
                // åˆ¤æ–·åˆ—è»Šæ˜¯å¦å·²é›¢ç«™
                const isDeparted = train.ActualDepartureTime ? true : false;
                const rowClass = isDeparted ? 'departed-train' : '';
                
                return `
                    <tr class="${rowClass}">
                        <td>
                            <span class="train-number">${train.TrainNo || 'æœªçŸ¥'}</span>
                        </td>
                        <td>
                            <span class="train-type ${trainType.class}">
                                <i class="${trainType.icon}"></i> ${trainType.name}
                            </span>
                        </td>
                        <td>
                            <span class="direction-badge">
                                <i class="fas fa-${directionIcon}"></i>
                                ${directionText}
                            </span>
                        </td>
                        <td>${train.EndingStationName?.Zh_tw || 'æœªçŸ¥'}</td>
                        <td>${departureTime}</td>
                        <td>
                            <span class="status-badge ${status.class}">
                                <i class="${status.icon}"></i> ${status.text}
                            </span>
                        </td>
                    </tr>
                `;
            }).join('');

            tableBody.innerHTML = rows;
        }

        // æ›´æ–°çµ±è¨ˆè³‡æ–™
        function updateStats(trains) {
            const total = trains.length;
            const departures = trains.filter(t => t.ScheduledDepartureTime).length;
            const delayed = trains.filter(t => (t.DelayTime || 0) > 5).length;

            document.getElementById('totalTrains').textContent = total;
            document.getElementById('departureTrains').textContent = departures;
            document.getElementById('delayedTrains').textContent = delayed;
        }

        // æ›´æ–°æ›´æ–°æ™‚é–“
        function updateUpdateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            document.getElementById('updateTime').textContent = timeStr;
        }

        // åˆ‡æ›è³‡è¨Šé¢æ¿
        function toggleInfoPanel() {
            const content = document.getElementById('infoContent');
            const icon = document.getElementById('toggleIcon');
            const panel = document.getElementById('infoPanel');
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                icon.className = 'fas fa-chevron-up';
                panel.style.background = '#e8f5e8';
            } else {
                content.style.display = 'none';
                icon.className = 'fas fa-chevron-down';
                panel.style.background = '#f5f5f5';
            }
        }

        // é é¢è¼‰å…¥å®Œæˆ
        window.onload = async function() {
            // å…ˆè¼‰å…¥è»Šç«™è³‡æ–™
            await loadStationData();
            
            // æ·»åŠ äº‹ä»¶ç›£è½å™¨
            const refreshIcon = document.getElementById('refreshIcon');
            if (refreshIcon) {
                refreshIcon.addEventListener('click', quickRefresh);
            }
            
            // å®Œæˆè¼‰å…¥é€²åº¦
            setTimeout(() => {
                if (typeof window.finishLoading === 'function') {
                    window.finishLoading();
                }
            }, 300);
        };
    </script>

    <!-- Back to Top Button -->
    <div class="back-to-top" id="backToTop" style="position: fixed; bottom: 30px; right: 30px; width: 50px; height: 50px; background: linear-gradient(135deg, #1e40af, #0891b2); border-radius: 50%; display: none; align-items: center; justify-content: center; color: white; cursor: pointer; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 999; font-size: 1.2rem;">
        <i class="fas fa-arrow-up"></i>
    </div>
</body>
</html>
