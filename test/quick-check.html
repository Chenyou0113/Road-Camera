<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>監視器縣市快速檢查</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { color: #333; margin-bottom: 20px; text-align: center; }
        .quick-check { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .check-btn { background: #2196F3; color: white; border: none; padding: 15px 30px; border-radius: 5px; cursor: pointer; margin: 10px 5px; font-size: 1.1rem; }
        .check-btn:hover { background: #1976D2; }
        .check-btn:disabled { background: #ccc; cursor: not-allowed; }
        .result-card { background: white; border-radius: 8px; padding: 20px; margin: 10px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .status { padding: 15px; border-radius: 5px; margin: 10px 0; text-align: center; font-size: 1.2rem; }
        .status.loading { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .status.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .status.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .status.warning { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; }
        .problem-item { background: #f8d7da; border: 1px solid #f5c6cb; padding: 10px; margin: 5px 0; border-radius: 4px; border-left: 4px solid #dc3545; }
        .sample-coords { font-family: monospace; background: #e9ecef; padding: 15px; border-radius: 5px; margin: 10px 0; }
        .coord-test { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1><i class="fas fa-tachometer-alt"></i> 監視器縣市快速檢查</h1>
        
        <div class="quick-check">
            <h2><i class="fas fa-bolt"></i> 一鍵快速檢查</h2>
            <p>快速檢查關鍵監視器的縣市歸類是否正確</p>
            
            <button class="check-btn" onclick="quickCheck()" id="quickCheckBtn">
                <i class="fas fa-play"></i> 開始快速檢查
            </button>
            
            <div id="quickResult" style="display: none;"></div>
        </div>

        <div class="result-card">
            <h3><i class="fas fa-map-marked-alt"></i> 已知問題座標測試</h3>
            <p>測試之前發現的問題座標是否已修正</p>
            
            <div class="sample-coords">
                <strong>國道5號 54K+266 (蘇澳-羅東)</strong><br>
                座標: 121.822982, 24.619922<br>
                預期縣市: 宜蘭縣
            </div>
            
            <div class="coord-test" id="coordTest1">
                <i class="fas fa-spinner fa-spin"></i> 測試中...
            </div>
        </div>

        <div class="result-card">
            <h3><i class="fas fa-list-check"></i> 各系統座標範圍檢查</h3>
            
            <div id="systemChecks">
                <div class="coord-test">
                    <strong>台北市範圍測試:</strong> 121.5, 25.0 
                    <span id="taipeiTest"></span>
                </div>
                <div class="coord-test">
                    <strong>宜蘭縣範圍測試:</strong> 121.75, 24.75 
                    <span id="yilanTest"></span>
                </div>
                <div class="coord-test">
                    <strong>新北市範圍測試:</strong> 121.4, 24.9 
                    <span id="newTaipeiTest"></span>
                </div>
                <div class="coord-test">
                    <strong>桃園市範圍測試:</strong> 121.3, 24.95 
                    <span id="taoyuanTest"></span>
                </div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="tdx-api.js"></script>
    <script>
        // 座標轉換函數 (與主系統相同)
        function getCityFromCoordinates(lon, lat, roadName = '') {
            if (!lon || !lat) return '未知';
            
            // 特殊處理國道5號
            if (roadName && roadName.includes('國道5號')) {
                if (lon >= 121.50 && lat >= 24.50 && lat <= 25.00) {
                    return '宜蘭縣';
                } else if (lon >= 121.30 && lon < 121.50 && lat >= 24.85) {
                    return '新北市';
                }
            }
            
            const cityRanges = [
                { name: '台北市', lonMin: 121.45, lonMax: 121.65, latMin: 24.95, latMax: 25.20 },
                { name: '基隆市', lonMin: 121.65, lonMax: 121.85, latMin: 25.10, latMax: 25.25 },
                { name: '新竹市', lonMin: 120.90, lonMax: 121.05, latMin: 24.75, latMax: 24.85 },
                { name: '嘉義市', lonMin: 120.40, lonMax: 120.50, latMin: 23.45, latMax: 23.52 },
                { name: '宜蘭縣', lonMin: 121.50, lonMax: 122.10, latMin: 24.50, latMax: 25.05 },
                { name: '花蓮縣', lonMin: 121.30, lonMax: 121.80, latMin: 23.30, latMax: 24.50 },
                { name: '台東縣', lonMin: 120.90, lonMax: 121.50, latMin: 22.30, latMax: 23.50 },
                { name: '桃園市', lonMin: 121.00, lonMax: 121.50, latMin: 24.80, latMax: 25.10 },
                { name: '新竹縣', lonMin: 120.70, lonMax: 121.30, latMin: 24.50, latMax: 25.00 },
                { name: '苗栗縣', lonMin: 120.60, lonMax: 121.20, latMin: 24.20, latMax: 24.80 },
                { name: '台中市', lonMin: 120.50, lonMax: 121.20, latMin: 24.00, latMax: 24.50 },
                { name: '彰化縣', lonMin: 120.40, lonMax: 120.80, latMin: 23.80, latMax: 24.20 },
                { name: '南投縣', lonMin: 120.60, lonMax: 121.30, latMin: 23.50, latMax: 24.20 },
                { name: '雲林縣', lonMin: 120.20, lonMax: 120.70, latMin: 23.50, latMax: 23.90 },
                { name: '嘉義縣', lonMin: 120.10, lonMax: 120.80, latMin: 23.30, latMax: 23.70 },
                { name: '台南市', lonMin: 120.00, lonMax: 120.50, latMin: 22.90, latMax: 23.40 },
                { name: '高雄市', lonMin: 120.20, lonMax: 120.50, latMin: 22.50, latMax: 23.10 },
                { name: '屏東縣', lonMin: 120.40, lonMax: 120.90, latMin: 22.00, latMax: 22.80 },
                { name: '新北市', lonMin: 121.30, lonMax: 121.80, latMin: 24.60, latMax: 25.30 }
            ];
            
            for (const city of cityRanges) {
                if (lon >= city.lonMin && lon <= city.lonMax && lat >= city.latMin && lat <= city.latMax) {
                    return city.name;
                }
            }
            
            return '其他地區';
        }

        // 測試已知問題座標
        function testKnownCoordinates() {
            // 國道5號問題座標
            const result1 = getCityFromCoordinates(121.822982, 24.619922, '國道5號');
            const element1 = document.getElementById('coordTest1');
            
            if (result1 === '宜蘭縣') {
                element1.innerHTML = '<i class="fas fa-check" style="color: green;"></i> <strong>修正成功!</strong> 正確歸類為: ' + result1;
                element1.className = 'coord-test';
                element1.style.background = '#d4edda';
                element1.style.border = '1px solid #c3e6cb';
            } else {
                element1.innerHTML = '<i class="fas fa-times" style="color: red;"></i> <strong>仍有問題!</strong> 錯誤歸類為: ' + result1 + ' (應為宜蘭縣)';
                element1.className = 'coord-test';
                element1.style.background = '#f8d7da';
                element1.style.border = '1px solid #f5c6cb';
            }
        }

        // 測試各縣市範圍
        function testCityRanges() {
            const tests = [
                { id: 'taipeiTest', lon: 121.5, lat: 25.0, expected: '台北市' },
                { id: 'yilanTest', lon: 121.75, lat: 24.75, expected: '宜蘭縣' },
                { id: 'newTaipeiTest', lon: 121.4, lat: 24.9, expected: '新北市' },
                { id: 'taoyuanTest', lon: 121.3, lat: 24.95, expected: '桃園市' }
            ];
            
            tests.forEach(test => {
                const result = getCityFromCoordinates(test.lon, test.lat);
                const element = document.getElementById(test.id);
                
                if (result === test.expected) {
                    element.innerHTML = '<i class="fas fa-check" style="color: green;"></i> ✅ ' + result;
                } else {
                    element.innerHTML = '<i class="fas fa-times" style="color: red;"></i> ❌ ' + result + ' (應為' + test.expected + ')';
                }
            });
        }

        async function quickCheck() {
            const btn = document.getElementById('quickCheckBtn');
            const result = document.getElementById('quickResult');
            
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 檢查中...';
            result.style.display = 'block';
            result.innerHTML = '<div class="status loading"><i class="fas fa-spinner fa-spin"></i> 正在檢查監視器系統...</div>';
            
            let problems = [];
            
            try {
                // 測試幾個關鍵監視器的座標
                const testCases = [
                    { name: '國道5號 54K+266', lon: 121.822982, lat: 24.619922, road: '國道5號', expected: '宜蘭縣' },
                    { name: '國道1號 台北段', lon: 121.5, lat: 25.0, road: '國道1號', expected: '台北市' },
                    { name: '國道3號 桃園段', lon: 121.3, lat: 24.9, road: '國道3號', expected: '桃園市' },
                    { name: '省道測試點', lon: 121.4, lat: 24.8, road: '省道', expected: '桃園市' }
                ];
                
                testCases.forEach(test => {
                    const calculatedCity = getCityFromCoordinates(test.lon, test.lat, test.road);
                    if (calculatedCity !== test.expected) {
                        problems.push({
                            name: test.name,
                            coordinates: `${test.lon}, ${test.lat}`,
                            expected: test.expected,
                            calculated: calculatedCity,
                            road: test.road
                        });
                    }
                });
                
                // 顯示結果
                if (problems.length === 0) {
                    result.innerHTML = `
                        <div class="status success">
                            <i class="fas fa-check-circle"></i> 
                            <strong>檢查完成！</strong><br>
                            所有測試的關鍵座標都正確歸類 ✅
                        </div>
                    `;
                } else {
                    let problemHtml = `
                        <div class="status warning">
                            <i class="fas fa-exclamation-triangle"></i> 
                            <strong>發現 ${problems.length} 個問題</strong>
                        </div>
                    `;
                    
                    problems.forEach(problem => {
                        problemHtml += `
                            <div class="problem-item">
                                <strong>${problem.name}</strong><br>
                                座標: ${problem.coordinates}<br>
                                路線: ${problem.road}<br>
                                預期: ${problem.expected} | 實際: ${problem.calculated}
                            </div>
                        `;
                    });
                    
                    result.innerHTML = problemHtml;
                }
                
            } catch (error) {
                result.innerHTML = `<div class="status error"><i class="fas fa-times-circle"></i> 檢查失敗: ${error.message}</div>`;
            }
            
            btn.disabled = false;
            btn.innerHTML = '<i class="fas fa-redo"></i> 重新檢查';
        }

        // 頁面載入時自動執行測試
        window.onload = function() {
            testKnownCoordinates();
            testCityRanges();
        };
    </script>
</body>
</html>