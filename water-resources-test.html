<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°´åˆ©ç½²æ²³å·åˆ†ç½² API æ¸¬è©¦</title>
    <style>
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #2196F3; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #4CAF50; color: white; }
        .error { background: #f44336; color: white; }
        .info { background: #2196F3; color: white; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto; }
        .field { margin: 10px 0; padding: 10px; border-left: 3px solid #2196F3; background: #f9f9f9; }
        .field-name { font-weight: bold; color: #2196F3; }
        button { padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #1976D2; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŠ æ°´åˆ©ç½²å„æ²³å·åˆ†ç½²æµåŸŸèˆ‡ç–æ¿¬å·¥å€é ç«¯ç›£æ§å½±åƒ API æ¸¬è©¦</h1>
        
        <div>
            <button onclick="testAPI()">æ¸¬è©¦ API é€£ç·š</button>
            <button onclick="showFields()">é¡¯ç¤ºæ¬„ä½èªªæ˜</button>
        </div>
        
        <div id="status"></div>
        <div id="results"></div>
        <div id="fields" style="display: none;">
            <h2>API æ¬„ä½èªªæ˜</h2>
            <div class="field">
                <span class="field-name">StationName</span>: ç«™å
            </div>
            <div class="field">
                <span class="field-name">Authority</span>: æä¾›å–®ä½
            </div>
            <div class="field">
                <span class="field-name">CCDIdentifier</span>: CCDç·¨è™Ÿ
            </div>
            <div class="field">
                <span class="field-name">RiverName</span>: æ²³å·åç¨±
            </div>
            <div class="field">
                <span class="field-name">RiverCode</span>: æ²³å·ä»£ç¢¼
            </div>
            <div class="field">
                <span class="field-name">ImageURL</span>: å½±åƒé€£çµ
            </div>
            <div class="field">
                <span class="field-name">latitude_4326</span>: ç·¯åº¦_4326ï¼ˆç·¯åº¦ï¼‰
            </div>
            <div class="field">
                <span class="field-name">Longitude_4326</span>: ç¶“åº¦_4326ï¼ˆç¶“åº¦ï¼‰
            </div>
            <div class="field">
                <span class="field-name">Coordinate</span>: åæ¨™ç³»çµ±
            </div>
            <div class="field">
                <span class="field-name">Status</span>: æ”å½±æ©Ÿç‹€æ…‹
            </div>
        </div>
    </div>

    <script>
        function showFields() {
            const fieldsDiv = document.getElementById('fields');
            fieldsDiv.style.display = fieldsDiv.style.display === 'none' ? 'block' : 'none';
        }

        async function testAPI() {
            const statusDiv = document.getElementById('status');
            const resultsDiv = document.getElementById('results');
            
            statusDiv.innerHTML = '<div class="status info">æ­£åœ¨é€£ç·šåˆ°æ°´åˆ©ç½²æ²³å·åˆ†ç½² API...</div>';
            resultsDiv.innerHTML = '';
            
            try {
                const response = await fetch('https://opendata.wra.gov.tw/api/v2/65d61e4b-c250-4170-bcfc-5fd323fdd13e?limit=5&sort=_importdate%20desc&format=JSON');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data && data.records && data.records.length > 0) {
                    statusDiv.innerHTML = `<div class="status success">âœ… API é€£ç·šæˆåŠŸï¼å…±å–å¾— ${data.records.length} ç­†æ¸¬è©¦è³‡æ–™</div>`;
                    
                    // é¡¯ç¤ºç¬¬ä¸€ç­†è³‡æ–™
                    const firstRecord = data.records[0];
                    let html = '<h2>ç¬¬ä¸€ç­†è³‡æ–™ç¯„ä¾‹ï¼š</h2>';
                    html += '<pre>' + JSON.stringify(firstRecord, null, 2) + '</pre>';
                    
                    // é¡¯ç¤ºé—œéµæ¬„ä½
                    html += '<h2>é—œéµæ¬„ä½æ“·å–ï¼š</h2>';
                    html += `<div class="field"><span class="field-name">ç«™åï¼š</span>${firstRecord.StationName || 'N/A'}</div>`;
                    html += `<div class="field"><span class="field-name">æä¾›å–®ä½ï¼š</span>${firstRecord.Authority || 'N/A'}</div>`;
                    html += `<div class="field"><span class="field-name">CCDç·¨è™Ÿï¼š</span>${firstRecord.CCDIdentifier || 'N/A'}</div>`;
                    html += `<div class="field"><span class="field-name">æ²³å·åç¨±ï¼š</span>${firstRecord.RiverName || 'N/A'}</div>`;
                    html += `<div class="field"><span class="field-name">æ²³å·ä»£ç¢¼ï¼š</span>${firstRecord.RiverCode || 'N/A'}</div>`;
                    html += `<div class="field"><span class="field-name">å½±åƒé€£çµï¼š</span>${firstRecord.ImageURL || 'N/A'}</div>`;
                    html += `<div class="field"><span class="field-name">åº§æ¨™ï¼š</span>ç·¯åº¦ ${firstRecord.latitude_4326 || 'N/A'}, ç¶“åº¦ ${firstRecord.Longitude_4326 || 'N/A'}</div>`;
                    html += `<div class="field"><span class="field-name">åæ¨™ç³»çµ±ï¼š</span>${firstRecord.Coordinate || 'N/A'}</div>`;
                    html += `<div class="field"><span class="field-name">ç‹€æ…‹ï¼š</span>${firstRecord.Status || 'N/A'}</div>`;
                    
                    resultsDiv.innerHTML = html;
                } else {
                    throw new Error('API å›å‚³è³‡æ–™æ ¼å¼ä¸æ­£ç¢º');
                }
                
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ API é€£ç·šå¤±æ•—ï¼š${error.message}</div>`;
                resultsDiv.innerHTML = `
                    <h3>å¯èƒ½çš„åŸå› ï¼š</h3>
                    <ul>
                        <li>CORS è·¨åŸŸé™åˆ¶ï¼ˆç€è¦½å™¨å®‰å…¨æ”¿ç­–ï¼‰</li>
                        <li>æ°´åˆ©ç½² API ä¼ºæœå™¨ç¶­è­·ä¸­</li>
                        <li>ç¶²è·¯é€£ç·šå•é¡Œ</li>
                    </ul>
                    <p><strong>å»ºè­°ï¼š</strong>åœ¨å¯¦éš›ä¼ºæœå™¨ç’°å¢ƒæˆ–ä½¿ç”¨ä»£ç†ä¼ºæœå™¨æ¸¬è©¦</p>
                `;
                console.error('è©³ç´°éŒ¯èª¤ï¼š', error);
            }
        }
    </script>
</body>
</html>
